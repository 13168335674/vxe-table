"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,l,t){return l in e?Object.defineProperty(e,l,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[l]=t,e}var getAllColumns=function l(e){var t=[];return e.forEach(function(e){e.visible&&(e.children&&e.children.length&&e.children.some(function(e){return e.visible})?(t.push(e),t.push.apply(t,l(e.children))):t.push(e))}),t},convertToRows=function(e){var n=1;e.forEach(function(e){e.level=1,function l(t,e){if(e&&(t.level=e.level+1,n<t.level&&(n=t.level)),t.children&&t.children.length&&t.children.some(function(e){return e.visible})){var o=0;t.children.forEach(function(e){e.visible&&(l(e,t),o+=e.colSpan)}),t.colSpan=o}else t.colSpan=1}(e)});for(var l=[],t=0;t<n;t++)l.push([]);return getAllColumns(e).forEach(function(e){e.children&&e.children.length&&e.children.some(function(e){return e.visible})?e.rowSpan=1:e.rowSpan=n-e.level+1,l[e.level-1].push(e)}),l},_default={name:"VxeTableHeader",props:{tableData:Array,tableColumn:Array,visibleColumn:Array,collectColumn:Array,fixedColumn:Array,size:String,fixedType:String,isGroup:Boolean},data:function(){return{headerColumn:[]}},watch:{tableColumn:function(){this.uploadColumn()}},created:function(){this.uploadColumn()},mounted:function(){var e=this.$parent,l=this.$el,t=this.$refs,o=this.fixedType,n=e.elemStore,r="".concat(o||"main","-header-");n["".concat(r,"wrapper")]=l,n["".concat(r,"table")]=t.table,n["".concat(r,"colgroup")]=t.colgroup,n["".concat(r,"list")]=t.thead,n["".concat(r,"x-space")]=t.xSpace,n["".concat(r,"repair")]=t.repair},render:function(v){var e=this._e,b=this.$parent,g=this.fixedType,l=this.headerColumn,t=this.tableColumn,C=this.resizeMousedown,o=this.fixedColumn,y=b.$listeners,w=b.resizable,$=b.border,n=b.headerRowClassName,_=b.headerCellClassName,I=b.showHeaderOverflow,T=b.highlightCurrentColumn,r=b.mouseConfig,z=void 0===r?{}:r,i=b.scrollXLoad,S=b.overflowX,k=b.getColumnMapIndex;return i&&g&&(t=o),v("div",{class:["vxe-table--header-wrapper",g?"fixed-".concat(g,"--wrapper"):"body--wrapper"]},[g?e():v("div",{class:"vxe-body--x-space",ref:"xSpace"}),v("table",{class:"vxe-table--header",attrs:{cellspacing:0,cellpadding:0,border:0},ref:"table"},[v("colgroup",{ref:"colgroup"},t.map(function(e,l){return v("col",{attrs:{name:e.id},key:l})}).concat([v("col",{attrs:{name:"col-gutter"}})])),v("thead",{ref:"thead"},l.map(function(e,x){return v("tr",{class:["vxe-header--row",n?_xeUtils.default.isFunction(n)?n({$table:b,$rowIndex:x,fixed:g}):n:""]},e.map(function(l,t){var e,o=l.columnKey,n=l.showHeaderOverflow,r=l.headerAlign,i=l.own,a=l.children&&l.children.length,c=g?l.fixed!==g&&!a:l.fixed&&S,s=_xeUtils.default.isUndefined(n)||_xeUtils.default.isNull(n)?I:n,d="ellipsis"===s,u="title"===s,f=!0===s||"tooltip"===s,h=u||f||d,p={},m=k(l);return f&&(p.mouseover=function(e){b._isResize||b.triggerHeaderTooltipEvent(e,{$table:b,column:l,columnIndex:m,$columnIndex:t,fixed:g})},p.mouseout=function(e){b._isResize||b.clostTooltip()}),(T||y["header-cell-click"]||z.checked)&&(p.click=function(e){return b.triggerHeaderCellClickEvent(e,{$table:b,$rowIndex:x,column:l,columnIndex:m,$columnIndex:t,fixed:g,cell:e.currentTarget})}),y["header-cell-dblclick"]&&(p.dblclick=function(e){return _tools.UtilTools.emitEvent(b,"header-cell-dblclick",[{$table:b,$rowIndex:x,column:l,columnIndex:m,$columnIndex:t,fixed:g,cell:e.currentTarget},e])}),z.checked&&(p.mousedown=function(e){return b.triggerHeaderCellMousedownEvent(e,{$table:b,$rowIndex:x,column:l,columnIndex:m,$columnIndex:t,fixed:g,cell:e.currentTarget})}),v("th",{class:["vxe-header--column",l.id,(e={},_defineProperty(e,"col--".concat(r),r),_defineProperty(e,"col--index","index"===l.type),_defineProperty(e,"col--ellipsis",h),_defineProperty(e,"fixed--hidden",c),_defineProperty(e,"filter--active",l.filters.some(function(e){return e.checked})),e),_?_xeUtils.default.isFunction(_)?_({$table:b,$rowIndex:x,column:l,columnIndex:m,$columnIndex:t,fixed:g}):_:""],attrs:{"data-index":m,colspan:l.colSpan,rowspan:l.rowSpan},on:p,key:o||(a?l.id:m)},[v("div",{class:["vxe-cell",{"c--title":u,"c--tooltip":f,"c--ellipsis":d}],attrs:{title:u?i.title||i.label:null}},l.renderHeader(v,{$table:b,$rowIndex:x,column:l,columnIndex:m,$columnIndex:t,fixed:g,isHidden:c})),!c&&!a&&(_xeUtils.default.isBoolean(l.resizable)?l.resizable:w)?v("div",{class:["vxe-resizable",{"is--line":!$}],on:{mousedown:function(e){return C(e,l)}}}):null])}).concat([v("th",{class:"col--gutter"})]))}))]),v("div",{class:"vxe-table--repair",ref:"repair"})])},methods:{uploadColumn:function(){this.headerColumn=this.isGroup?convertToRows(this.collectColumn):[this.$parent.scrollXLoad&&this.fixedType?this.fixedColumn:this.tableColumn]},resizeMousedown:function(e,l){var t=this.$parent,o=this.$el,n=this.fixedType,r=t.$refs,i=r.tableBody,a=r.rightContainer,c=r.resizeBar,s=e.target,d=e.clientX,u=s.parentNode,f=0,h=i.$el,p=_tools.DomTools.getOffsetPos(s,o),m=s.clientWidth,x=p.left-u.clientWidth+m+36,v=p.left+Math.floor(m/2),b=document.onmousemove,g=document.onmouseup,C=0,y=u;if(a&&"right"===n){for(;y&&!_tools.DomTools.hasClass(y,"fixed--hidden");)C+=y.offsetWidth,y=y.previousElementSibling;v=a.offsetLeft+C}var w=function(e){e.stopPropagation(),e.preventDefault();var l=e.clientX-d,t=v+l,o=n?0:h.scrollLeft;"left"===n&&a?t=Math.min(t,a.offsetLeft-36):"right"===n&&(x=v-u.offsetWidth+36),f=t<x?x:t,c.style.left="".concat(f-o,"px")};t._isResize=!0,_tools.DomTools.addClass(t.$el,"c--resize"),c.style.display="block",document.onmousemove=w,document.onmouseup=function(e){document.onmousemove=b,document.onmouseup=g,l.resizeWidth=l.renderWidth+(f-v),c.style.display="none",t._isResize=!1,t.analyColumnWidth(),t.recalculate(!0),_tools.DomTools.removeClass(t.$el,"c--resize")},w(e)}}};exports.default=_default;