"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,l,n){return l in e?Object.defineProperty(e,l,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[l]=n,e}var getAllColumns=function l(e){var n=[];return e.forEach(function(e){e.visible&&(e.children&&e.children.length&&e.children.some(function(e){return e.visible})?(n.push(e),n.push.apply(n,l(e.children))):n.push(e))}),n},convertToRows=function(e){var o=1;e.forEach(function(e){e.level=1,function l(n,e){if(e&&(n.level=e.level+1,o<n.level&&(o=n.level)),n.children&&n.children.length&&n.children.some(function(e){return e.visible})){var t=0;n.children.forEach(function(e){e.visible&&(l(e,n),t+=e.colSpan)}),n.colSpan=t}else n.colSpan=1}(e)});for(var l=[],n=0;n<o;n++)l.push([]);return getAllColumns(e).forEach(function(e){e.children&&e.children.length&&e.children.some(function(e){return e.visible})?e.rowSpan=1:e.rowSpan=o-e.level+1,l[e.level-1].push(e)}),l},_default={name:"VxeTableHeader",props:{tableData:Array,tableColumn:Array,visibleColumn:Array,collectColumn:Array,fixedColumn:Array,size:String,fixedType:String,isGroup:Boolean},data:function(){return{headerColumn:[]}},watch:{tableColumn:function(){this.uploadColumn()}},created:function(){this.uploadColumn()},mounted:function(){var e=this.$parent,l=this.$el,n=this.$refs,t=this.fixedType,o=e.elemStore,r="".concat(t||"main","-header-");o["".concat(r,"wrapper")]=l,o["".concat(r,"table")]=n.table,o["".concat(r,"colgroup")]=n.colgroup,o["".concat(r,"list")]=n.thead,o["".concat(r,"x-space")]=n.xSpace,o["".concat(r,"repair")]=n.repair},render:function(x){var e=this._e,v=this.$parent,b=this.fixedType,l=this.headerColumn,n=this.tableColumn,g=this.resizeMousedown,t=this.fixedColumn,y=v.$listeners,w=v.resizable,$=v.border,o=v.headerRowClassName,C=v.headerCellClassName,_=v.showHeaderOverflow,I=v.highlightCurrentColumn,r=v.mouseConfig,T=void 0===r?{}:r,i=v.scrollXLoad,k=v.getColumnMapIndex;return i&&b&&(n=t),x("div",{class:["vxe-table--header-wrapper",b?"fixed-".concat(b,"--wrapper"):"body--wrapper"]},[b?e():x("div",{class:["vxe-body--x-space"],ref:"xSpace"}),x("table",{class:"vxe-table--header",attrs:{cellspacing:0,cellpadding:0,border:0},ref:"table"},[x("colgroup",{ref:"colgroup"},n.map(function(e,l){return x("col",{attrs:{name:e.id},key:l})}).concat([x("col",{attrs:{name:"col-gutter"}})])),x("thead",{ref:"thead"},l.map(function(e,m){return x("tr",{class:["vxe-header--row",o?_xeUtils.default.isFunction(o)?o({$table:v,$rowIndex:m,fixed:b}):o:""]},e.map(function(l,n){var e,t=l.columnKey,o=l.showHeaderOverflow,r=l.headerAlign,i=l.own,c=l.children&&l.children.length,a=b&&l.fixed!==b&&!c,u="ellipsis"===(o||_),d="title"===(o||_),s=!0===o||"tooltip"===o||!0===_||"tooltip"===_,f=d||s||u,p={},h=k(l);return s&&(p.mouseover=function(e){v.triggerHeaderTooltipEvent(e,{$table:v,column:l,columnIndex:h,$columnIndex:n,fixed:b})},p.mouseout=v.clostTooltip),(I||y["header-cell-click"]||T.checked)&&(p.click=function(e){v.triggerHeaderCellClickEvent(e,{$table:v,$rowIndex:m,column:l,columnIndex:h,$columnIndex:n,fixed:b,cell:e.currentTarget})}),y["header-cell-dblclick"]&&(p.dblclick=function(e){_tools.UtilTools.emitEvent(v,"header-cell-dblclick",[{$table:v,$rowIndex:m,column:l,columnIndex:h,$columnIndex:n,fixed:b,cell:e.currentTarget},e])}),T.checked&&(p.mousedown=function(e){v.triggerHeaderCellMousedownEvent(e,{$table:v,$rowIndex:m,column:l,columnIndex:h,$columnIndex:n,fixed:b,cell:e.currentTarget})}),x("th",{class:["vxe-header--column",l.id,(e={},_defineProperty(e,"col--".concat(r),r),_defineProperty(e,"col--index","index"===l.type),_defineProperty(e,"col--ellipsis",f),_defineProperty(e,"fixed--hidden",a),_defineProperty(e,"filter--active",l.filters.some(function(e){return e.checked})),e),C?_xeUtils.default.isFunction(C)?C({$table:v,$rowIndex:m,column:l,columnIndex:h,$columnIndex:n,fixed:b}):C:""],attrs:{"data-index":h,colspan:l.colSpan,rowspan:l.rowSpan},on:p,key:t||(c?l.id:h)},[x("div",{class:["vxe-cell",{"c--title":d,"c--tooltip":s,"c--ellipsis":u}],attrs:{title:d?i.title||i.label:null},style:{}},l.renderHeader(x,{$table:v,$rowIndex:m,column:l,columnIndex:h,$columnIndex:n,fixed:b,isHidden:a})),(_xeUtils.default.isBoolean(l.resizable)?l.resizable:w)&&!b&&!c?x("div",{class:["vxe-resizable",{"is--line":!$}],on:{mousedown:function(e){g(e,l)}}}):null])}).concat([x("th",{class:["col--gutter"]})]))}))]),x("div",{class:["vxe-table--repair"],ref:"repair"})])},methods:{uploadColumn:function(){this.headerColumn=this.isGroup?convertToRows(this.collectColumn):[this.$parent.scrollXLoad&&this.fixedType?this.fixedColumn:this.tableColumn]},resizeMousedown:function(e,l){var n=this.$parent,t=this.$el,o=e.target,r=0,i=n.$refs.tableBody.$el,c=n.$refs.resizeBar,a=_tools.DomTools.getOffsetPos(o,t),u=a.left-o.parentNode.clientWidth+o.clientWidth+36,d=a.left+6,s=e.clientX,f=document.onmousemove,p=document.onmouseup,h=function(e){e.stopPropagation(),e.preventDefault();var l=e.clientX-s,n=d+l;r=n<u?u:n,c.style.left="".concat(r-i.scrollLeft,"px")};c.style.display="block",document.onmousemove=h,document.onmouseup=function(e){document.onmousemove=f,document.onmouseup=p,l.resizeWidth=l.renderWidth-(d-r),c.style.display="none",n.analyColumnWidth(),n.recalculate()},h(e)}}};exports.default=_default;