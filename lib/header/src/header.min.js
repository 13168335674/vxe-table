"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,l,t){return l in e?Object.defineProperty(e,l,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[l]=t,e}var getAllColumns=function l(e){var t=[];return e.forEach(function(e){e.visible&&(e.children&&e.children.length&&e.children.some(function(e){return e.visible})?(t.push(e),t.push.apply(t,l(e.children))):t.push(e))}),t},convertToRows=function(e){var o=1;e.forEach(function(e){e.level=1,function l(t,e){if(e&&(t.level=e.level+1,o<t.level&&(o=t.level)),t.children&&t.children.length&&t.children.some(function(e){return e.visible})){var n=0;t.children.forEach(function(e){e.visible&&(l(e,t),n+=e.colSpan)}),t.colSpan=n}else t.colSpan=1}(e)});for(var l=[],t=0;t<o;t++)l.push([]);return getAllColumns(e).forEach(function(e){e.children&&e.children.length&&e.children.some(function(e){return e.visible})?e.rowSpan=1:e.rowSpan=o-e.level+1,l[e.level-1].push(e)}),l},_default={name:"VxeTableHeader",props:{tableData:Array,tableColumn:Array,visibleColumn:Array,collectColumn:Array,fixedColumn:Array,size:String,fixedType:String,isGroup:Boolean},data:function(){return{headerColumn:[]}},watch:{tableColumn:function(){this.uploadColumn()}},created:function(){this.uploadColumn()},mounted:function(){var e=this.$parent,l=this.$el,t=this.$refs,n=this.fixedType,o=e._elemStore,r="".concat(n||"main","-header-");o["".concat(r,"wrapper")]=l,o["".concat(r,"table")]=t.table,o["".concat(r,"colgroup")]=t.colgroup,o["".concat(r,"list")]=t.thead,o["".concat(r,"x-space")]=t.xSpace,o["".concat(r,"repair")]=t.repair},render:function(h){var e=this._e,m=this.$parent,v=this.fixedType,l=this.headerColumn,t=this.tableColumn,x=this.resizeMousedown,n=this.fixedColumn,b=m.$listeners,g=m.resizable,y=m.border,o=m.headerRowClassName,C=m.headerCellClassName,w=m.showHeaderOverflow,$=m.highlightCurrentColumn,r=m.scrollXLoad,_=m.getColumnMapIndex;return r&&v&&(t=n),h("div",{class:["vxe-table--header-wrapper",v?"fixed-".concat(v,"--wrapper"):"body--wrapper"]},[v?e():h("div",{class:["vxe-body--x-space"],ref:"xSpace"}),h("table",{class:"vxe-table--header",attrs:{cellspacing:0,cellpadding:0,border:0},ref:"table"},[h("colgroup",{ref:"colgroup"},t.map(function(e,l){return h("col",{attrs:{name:e.id},key:l})}).concat([h("col",{attrs:{name:"col-gutter"}})])),h("thead",{ref:"thead"},l.map(function(e,p){return h("tr",{class:["vxe-header--row",o?_xeUtils.default.isFunction(o)?o({$table:m,$rowIndex:p,fixed:v}):o:""]},e.map(function(l,t){var e,n=l.columnKey,o=l.showHeaderOverflow,r=l.headerAlign,i=l.children&&l.children.length,a=v&&l.fixed!==v&&!i,c="ellipsis"===(o||w),u="title"===(o||w),s=!0===o||"tooltip"===o||!0===w||"tooltip"===w,d={},f=_(l);return s&&(d.mouseover=function(e){m.triggerHeaderTooltipEvent(e,{$table:m,column:l,columnIndex:f,fixed:v})},d.mouseout=m.clostTooltip),($||b["header-cell-click"])&&(d.click=function(e){m.triggerHeaderCellClickEvent(e,{$table:m,$rowIndex:p,column:l,columnIndex:f,$columnIndex:t,fixed:v,cell:e.currentTarget})}),b["header-cell-dblclick"]&&(d.dblclick=function(e){_tools.UtilTools.emitEvent(m,"header-cell-dblclick",[{$table:m,$rowIndex:p,column:l,columnIndex:f,$columnIndex:t,fixed:v,cell:e.currentTarget},e])}),h("th",{class:["vxe-header--column",l.id,(e={},_defineProperty(e,"col--".concat(r),r),_defineProperty(e,"fixed--hidden",a),_defineProperty(e,"filter--active",l.filters.some(function(e){return e.checked})),e),C?_xeUtils.default.isFunction(C)?C({$table:m,$rowIndex:p,column:l,columnIndex:f,$columnIndex:t,fixed:v}):C:""],attrs:{"data-index":f,colspan:l.colSpan,rowspan:l.rowSpan},on:d,key:n||(i?l.id:f)},[h("div",{class:["vxe-cell",{"c--title":u,"c--tooltip":s,"c--ellipsis":c}],attrs:{title:u?l.origin.label:null},style:{}},l.renderHeader(h,{$table:m,column:l,columnIndex:f,fixed:v,isHidden:a})),(_xeUtils.default.isBoolean(l.resizable)?l.resizable:g)&&!v&&!i?h("div",{class:["vxe-resizable",{"is--line":!y}],on:{mousedown:function(e){x(e,l)}}}):null])}).concat([h("th",{class:["col--gutter"]})]))}))]),h("div",{class:["vxe-table--repair"],ref:"repair"})])},methods:{uploadColumn:function(){this.headerColumn=this.isGroup?convertToRows(this.collectColumn):[this.$parent.scrollXLoad&&this.fixedType?this.fixedColumn:this.tableColumn]},resizeMousedown:function(e,l){var t=this.$parent,n=this.$el,o=e.target,r=0,i=t.$refs.tableBody.$el,a=t.$refs.resizeBar,c=_tools.DomTools.getOffsetPos(o,n),u=c.left-o.parentNode.clientWidth+o.clientWidth+36,s=c.left+6,d=e.clientX,f=document.onmousemove,p=document.onmouseup,h=function(e){e.preventDefault();var l=e.clientX-d,t=s+l;r=t<u?u:t,a.style.left="".concat(r-i.scrollLeft,"px")};a.style.display="block",document.onmousemove=h,document.onmouseup=function(e){document.onmousemove=f,document.onmouseup=p,l.resizeWidth=l.renderWidth-(s-r),a.style.display="none",t.analyColumnWidth(),t.recalculate()},h(e)}}};exports.default=_default;