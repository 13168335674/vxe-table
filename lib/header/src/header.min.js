"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,l,t){return l in e?Object.defineProperty(e,l,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[l]=t,e}var getAllColumns=function l(e){var t=[];return e.forEach(function(e){e.visible&&(e.children&&e.children.length&&e.children.some(function(e){return e.visible})?(t.push(e),t.push.apply(t,l(e.children))):t.push(e))}),t},convertToRows=function(e){var o=1;e.forEach(function(e){e.level=1,function l(t,e){if(e&&(t.level=e.level+1,o<t.level&&(o=t.level)),t.children&&t.children.length&&t.children.some(function(e){return e.visible})){var n=0;t.children.forEach(function(e){e.visible&&(l(e,t),n+=e.colSpan)}),t.colSpan=n}else t.colSpan=1}(e)});for(var l=[],t=0;t<o;t++)l.push([]);return getAllColumns(e).forEach(function(e){e.children&&e.children.length&&e.children.some(function(e){return e.visible})?e.rowSpan=1:e.rowSpan=o-e.level+1,l[e.level-1].push(e)}),l},_default={name:"VxeTableHeader",props:{tableData:Array,tableColumn:Array,visibleColumn:Array,collectColumn:Array,fixedColumn:Array,size:String,fixedType:String,isGroup:Boolean},data:function(){return{headerColumn:[]}},watch:{tableColumn:function(){this.uploadColumn()}},created:function(){this.uploadColumn()},mounted:function(){var e=this.$parent,l=this.$el,t=this.$refs,n=this.fixedType,o=e.elemStore,i="".concat(n||"main","-header-");o["".concat(i,"wrapper")]=l,o["".concat(i,"table")]=t.table,o["".concat(i,"colgroup")]=t.colgroup,o["".concat(i,"list")]=t.thead,o["".concat(i,"x-space")]=t.xSpace,o["".concat(i,"repair")]=t.repair},render:function(g){var e=this._e,C=this.$parent,y=this.fixedType,l=this.headerColumn,t=this.tableColumn,w=this.resizeMousedown,n=this.fixedColumn,$=C.$listeners,_=C.resizable,I=C.border,o=C.headerRowClassName,T=C.headerCellClassName,z=C.showHeaderOverflow,S=C.headerAlign,k=C.align,E=C.highlightCurrentColumn,i=C.mouseConfig,M=void 0===i?{}:i,r=C.scrollXLoad,P=C.overflowX,A=C.getColumnMapIndex;return r&&y&&(t=n),g("div",{class:["vxe-table--header-wrapper",y?"fixed-".concat(y,"--wrapper"):"body--wrapper"]},[y?e():g("div",{class:"vxe-body--x-space",ref:"xSpace"}),g("table",{class:"vxe-table--header",attrs:{cellspacing:0,cellpadding:0,border:0},ref:"table"},[g("colgroup",{ref:"colgroup"},t.map(function(e,l){return g("col",{attrs:{name:e.id},key:l})}).concat([g("col",{attrs:{name:"col-gutter"}})])),g("thead",{ref:"thead"},l.map(function(e,b){return g("tr",{class:["vxe-header--row",o?_xeUtils.default.isFunction(o)?o({$table:C,$rowIndex:b,fixed:y}):o:""]},e.map(function(l,t){var e,n=l.columnKey,o=l.showHeaderOverflow,i=l.headerAlign,r=l.align,a=l.own,c=l.children&&l.children.length,s=y?l.fixed!==y&&!c:l.fixed&&P,d=_xeUtils.default.isUndefined(o)||_xeUtils.default.isNull(o)?z:o,u=i||r||S||k,f="ellipsis"===d,h="title"===d,p=!0===d||"tooltip"===d,m=h||p||f,x={},v=A(l);return p&&(x.mouseover=function(e){C._isResize||C.triggerHeaderTooltipEvent(e,{$table:C,column:l,columnIndex:v,$columnIndex:t,fixed:y})},x.mouseout=function(e){C._isResize||C.clostTooltip()}),(E||$["header-cell-click"]||M.checked)&&(x.click=function(e){return C.triggerHeaderCellClickEvent(e,{$table:C,$rowIndex:b,column:l,columnIndex:v,$columnIndex:t,fixed:y,cell:e.currentTarget})}),$["header-cell-dblclick"]&&(x.dblclick=function(e){return _tools.UtilTools.emitEvent(C,"header-cell-dblclick",[{$table:C,$rowIndex:b,column:l,columnIndex:v,$columnIndex:t,fixed:y,cell:e.currentTarget},e])}),M.checked&&(x.mousedown=function(e){return C.triggerHeaderCellMousedownEvent(e,{$table:C,$rowIndex:b,column:l,columnIndex:v,$columnIndex:t,fixed:y,cell:e.currentTarget})}),g("th",{class:["vxe-header--column",l.id,(e={},_defineProperty(e,"col--".concat(u),u),_defineProperty(e,"col--index","index"===l.type),_defineProperty(e,"col--ellipsis",m),_defineProperty(e,"fixed--hidden",s),_defineProperty(e,"filter--active",l.filters.some(function(e){return e.checked})),e),T?_xeUtils.default.isFunction(T)?T({$table:C,$rowIndex:b,column:l,columnIndex:v,$columnIndex:t,fixed:y}):T:""],attrs:{"data-index":v,colspan:l.colSpan,rowspan:l.rowSpan},on:x,key:n||(c?l.id:v)},[g("div",{class:["vxe-cell",{"c--title":h,"c--tooltip":p,"c--ellipsis":f}],attrs:{title:h?a.title||a.label:null}},l.renderHeader(g,{$table:C,$rowIndex:b,column:l,columnIndex:v,$columnIndex:t,fixed:y,isHidden:s})),!s&&!c&&(_xeUtils.default.isBoolean(l.resizable)?l.resizable:_)?g("div",{class:["vxe-resizable",{"is--line":!I}],on:{mousedown:function(e){return w(e,l)}}}):null])}).concat([g("th",{class:"col--gutter"})]))}))]),g("div",{class:"vxe-table--repair",ref:"repair"})])},methods:{uploadColumn:function(){this.headerColumn=this.isGroup?convertToRows(this.collectColumn):[this.$parent.scrollXLoad&&this.fixedType?this.fixedColumn:this.tableColumn]},resizeMousedown:function(e,l){var t=this.$parent,n=this.$el,o=this.fixedType,i=t.$refs,r=i.tableBody,a=i.leftContainer,c=i.rightContainer,s=i.resizeBar,d=e.target,u=e.clientX,f=d.parentNode,h=0,p=r.$el,m=_tools.DomTools.getOffsetPos(d,n),x=d.clientWidth,v=m.left-f.clientWidth+x+36,b=m.left+Math.floor(x/2),g=document.onmousemove,C=document.onmouseup,y="right"===o,w=0,$=f.previousElementSibling;if(c&&y){for(;$&&!_tools.DomTools.hasClass($,"fixed--hidden");)w+=$.offsetWidth,$=$.previousElementSibling;b=c.offsetLeft+w}var _=function(e){e.stopPropagation(),e.preventDefault();var l=e.clientX-u,t=b+l,n=o?0:p.scrollLeft;"left"===o?t=Math.min(t,(c?c.offsetLeft:p.clientWidth)-36):y&&(v=(a?a.clientWidth:0)+36,t=Math.min(t,b+f.clientWidth-36)),h=Math.max(t,v+w),s.style.left="".concat(h-n,"px")};t._isResize=!0,_tools.DomTools.addClass(t.$el,"c--resize"),s.style.display="block",document.onmousemove=_,document.onmouseup=function(e){document.onmousemove=g,document.onmouseup=C,l.resizeWidth=l.renderWidth+(y?b-h:h-b),s.style.display="none",t._isResize=!1,t.analyColumnWidth(),t.recalculate(!0),_tools.DomTools.removeClass(t.$el,"c--resize")},_(e)}}};exports.default=_default;