"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var scrollProcessTimeout,_xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../conf")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,l,o){return l in e?Object.defineProperty(e,l,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[l]=o,e}function renderColumn(e,l,o,t,r,n,c,i,s,d,a,u,f){var p,x,v=o._e,y=o.$listeners,b=o.tableData,g=o.height,m=o.columnKey,w=o.overflowX,h=o.scrollXLoad,_=o.scrollYLoad,$=o.highlightCurrentRow,T=o.showOverflow,I=o.align,C=o.cellClassName,k=o.spanMethod,S=o.radioConfig,L=void 0===S?{}:S,R=o.selectConfig,B=void 0===R?{}:R,P=o.treeConfig,E=void 0===P?{}:P,q=o.mouseConfig,U=void 0===q?{}:q,H=o.editConfig,D=o.editRules,O=o.validOpts,X=o.editStore,Y=o.validStore,A=a.editRender,M=a.align,N=a.showOverflow,z=X.actived,F=n?a.fixed!==n:a.fixed&&w,j=_xeUtils.default.isUndefined(N)||_xeUtils.default.isNull(N)?T:N,K="ellipsis"===j,G="title"===j,V=!0===j||"tooltip"===j,J=G||V||K,Q={},W=M||I,Z=Y.row===i&&Y.column===a,ee=D&&("default"===O.message?g||1<b.length:"inline"===O.message),le={"data-index":u},oe=A&&H&&"dblclick"===H.trigger,te={$table:o,$seq:t,seq:r,row:i,rowIndex:s,$rowIndex:d,column:a,columnIndex:u,$columnIndex:f,fixed:n,isHidden:F,level:c,data:b};if(!h&&!_||J||(K=!0),(V||y["cell-mouseenter"])&&(Q.mouseenter=function(e){if(!o._isResize){var l={$table:o,seq:r,row:i,rowIndex:s,$rowIndex:d,column:a,columnIndex:u,$columnIndex:f,fixed:n,isHidden:F,level:c,cell:e.currentTarget};V&&o.triggerTooltipEvent(e,l),_tools.UtilTools.emitEvent(o,"cell-mouseenter",[l,e])}}),(V||y["cell-mouseleave"])&&(Q.mouseleave=function(e){o._isResize||(o.clostTooltip(),_tools.UtilTools.emitEvent(o,"cell-mouseleave",[{$table:o,seq:r,row:i,rowIndex:s,$rowIndex:d,column:a,columnIndex:u,$columnIndex:f,fixed:n,isHidden:F,level:c,cell:e.currentTarget},e]))}),(U.checked||U.selected)&&(Q.mousedown=function(e){o.triggerCellMousedownEvent(e,{$table:o,seq:r,row:i,rowIndex:s,$rowIndex:d,column:a,columnIndex:u,$columnIndex:f,fixed:n,isHidden:F,level:c,cell:e.currentTarget})}),($||y["cell-click"]||U.checked||A&&H||"row"===L.trigger||"radio"===a.type&&"cell"===L.trigger||"row"===B.trigger||"selection"===a.type&&"cell"===B.trigger||"row"===E.trigger||a.treeNode&&"cell"===E.trigger)&&(Q.click=function(e){o.triggerCellClickEvent(e,{$table:o,row:i,rowIndex:s,$rowIndex:d,column:a,columnIndex:u,$columnIndex:f,fixed:n,isHidden:F,level:c,cell:e.currentTarget})}),(oe||y["cell-dblclick"])&&(Q.dblclick=function(e){o.triggerCellDBLClickEvent(e,{$table:o,seq:r,row:i,rowIndex:s,$rowIndex:d,column:a,columnIndex:u,$columnIndex:f,fixed:n,isHidden:F,level:c,cell:e.currentTarget})}),k){var re=k(te)||{},ne=re.rowspan,ce=void 0===ne?1:ne,ie=re.colspan,se=void 0===ie?1:ie;if(!ce||!se)return null;le.rowspan=ce,le.colspan=se}return!F&&H&&H.showStatus&&(x=o.hasRowChange(i,a.property)),e("td",{class:["vxe-body--column",a.id,(p={},_defineProperty(p,"col--".concat(W),W),_defineProperty(p,"col--edit",A),_defineProperty(p,"col--index","index"===a.type),_defineProperty(p,"col--ellipsis",J),_defineProperty(p,"edit--visible",A&&"visible"===A.type),_defineProperty(p,"fixed--hidden",F),_defineProperty(p,"col--dirty",x),_defineProperty(p,"col--actived",H&&A&&z.row===i&&(z.column===a||"row"===H.mode)),_defineProperty(p,"col--valid-error",Z),p),C?_xeUtils.default.isFunction(C)?C(te):C:""],key:m?a.id:u,attrs:le,on:Q},T&&F?[]:[e("div",{class:["vxe-cell",{"c--title":G,"c--tooltip":V,"c--ellipsis":K}],attrs:{title:G?_tools.UtilTools.getCellLabel(i,a,te):null}},a.renderCell(e,te)),ee?Z?e("div",{class:"vxe-cell--valid",style:Y.rule&&Y.rule.width?{width:"".concat(Y.rule.width,"px")}:null},[e("span",{class:"vxe-cell--valid-msg"},_xeUtils.default.isFunction(Y.content)?Y.content.call(o,e):Y.content)]):v():null])}function renderRows(u,f,p,x,v,y,e,b){var g=p.rowKey,m=p.highlightHoverRow,w=p.rowClassName,h=p.treeConfig,_=p.treeExpandeds,$=p.scrollYLoad,T=p.scrollYStore,I=p.editStore,C=p.expandeds,k=p.getColumnIndex,S=[];return e.forEach(function(t,r){var e,l={},n=r,c=n+1;$&&(c+=T.startIndex),n=p.getRowIndex(t),m&&(l.mouseenter=function(e){p.triggerHoverEvent(e,{row:t,rowIndex:n})});var o=_tools.UtilTools.getRowid(p,t);if(S.push(u("tr",{class:["vxe-body--row",(e={},_defineProperty(e,"row--level-".concat(v),h),_defineProperty(e,"row--new",-1<I.insertList.indexOf(t)),e),w?_xeUtils.default.isFunction(w)?w({$table:p,seq:c,row:t,rowIndex:n}):w:""],attrs:{"data-rowid":o},key:g||h?o:r,on:l},b.map(function(e,l){var o=k(e);return renderColumn(u,f,p,x,c,y,v,t,n,r,e,o,l)}))),C.length&&-1<C.indexOf(t)){var i,s=b.find(function(e){return"expand"===e.type}),d=k(s);h&&(i={paddingLeft:"".concat(v*(h.indent||16)+30,"px")}),s&&S.push(u("tr",{class:"vxe-body--expanded-row",key:"expand_".concat(o),on:l},[u("td",{class:"vxe-body--expanded-column",attrs:{colspan:b.length}},[u("div",{class:"vxe-body--expanded-cell",style:i},[s.renderData(u,{$table:p,seq:c,row:t,rowIndex:n,column:s,columnIndex:d,fixed:y,level:v})])])]))}if(h&&_.length){var a=t[h.children];a&&a.length&&-1<_.indexOf(t)&&S.push.apply(S,renderRows(u,f,p,x?"".concat(x,".").concat(c):"".concat(c),v+1,y,a,b))}}),S}function syncBodyScroll(e,l,o){(l||o)&&(l&&(l.onscroll=null,l.scrollTop=e),o&&(o.onscroll=null,o.scrollTop=e),clearTimeout(scrollProcessTimeout),scrollProcessTimeout=setTimeout(function(){l&&(l.onscroll=l._onscroll),o&&(o.onscroll=o._onscroll)},100))}var _default={name:"VxeTableBody",props:{tableData:Array,tableColumn:Array,visibleColumn:Array,collectColumn:Array,fixedColumn:Array,size:String,fixedType:String,isGroup:Boolean},mounted:function(){var e=this.$parent,l=this.$el,o=this.$refs,t=this.fixedType,r=e.elemStore,n="".concat(t||"main","-body-");r["".concat(n,"wrapper")]=l,r["".concat(n,"table")]=o.table,r["".concat(n,"colgroup")]=o.colgroup,r["".concat(n,"list")]=o.tbody,r["".concat(n,"xSpace")]=o.xSpace,r["".concat(n,"ySpace")]=o.ySpace,r["".concat(n,"emptyBlock")]=o.emptyBlock,this.$el.onscroll=this.scrollEvent,this.$el._onscroll=this.scrollEvent},beforeDestroy:function(){this.$el._onscroll=null,this.$el.onscroll=null},render:function(o){var e=this._e,l=this.$parent,t=this.fixedColumn,r=this.fixedType,n=l.tableData,c=l.tableColumn,i=l.showOverflow,s=l.scrollXLoad,d=l.mouseConfig,a=void 0===d?{}:d,u=l.keyboardConfig,f=void 0===u?{}:u;return r&&i?c=t:s&&r&&(c=t),o("div",{class:["vxe-table--body-wrapper",r?"fixed-".concat(r,"--wrapper"):"body--wrapper"],attrs:{fixed:r},on:{mouseleave:l.clearHoverRow}},[r?e():o("div",{class:"vxe-body--x-space",ref:"xSpace"}),o("div",{class:"vxe-body--y-space",ref:"ySpace"}),o("table",{class:"vxe-table--body",attrs:{cellspacing:0,cellpadding:0,border:0},ref:"table"},[o("colgroup",{ref:"colgroup"},c.map(function(e,l){return o("col",{attrs:{name:e.id},key:l})})),o("tbody",{ref:"tbody"},renderRows(o,this,l,"",0,r,n,c))]),r||!a.checked&&!f.isCut?null:o("div",{class:"vxe-table--borders"},[a.checked?o("div",{class:"vxe-table-checked-borders",ref:"checkBorders"},[o("span",{class:"vxe-table-border-top",ref:"checkTop"}),o("span",{class:"vxe-table-border-right",ref:"checkRight"}),o("span",{class:"vxe-table-border-bottom",ref:"checkBottom"}),o("span",{class:"vxe-table-border-left",ref:"checkLeft"})]):null,f.isCut?o("div",{class:"vxe-table-copyed-borders",ref:"copyBorders"},[o("span",{class:"vxe-table-border-top",ref:"copyTop"}),o("span",{class:"vxe-table-border-right",ref:"copyRight"}),o("span",{class:"vxe-table-border-bottom",ref:"copyBottom"}),o("span",{class:"vxe-table-border-left",ref:"copyLeft"})]):null]),r||n.length?null:o("div",{class:"vxe-table--empty-block",ref:"emptyBlock"},[o("span",{class:"vxe-table--empty-text"},l.$slots.empty||_conf.default.i18n("vxe.table.emptyText"))])])},methods:{scrollEvent:function(e){var l=this.$parent,o=this.fixedType,t=l.$refs,r=l.scrollXLoad,n=l.scrollYLoad,c=l.lastScrollTop,i=l.lastScrollLeft,s=t.tableHeader,d=t.tableBody,a=t.leftBody,u=t.rightBody,f=s?s.$el:null,p=d.$el,x=a?a.$el:null,v=u?u.$el:null,y=p.scrollTop,b=p.scrollLeft,g=b!==i,m=y!==c;l.lastScrollTop=y,l.lastScrollLeft=b,x&&"left"===o?syncBodyScroll(y=x.scrollTop,p,v):v&&"right"===o?syncBodyScroll(y=v.scrollTop,p,x):(g&&f&&(f.scrollLeft=p.scrollLeft),(x||v)&&(l.checkScrolling(),m&&syncBodyScroll(y,x,v))),r&&g?l.triggerScrollXEvent(e):n&&m&&l.triggerScrollYEvent(e),_tools.UtilTools.emitEvent(l,"scroll",[{type:"body",fixed:o,scrollTop:y,scrollLeft:b,isX:g,isY:m,$table:l},e])}}};exports.default=_default;