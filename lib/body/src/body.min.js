"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var scrollProcessTimeout,updateLeftScrollingTimeput,_xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../conf")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,o,l){return o in e?Object.defineProperty(e,o,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[o]=l,e}function handleLocation(e,o,l,t,r){var n=o.indexOf(t),c=l.indexOf(r);e.active=-1<n&&-1<c,e.top=0===n&&-1<c,e.bottom=n===o.length-1&&-1<c,e.left=-1<n&&0===c,e.right=-1<n&&c===l.length-1}function renderColumn(e,o,l,t,r,n,c,i,d,s,a,u){var p,f,x,h=l.$listeners,m=l.tableData,y=l.overflowX,v=l.scrollXLoad,g=l.scrollYLoad,w=l.border,b=l.highlightCurrentRow,_=l.showAllOverflow,I=l.cellClassName,$=l.spanMethod,T=l.keyboardConfig,P=l.treeConfig,k=l.mouseConfig,C=l.editConfig,L=l.editStore,S=l.validStore,E=s.editRender,R=s.align,q=s.showOverflow,H=s.renderWidth,B=s.columnKey,D=L.checked,O=L.selected,U=L.actived,X=L.copyed,A=k&&k.selected,M=k&&k.checked,W=T&&T.isCut,Y=r?s.fixed!==r:s.fixed&&y,N="ellipsis"===(q||_),F="title"===(q||_),j=!0===q||"tooltip"===q||!0===_||"tooltip"===_,z=F||j||N,G={},K={},V={},J={},Q=E&&C&&"dblclick"===C.trigger,Z={$table:l,seq:t,row:c,rowIndex:i,$rowIndex:d,column:s,columnIndex:a,$columnIndex:u,fixed:r,level:n,isHidden:Y,data:m};if(!v&&!g||z||(N=z=!0),(j||h["cell-mouseenter"])&&(G.mouseenter=function(e){var o={$table:l,seq:t,row:c,rowIndex:i,$rowIndex:d,column:s,columnIndex:a,$columnIndex:u,fixed:r,level:n,cell:e.currentTarget};j&&l.triggerTooltipEvent(e,o),_tools.UtilTools.emitEvent(l,"cell-mouseenter",[o,e])}),(j||h["cell-mouseleave"])&&(G.mouseleave=function(e){l.clostTooltip(),_tools.UtilTools.emitEvent(l,"cell-mouseleave",[{$table:l,seq:t,row:c,rowIndex:i,$rowIndex:d,column:s,columnIndex:a,$columnIndex:u,fixed:r,level:n,cell:e.currentTarget},e])}),G.mousedown=function(e){l.triggerCellMousedownEvent(e,{$table:l,seq:t,row:c,rowIndex:i,$rowIndex:d,column:s,columnIndex:a,$columnIndex:u,fixed:r,level:n,cell:e.currentTarget})},(b||h["cell-click"]||E&&C||P&&("row"===P.trigger||s.treeNode&&"cell"===P.trigger))&&(G.click=function(e){l.triggerCellClickEvent(e,{$table:l,row:c,rowIndex:i,$rowIndex:d,column:s,columnIndex:a,$columnIndex:u,fixed:r,level:n,cell:e.currentTarget})}),(Q||h["cell-dblclick"])&&(G.dblclick=function(e){l.triggerCellDBLClickEvent(e,{$table:l,seq:t,row:c,rowIndex:i,$rowIndex:d,column:s,columnIndex:a,$columnIndex:u,fixed:r,level:n,cell:e.currentTarget})}),$){var ee=$(Z)||{},oe=ee.rowspan,le=void 0===oe?1:oe,te=ee.colspan,re=void 0===te?1:te;if(!le||!re)return null;f={rowspan:le,colspan:re}}return!Y&&C&&C.showStatus&&(x=l.hasRowChange(c,s.property)),Y||r||(M&&(handleLocation(K,D.rows,D.columns,c,s),handleLocation(V,D.tRows,D.tColumns,c,s)),W&&handleLocation(J,X.rows,X.columns,c,s)),e("td",{class:["vxe-body--column",s.id,(p={},_defineProperty(p,"col--".concat(R),R),_defineProperty(p,"col--edit",E),_defineProperty(p,"col--checked",K.active),_defineProperty(p,"col--checked-top",K.top),_defineProperty(p,"col--checked-bottom",K.bottom),_defineProperty(p,"col--checked-left",K.left),_defineProperty(p,"col--checked-right",K.right),_defineProperty(p,"col--checked-temp",V.active),_defineProperty(p,"col--checked-temp-top",V.top),_defineProperty(p,"col--checked-temp-bottom",V.bottom),_defineProperty(p,"col--checked-temp-left",V.left),_defineProperty(p,"col--checked-temp-right",V.right),_defineProperty(p,"col--selected",A&&E&&O.row===c&&O.column===s),_defineProperty(p,"col--copyed",J.active),_defineProperty(p,"col--copyed-top",J.top),_defineProperty(p,"col--copyed-bottom",J.bottom),_defineProperty(p,"col--copyed-left",J.left),_defineProperty(p,"col--copyed-right",J.right),_defineProperty(p,"col--actived",E&&U.row===c&&U.column===s),_defineProperty(p,"col--dirty",x),_defineProperty(p,"col--valid-error",S.row===c&&S.column===s),_defineProperty(p,"edit--visible",E&&"visible"===E.type),_defineProperty(p,"fixed--hidden",Y),p),I?_xeUtils.default.isFunction(I)?I(Z):I:""],key:B||a,attrs:f,on:G},_&&Y?[]:[e("div",{class:["vxe-cell",{"c--title":F,"c--tooltip":j,"c--ellipsis":N}],attrs:{title:F?_tools.UtilTools.getCellLabel(c,s,Z):null},style:{width:z?"".concat(w?H-1:H,"px"):null}},s.renderCell(e,Z)),M&&!r?e("span",{class:"vxe-body--column-checked-lt"}):null,M&&!r?e("span",{class:"vxe-body--column-checked-rb"}):null,W&&!r?e("span",{class:"vxe-body--column-copyed-lt"}):null,W&&!r?e("span",{class:"vxe-body--column-copyed-rb"}):null,K.bottom&&K.right?e("span",{class:"vxe-body--column-checked-corner",on:{mousedown:function(e){l.triggerCornerMousedownEvent({$table:l,seq:t,row:c,rowIndex:i,$rowIndex:d,column:s,columnIndex:a,$columnIndex:u,fixed:r,level:n,cell:e.target.parentNode},e)}}}):null])}function renderRows(a,u,p,f,x,e,h){var m=p.highlightHoverRow,y=p.rowClassName,v=p.selectRow,g=p.hoverRow,w=p.treeConfig,b=p.treeExpandeds,_=p.scrollYLoad,I=p.overflowX,o=p.columnStore,$=p.scrollYStore,T=p.editStore,P=p.expandeds,k=p.getRowMapIndex,C=p.getColumnMapIndex,L=o.leftList,S=o.rightList,E=[];return e.forEach(function(t,r){var e,o={},n=r,c=n+1;_&&(c+=$.startIndex),n=k(t),m&&(L.length||S.length)&&I&&(o.mouseenter=function(e){t!==g&&p.triggerHoverEvent(e,{row:t,rowIndex:n})});var l=_tools.UtilTools.getRowId(p,t,n);if(E.push(a("tr",{class:["vxe-body--row",(e={},_defineProperty(e,"row--level-".concat(f),w),_defineProperty(e,"row--selected",t===v),_defineProperty(e,"row--hover",t===g),_defineProperty(e,"row--new",-1<T.insertList.indexOf(t)),e),y?_xeUtils.default.isFunction(y)?y({$table:p,seq:c,row:t,rowIndex:n}):y:""],attrs:{"data-rowkey":l},key:l,on:o},h.map(function(e,o){var l=C(e);return renderColumn(a,u,p,c,x,f,t,n,r,e,l,o)}))),w&&b.length){var i=t[w.children];i&&i.length&&-1<b.indexOf(t)&&E.push.apply(E,renderRows(a,u,p,f+1,x,i,h))}else if(P.length&&-1<P.indexOf(t)){var d=h.find(function(e){return"expand"===e.type}),s=C(d);d&&E.push(a("tr",{class:["vxe-body--expanded-row"],key:"expand_".concat(n),on:o},[a("td",{class:["vxe-body--expanded-column"],attrs:{colspan:h.length}},[a("div",{class:["vxe-body--expanded-cell"]},[d.renderData(a,{$table:p,seq:c,row:t,rowIndex:n,column:d,columnIndex:s,fixed:x,level:f})])])]))}}),E}function syncBodyScroll(e,o,l){(o||l)&&(o&&(o.onscroll=null,o.scrollTop=e),l&&(l.onscroll=null,l.scrollTop=e),clearTimeout(scrollProcessTimeout),scrollProcessTimeout=setTimeout(function(){o&&(o.onscroll=o._onscroll),l&&(l.onscroll=l._onscroll)},100))}var _default={name:"VxeTableBody",props:{tableData:Array,tableColumn:Array,visibleColumn:Array,collectColumn:Array,fixedColumn:Array,size:String,fixedType:String,isGroup:Boolean},mounted:function(){this.$el.onscroll=this.scrollEvent,this.$el._onscroll=this.scrollEvent},beforeDestroy:function(){this.$el._onscroll=null,this.$el.onscroll=null},render:function(l){var e=this.$parent,o=this.fixedColumn,t=this.fixedType,r=e.maxHeight,n=e.height,c=e.containerHeight,i=e.loading,d=e.tableData,s=e.tableColumn,a=e.headerHeight,u=e.showFooter,p=e.showAllOverflow,f=e.footerHeight,x=e.tableHeight,h=e.tableWidth,m=e.scrollXStore,y=e.scrollXLoad,v=e.scrollYStore,g=e.scrollYLoad,w=e.scrollXHeight,b="auto"===n?c:_xeUtils.default.toNumber(n),_={};return 0<b?_.height="".concat(t?(0<b?b-a-f:x)-(u?0:w):b-a-f,"px"):r&&(r=_xeUtils.default.toNumber(r),_["max-height"]="".concat(t?r-a-(u?0:w):r-a,"px")),t&&p?h=(s=o).reduce(function(e,o){return e+o.renderWidth},0):y&&(t&&(s=o),h=s.reduce(function(e,o){return e+o.renderWidth},0)),l("div",{class:["vxe-table--body-wrapper",t?"fixed--".concat(t,"-wrapper"):"body--wrapper"],attrs:{fixed:t},style:_},[g?l("div",{class:["vxe-body--top-space"],style:{height:"".concat(v.topSpaceHeight,"px")}}):null,!t&&y?l("div",{class:["vxe-body--x-space"],style:{width:"".concat(e.tableWidth,"px")}}):null,l("table",{class:["vxe-table--body"],attrs:{cellspacing:0,cellpadding:0,border:0},style:{width:null===h?h:"".concat(h,"px"),"margin-left":t?null:"".concat(m.leftSpaceWidth,"px")}},[l("colgroup",s.map(function(e,o){return l("col",{attrs:{name:e.id,width:e.renderWidth},key:o})})),l("tbody",renderRows(l,this,e,0,t,d,s))]),t||i||d.length?null:l("div",{class:"vxe-table--empty-block"},[l("span",{class:"vxe-table--empty-text"},e.$slots.empty||_conf.default.i18n("vxe.table.emptyText"))]),g?l("div",{class:["vxe-body--bottom-space"],style:{height:"".concat(v.bottomSpaceHeight,"px")}}):null])},methods:{scrollEvent:function(e){var o=this.$parent,l=this.fixedType,t=o.$refs,r=o.scrollXLoad,n=o.scrollYLoad,c=o.triggerScrollXEvent,i=o.triggerScrollYEvent,d=t.tableHeader,s=t.tableBody,a=t.leftBody,u=t.rightBody,p=d?d.$el:null,f=s.$el,x=a?a.$el:null,h=u?u.$el:null,m=f.scrollTop,y=f.scrollLeft;x&&"left"===l?syncBodyScroll(m=x.scrollTop,f,h):h&&"right"===l?syncBodyScroll(m=h.scrollTop,f,x):(p&&(p.scrollLeft=f.scrollLeft),(x||h)&&(clearTimeout(updateLeftScrollingTimeput),updateLeftScrollingTimeput=setTimeout(o.checkScrolling,_tools.DomTools.browse.msie?200:20),syncBodyScroll(m,x,h))),r&&c(e),n&&i(e),_tools.UtilTools.emitEvent(o,"body-scroll",[{fixed:l,scrollTop:m,scrollLeft:y},e])}}};exports.default=_default;