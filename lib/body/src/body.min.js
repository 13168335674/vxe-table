"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var scrollProcessTimeout,_xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../conf")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,l,o){return l in e?Object.defineProperty(e,l,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[l]=o,e}function renderColumn(e,l,o,t,r,n,c,i,s,a,d,u,p){var f,x,v=o._e,m=o.$listeners,y=o.tableData,w=o.overflowX,g=o.scrollXLoad,b=o.scrollYLoad,h=o.highlightCurrentRow,$=o.showOverflow,_=o.cellClassName,I=o.spanMethod,T=o.treeConfig,C=o.mouseConfig,S=void 0===C?{}:C,k=o.editConfig,E=o.editRules,q=o.validConfig,P=void 0===q?{}:q,R=o.validStore,L=d.editRender,B=d.align,H=d.showOverflow,D=d.columnKey,O=S.checked,U=n?d.fixed!==n:d.fixed&&w,M="ellipsis"===(H||$),A="title"===(H||$),X=!0===H||"tooltip"===H||!0===$||"tooltip"===$,Y=A||X||M,N={},j=R.row===i&&R.column===d,F=E&&(!P.message||"default"===P.message),z={"data-index":u},G=L&&k&&"dblclick"===k.trigger,K={$table:o,$seq:t,seq:r,row:i,rowIndex:s,$rowIndex:a,column:d,columnIndex:u,$columnIndex:p,fixed:n,isHidden:U,level:c,data:y};if(!g&&!b||Y||(M=Y=!0),(X||m["cell-mouseenter"])&&(N.mouseenter=function(e){var l={$table:o,seq:r,row:i,rowIndex:s,$rowIndex:a,column:d,columnIndex:u,$columnIndex:p,fixed:n,isHidden:U,level:c,cell:e.currentTarget};X&&o.triggerTooltipEvent(e,l),_tools.UtilTools.emitEvent(o,"cell-mouseenter",[l,e])}),(X||m["cell-mouseleave"])&&(N.mouseleave=function(e){o.clostTooltip(),_tools.UtilTools.emitEvent(o,"cell-mouseleave",[{$table:o,seq:r,row:i,rowIndex:s,$rowIndex:a,column:d,columnIndex:u,$columnIndex:p,fixed:n,isHidden:U,level:c,cell:e.currentTarget},e])}),N.mousedown=function(e){o.triggerCellMousedownEvent(e,{$table:o,seq:r,row:i,rowIndex:s,$rowIndex:a,column:d,columnIndex:u,$columnIndex:p,fixed:n,isHidden:U,level:c,cell:e.currentTarget})},(h||m["cell-click"]||L&&k||T&&("row"===T.trigger||d.treeNode&&"cell"===T.trigger))&&(N.click=function(e){o.triggerCellClickEvent(e,{$table:o,row:i,rowIndex:s,$rowIndex:a,column:d,columnIndex:u,$columnIndex:p,fixed:n,isHidden:U,level:c,cell:e.currentTarget})}),(G||m["cell-dblclick"])&&(N.dblclick=function(e){o.triggerCellDBLClickEvent(e,{$table:o,seq:r,row:i,rowIndex:s,$rowIndex:a,column:d,columnIndex:u,$columnIndex:p,fixed:n,isHidden:U,level:c,cell:e.currentTarget})}),I){var V=I(K)||{},J=V.rowspan,Q=void 0===J?1:J,W=V.colspan,Z=void 0===W?1:W;if(!Q||!Z)return null;z.rowspan=Q,z.colspan=Z}return!U&&k&&k.showStatus&&(x=o.hasRowChange(i,d.property)),e("td",{class:["vxe-body--column",d.id,(f={},_defineProperty(f,"col--".concat(B),B),_defineProperty(f,"col--edit",L),_defineProperty(f,"col--dirty",x),_defineProperty(f,"col--valid-error",j),_defineProperty(f,"edit--visible",L&&"visible"===L.type),_defineProperty(f,"fixed--hidden",U),f),_?_xeUtils.default.isFunction(_)?_(K):_:""],key:D||u,attrs:z,on:N},$&&U?[]:[e("div",{class:["vxe-cell",{"c--title":A,"c--tooltip":X,"c--ellipsis":M}],attrs:{title:A?_tools.UtilTools.getCellLabel(i,d,K):null}},d.renderCell(e,K)),O?e("span",{class:"vxe-cell--checked-line"}):null,F?j&&2<=y.length?e("div",{class:"vxe-cell--valid",style:R.rule&&R.rule.width?{width:"".concat(R.rule.width,"px")}:null},[e("span",{class:"vxe-cell--valid-msg"},R.content)]):v():null])}function renderRows(d,u,p,f,x,v,e,m){var y=p.highlightHoverRow,w=p.rowClassName,g=p.treeConfig,b=p.treeExpandeds,h=p.scrollYLoad,$=p._scrollYStore,_=p.editStore,I=p.expandeds,T=p.getRowMapIndex,C=p.getColumnMapIndex,S=[];return e.forEach(function(t,r){var e,l={},n=r,c=n+1;h&&(c+=$.startIndex),n=T(t),y&&(l.mouseenter=function(e){p.triggerHoverEvent(e,{row:t,rowIndex:n})});var o=_tools.UtilTools.getRowId(p,t,n);if(S.push(d("tr",{class:["vxe-body--row",(e={},_defineProperty(e,"row--level-".concat(x),g),_defineProperty(e,"row--new",-1<_.insertList.indexOf(t)),e),w?_xeUtils.default.isFunction(w)?w({$table:p,seq:c,row:t,rowIndex:n}):w:""],attrs:{"data-rowid":o},key:o,on:l},m.map(function(e,l){var o=C(e);return renderColumn(d,u,p,f,c,v,x,t,n,r,e,o,l)}))),g&&b.length){var i=t[g.children];i&&i.length&&-1<b.indexOf(t)&&S.push.apply(S,renderRows(d,u,p,f?"".concat(f,".").concat(c):"".concat(c),x+1,v,i,m))}else if(I.length&&-1<I.indexOf(t)){var s=m.find(function(e){return"expand"===e.type}),a=C(s);s&&S.push(d("tr",{class:["vxe-body--expanded-row"],key:"expand_".concat(n),on:l},[d("td",{class:["vxe-body--expanded-column"],attrs:{colspan:m.length}},[d("div",{class:["vxe-body--expanded-cell"]},[s.renderData(d,{$table:p,seq:c,row:t,rowIndex:n,column:s,columnIndex:a,fixed:v,level:x})])])]))}}),S}function syncBodyScroll(e,l,o){(l||o)&&(l&&(l.onscroll=null,l.scrollTop=e),o&&(o.onscroll=null,o.scrollTop=e),clearTimeout(scrollProcessTimeout),scrollProcessTimeout=setTimeout(function(){l&&(l.onscroll=l._onscroll),o&&(o.onscroll=o._onscroll)},100))}var _default={name:"VxeTableBody",props:{tableData:Array,tableColumn:Array,visibleColumn:Array,collectColumn:Array,fixedColumn:Array,size:String,fixedType:String,isGroup:Boolean},mounted:function(){var e=this.$parent,l=this.$el,o=this.$refs,t=this.fixedType,r=e._elemStore,n="".concat(t||"main","-body-");r["".concat(n,"wrapper")]=l,r["".concat(n,"table")]=o.table,r["".concat(n,"colgroup")]=o.colgroup,r["".concat(n,"list")]=o.tbody,r["".concat(n,"x-space")]=o.xSpace,r["".concat(n,"y-space")]=o.ySpace,r["".concat(n,"top-space")]=o.topSpace,this.$el.onscroll=this.scrollEvent,this.$el._onscroll=this.scrollEvent},beforeDestroy:function(){this.$el._onscroll=null,this.$el.onscroll=null},render:function(o){var e=this._e,l=this.$parent,t=this.fixedColumn,r=this.fixedType,n=l.tableData,c=l.tableColumn,i=l.showOverflow,s=l.scrollXLoad;return r&&i?c=t:s&&r&&(c=t),o("div",{class:["vxe-table--body-wrapper",r?"fixed-".concat(r,"--wrapper"):"body--wrapper"],attrs:{fixed:r},on:{mouseleave:l.clearHoverRow}},[r?e():o("div",{class:["vxe-body--x-space"],ref:"xSpace"}),o("div",{class:["vxe-body--y-space"],ref:"ySpace"}),o("div",{class:["vxe-body--top-space"],ref:"topSpace"}),o("table",{class:["vxe-table--body"],attrs:{cellspacing:0,cellpadding:0,border:0},ref:"table"},[o("colgroup",{ref:"colgroup"},c.map(function(e,l){return o("col",{attrs:{name:e.id},key:l})})),o("tbody",{ref:"tbody"},renderRows(o,this,l,"",0,r,n,c))]),r||n.length?null:o("div",{class:"vxe-table--empty-block"},[o("span",{class:"vxe-table--empty-text"},l.$slots.empty||_conf.default.i18n("vxe.table.emptyText"))])])},methods:{scrollEvent:function(e){var l=this.$parent,o=this.fixedType,t=l.$refs,r=l.scrollXLoad,n=l.scrollYLoad,c=t.tableHeader,i=t.tableBody,s=t.leftBody,a=t.rightBody,d=c?c.$el:null,u=i.$el,p=s?s.$el:null,f=a?a.$el:null,x=u.scrollTop,v=u.scrollLeft;p&&"left"===o?syncBodyScroll(x=p.scrollTop,u,f):f&&"right"===o?syncBodyScroll(x=f.scrollTop,u,p):(d&&(d.scrollLeft=u.scrollLeft),(p||f)&&(l.checkScrolling(),syncBodyScroll(x,p,f))),r&&l.triggerScrollXEvent(e),n&&l.triggerScrollYEvent(e),_tools.UtilTools.emitEvent(l,"scroll",[{type:"body",fixed:o,scrollTop:x,scrollLeft:v,$table:l},e])}}};exports.default=_default;