"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var scrollProcessTimeout,_xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../conf")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,l,o){return l in e?Object.defineProperty(e,l,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[l]=o,e}function renderColumn(e,l,o,r,t,n,c,s,i,d,a,u,f){var p,x,v=o._e,b=o.$listeners,y=o.tableData,g=o.overflowX,m=o.scrollXLoad,w=o.scrollYLoad,h=o.highlightCurrentRow,_=o.showOverflow,$=o.cellClassName,T=o.spanMethod,I=o.radioConfig,C=void 0===I?{}:I,S=o.selectConfig,k=void 0===S?{}:S,R=o.treeConfig,L=void 0===R?{}:R,P=o.mouseConfig,E=void 0===P?{}:P,q=o.editConfig,B=o.editRules,U=o.validConfig,H=void 0===U?{}:U,D=o.editStore,O=o.validStore,M=a.editRender,X=a.align,Y=a.showOverflow,A=a.columnKey,N=D.actived,z=n?a.fixed!==n:a.fixed&&g,j=_xeUtils.default.isUndefined(Y)||_xeUtils.default.isNull(Y)?_:Y,F="ellipsis"===j,G="title"===j,K=!0===j||"tooltip"===j,V=G||K||F,J={},Q=O.row===s&&O.column===a,W=B&&(!H.message||"default"===H.message),Z={"data-index":u},ee=M&&q&&"dblclick"===q.trigger,le={$table:o,$seq:r,seq:t,row:s,rowIndex:i,$rowIndex:d,column:a,columnIndex:u,$columnIndex:f,fixed:n,isHidden:z,level:c,data:y};if(!m&&!w||V||(F=!0),(K||b["cell-mouseenter"])&&(J.mouseenter=function(e){if(!o._isResize){var l={$table:o,seq:t,row:s,rowIndex:i,$rowIndex:d,column:a,columnIndex:u,$columnIndex:f,fixed:n,isHidden:z,level:c,cell:e.currentTarget};K&&o.triggerTooltipEvent(e,l),_tools.UtilTools.emitEvent(o,"cell-mouseenter",[l,e])}}),(K||b["cell-mouseleave"])&&(J.mouseleave=function(e){o._isResize||(o.clostTooltip(),_tools.UtilTools.emitEvent(o,"cell-mouseleave",[{$table:o,seq:t,row:s,rowIndex:i,$rowIndex:d,column:a,columnIndex:u,$columnIndex:f,fixed:n,isHidden:z,level:c,cell:e.currentTarget},e]))}),(E.checked||E.selected)&&(J.mousedown=function(e){o.triggerCellMousedownEvent(e,{$table:o,seq:t,row:s,rowIndex:i,$rowIndex:d,column:a,columnIndex:u,$columnIndex:f,fixed:n,isHidden:z,level:c,cell:e.currentTarget})}),(h||b["cell-click"]||E.checked||M&&q||"row"===C.trigger||"radio"===a.type&&"cell"===C.trigger||"row"===k.trigger||"selection"===a.type&&"cell"===k.trigger||"row"===L.trigger||a.treeNode&&"cell"===L.trigger)&&(J.click=function(e){o.triggerCellClickEvent(e,{$table:o,row:s,rowIndex:i,$rowIndex:d,column:a,columnIndex:u,$columnIndex:f,fixed:n,isHidden:z,level:c,cell:e.currentTarget})}),(ee||b["cell-dblclick"])&&(J.dblclick=function(e){o.triggerCellDBLClickEvent(e,{$table:o,seq:t,row:s,rowIndex:i,$rowIndex:d,column:a,columnIndex:u,$columnIndex:f,fixed:n,isHidden:z,level:c,cell:e.currentTarget})}),T){var oe=T(le)||{},re=oe.rowspan,te=void 0===re?1:re,ne=oe.colspan,ce=void 0===ne?1:ne;if(!te||!ce)return null;Z.rowspan=te,Z.colspan=ce}return!z&&q&&q.showStatus&&(x=o.hasRowChange(s,a.property)),e("td",{class:["vxe-body--column",a.id,(p={},_defineProperty(p,"col--".concat(X),X),_defineProperty(p,"col--edit",M),_defineProperty(p,"col--index","index"===a.type),_defineProperty(p,"col--ellipsis",V),_defineProperty(p,"edit--visible",M&&"visible"===M.type),_defineProperty(p,"fixed--hidden",z),_defineProperty(p,"col--dirty",x),_defineProperty(p,"col--actived",q&&M&&N.row===s&&(N.column===a||"row"===q.mode)),_defineProperty(p,"col--valid-error",Q),p),$?_xeUtils.default.isFunction($)?$(le):$:""],key:A||u,attrs:Z,on:J},_&&z?[]:[e("div",{class:["vxe-cell",{"c--title":G,"c--tooltip":K,"c--ellipsis":F}],attrs:{title:G?_tools.UtilTools.getCellLabel(s,a,le):null}},a.renderCell(e,le)),W?Q&&2<=y.length?e("div",{class:"vxe-cell--valid",style:O.rule&&O.rule.width?{width:"".concat(O.rule.width,"px")}:null},[e("span",{class:"vxe-cell--valid-msg"},O.content)]):v():null])}function renderRows(a,u,f,p,x,v,e,b){var y=f.highlightHoverRow,g=f.rowClassName,m=f.treeConfig,w=f.treeExpandeds,h=f.scrollYLoad,_=f.scrollYStore,$=f.editStore,T=f.expandeds,I=f.getRowMapIndex,C=f.getColumnMapIndex,S=[];return e.forEach(function(r,t){var e,l={},n=t,c=n+1;h&&(c+=_.startIndex),n=I(r),y&&(l.mouseenter=function(e){f.triggerHoverEvent(e,{row:r,rowIndex:n})});var o=_tools.UtilTools.getRowId(f,r,n);if(S.push(a("tr",{class:["vxe-body--row",(e={},_defineProperty(e,"row--level-".concat(x),m),_defineProperty(e,"row--new",-1<$.insertList.indexOf(r)),e),g?_xeUtils.default.isFunction(g)?g({$table:f,seq:c,row:r,rowIndex:n}):g:""],attrs:{"data-rowid":o},key:o,on:l},b.map(function(e,l){var o=C(e);return renderColumn(a,u,f,p,c,v,x,r,n,t,e,o,l)}))),m&&w.length){var s=r[m.children];s&&s.length&&-1<w.indexOf(r)&&S.push.apply(S,renderRows(a,u,f,p?"".concat(p,".").concat(c):"".concat(c),x+1,v,s,b))}else if(T.length&&-1<T.indexOf(r)){var i=b.find(function(e){return"expand"===e.type}),d=C(i);i&&S.push(a("tr",{class:["vxe-body--expanded-row"],key:"expand_".concat(n),on:l},[a("td",{class:["vxe-body--expanded-column"],attrs:{colspan:b.length}},[a("div",{class:["vxe-body--expanded-cell"]},[i.renderData(a,{$table:f,seq:c,row:r,rowIndex:n,column:i,columnIndex:d,fixed:v,level:x})])])]))}}),S}function syncBodyScroll(e,l,o){(l||o)&&(l&&(l.onscroll=null,l.scrollTop=e),o&&(o.onscroll=null,o.scrollTop=e),clearTimeout(scrollProcessTimeout),scrollProcessTimeout=setTimeout(function(){l&&(l.onscroll=l._onscroll),o&&(o.onscroll=o._onscroll)},100))}var _default={name:"VxeTableBody",props:{tableData:Array,tableColumn:Array,visibleColumn:Array,collectColumn:Array,fixedColumn:Array,size:String,fixedType:String,isGroup:Boolean},mounted:function(){var e=this.$parent,l=this.$el,o=this.$refs,r=this.fixedType,t=e.elemStore,n="".concat(r||"main","-body-");t["".concat(n,"wrapper")]=l,t["".concat(n,"table")]=o.table,t["".concat(n,"colgroup")]=o.colgroup,t["".concat(n,"list")]=o.tbody,t["".concat(n,"xSpace")]=o.xSpace,t["".concat(n,"ySpace")]=o.ySpace,this.$el.onscroll=this.scrollEvent,this.$el._onscroll=this.scrollEvent},beforeDestroy:function(){this.$el._onscroll=null,this.$el.onscroll=null},render:function(o){var e=this._e,l=this.$parent,r=this.fixedColumn,t=this.fixedType,n=l.tableData,c=l.tableColumn,s=l.showOverflow,i=l.scrollXLoad,d=l.mouseConfig,a=void 0===d?{}:d,u=l.keyboardConfig,f=void 0===u?{}:u;return t&&s?c=r:i&&t&&(c=r),o("div",{class:["vxe-table--body-wrapper",t?"fixed-".concat(t,"--wrapper"):"body--wrapper"],attrs:{fixed:t},on:{mouseleave:l.clearHoverRow}},[t?e():o("div",{class:"vxe-body--x-space",ref:"xSpace"}),o("div",{class:"vxe-body--y-space",ref:"ySpace"}),o("table",{class:"vxe-table--body",attrs:{cellspacing:0,cellpadding:0,border:0},ref:"table"},[o("colgroup",{ref:"colgroup"},c.map(function(e,l){return o("col",{attrs:{name:e.id},key:l})})),o("tbody",{ref:"tbody"},renderRows(o,this,l,"",0,t,n,c))]),t?null:o("div",{class:"vxe-table--borders"},[a.checked?o("div",{class:"vxe-table-checked-borders",ref:"checkBorders"},[o("span",{class:"vxe-table-border-top",ref:"checkTop"}),o("span",{class:"vxe-table-border-right",ref:"checkRight"}),o("span",{class:"vxe-table-border-bottom",ref:"checkBottom"}),o("span",{class:"vxe-table-border-left",ref:"checkLeft"})]):null,f.isCut?o("div",{class:"vxe-table-copyed-borders",ref:"copyBorders"},[o("span",{class:"vxe-table-border-top",ref:"copyTop"}),o("span",{class:"vxe-table-border-right",ref:"copyRight"}),o("span",{class:"vxe-table-border-bottom",ref:"copyBottom"}),o("span",{class:"vxe-table-border-left",ref:"copyLeft"})]):null]),t||n.length?null:o("div",{class:"vxe-table--empty-block"},[o("span",{class:"vxe-table--empty-text"},l.$slots.empty||_conf.default.i18n("vxe.table.emptyText"))])])},methods:{scrollEvent:function(e){var l=this.$parent,o=this.fixedType,r=l.$refs,t=l.scrollXLoad,n=l.scrollYLoad,c=l.lastScrollTop,s=l.lastScrollLeft,i=r.tableHeader,d=r.tableBody,a=r.leftBody,u=r.rightBody,f=i?i.$el:null,p=d.$el,x=a?a.$el:null,v=u?u.$el:null,b=p.scrollTop,y=p.scrollLeft,g=y!==s,m=b!==c;l.lastScrollTop=b,l.lastScrollLeft=y,x&&"left"===o?syncBodyScroll(b=x.scrollTop,p,v):v&&"right"===o?syncBodyScroll(b=v.scrollTop,p,x):(g&&f&&(f.scrollLeft=p.scrollLeft),(x||v)&&(l.checkScrolling(),m&&syncBodyScroll(b,x,v))),t&&g?l.triggerScrollXEvent(e):n&&m&&l.triggerScrollYEvent(e),_tools.UtilTools.emitEvent(l,"scroll",[{type:"body",fixed:o,scrollTop:b,scrollLeft:y,isX:g,isY:m,$table:l},e])}}};exports.default=_default;