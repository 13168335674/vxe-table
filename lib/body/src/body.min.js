"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var scrollProcessTimeout,updateLeftScrollingTimeput,_xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../conf")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,o,l){return o in e?Object.defineProperty(e,o,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[o]=l,e}function handleLocation(e,o,l,t,r){var n=o.indexOf(t),c=l.indexOf(r);e.active=-1<n&&-1<c,e.top=0===n&&-1<c,e.bottom=n===o.length-1&&-1<c,e.left=-1<n&&0===c,e.right=-1<n&&c===l.length-1}function renderColumn(e,o,l,t,r,n,c,i,d,s,a,u){var p,f,x=l._e,h=l.$listeners,m=l.tableData,v=l.overflowX,y=l.scrollXLoad,g=l.scrollYLoad,w=l.border,b=l.highlightCurrentRow,_=l.showOverflow,T=l.showAllOverflow,$=l.selectColumn,I=l.cellClassName,P=l.spanMethod,k=l.keyboardConfig,C=l.treeConfig,L=l.mouseConfig,S=l.editConfig,R=l.editRules,E=l.editStore,q=l.validStore,B=_xeUtils.default.isBoolean(T)?T:_,H=s.editRender,O=s.align,U=s.showOverflow,D=s.renderWidth,Y=s.columnKey,W=E.checked,X=E.selected,A=E.actived,M=E.copyed,N=L&&L.selected,F=L&&L.checked,j=k&&k.isCut,z=r?s.fixed!==r:s.fixed&&v,G="ellipsis"===(U||B),K="title"===(U||B),V=!0===U||"tooltip"===U||!0===B||"tooltip"===B,J=K||V||G,Q={},Z={},ee={},oe={},le=q.row===c&&q.column===s,te=S&&R&&(!S.validTip||"default"===S.validTip),re={"data-index":a},ne=H&&S&&"dblclick"===S.trigger,ce={$table:l,seq:t,row:c,rowIndex:i,$rowIndex:d,column:s,columnIndex:a,$columnIndex:u,fixed:r,level:n,isHidden:z,data:m};if(!y&&!g||J||(G=J=!0),(V||h["cell-mouseenter"])&&(Q.mouseenter=function(e){var o={$table:l,seq:t,row:c,rowIndex:i,$rowIndex:d,column:s,columnIndex:a,$columnIndex:u,fixed:r,level:n,cell:e.currentTarget};V&&l.triggerTooltipEvent(e,o),_tools.UtilTools.emitEvent(l,"cell-mouseenter",[o,e])}),(V||h["cell-mouseleave"])&&(Q.mouseleave=function(e){l.clostTooltip(),_tools.UtilTools.emitEvent(l,"cell-mouseleave",[{$table:l,seq:t,row:c,rowIndex:i,$rowIndex:d,column:s,columnIndex:a,$columnIndex:u,fixed:r,level:n,cell:e.currentTarget},e])}),Q.mousedown=function(e){l.triggerCellMousedownEvent(e,{$table:l,seq:t,row:c,rowIndex:i,$rowIndex:d,column:s,columnIndex:a,$columnIndex:u,fixed:r,level:n,cell:e.currentTarget})},(b||h["cell-click"]||H&&S||C&&("row"===C.trigger||s.treeNode&&"cell"===C.trigger))&&(Q.click=function(e){l.triggerCellClickEvent(e,{$table:l,row:c,rowIndex:i,$rowIndex:d,column:s,columnIndex:a,$columnIndex:u,fixed:r,level:n,cell:e.currentTarget})}),(ne||h["cell-dblclick"])&&(Q.dblclick=function(e){l.triggerCellDBLClickEvent(e,{$table:l,seq:t,row:c,rowIndex:i,$rowIndex:d,column:s,columnIndex:a,$columnIndex:u,fixed:r,level:n,cell:e.currentTarget})}),P){var ie=P(ce)||{},de=ie.rowspan,se=void 0===de?1:de,ae=ie.colspan,ue=void 0===ae?1:ae;if(!se||!ue)return null;re.rowspan=se,re.colspan=ue}return!z&&S&&S.showStatus&&(f=l.hasRowChange(c,s.property)),z||r||(F&&(handleLocation(Z,W.rows,W.columns,c,s),handleLocation(ee,W.tRows,W.tColumns,c,s)),j&&handleLocation(oe,M.rows,M.columns,c,s)),e("td",{class:["vxe-body--column",s.id,(p={},_defineProperty(p,"col--".concat(O),O),_defineProperty(p,"col--edit",H),_defineProperty(p,"col--checked",Z.active),_defineProperty(p,"col--checked-top",Z.top),_defineProperty(p,"col--checked-bottom",Z.bottom),_defineProperty(p,"col--checked-left",Z.left),_defineProperty(p,"col--checked-right",Z.right),_defineProperty(p,"col--checked-temp",ee.active),_defineProperty(p,"col--checked-temp-top",ee.top),_defineProperty(p,"col--checked-temp-bottom",ee.bottom),_defineProperty(p,"col--checked-temp-left",ee.left),_defineProperty(p,"col--checked-temp-right",ee.right),_defineProperty(p,"col--selected",N&&H&&X.row===c&&X.column===s),_defineProperty(p,"col--copyed",oe.active),_defineProperty(p,"col--copyed-top",oe.top),_defineProperty(p,"col--copyed-bottom",oe.bottom),_defineProperty(p,"col--copyed-left",oe.left),_defineProperty(p,"col--copyed-right",oe.right),_defineProperty(p,"col--actived",H&&A.row===c&&A.column===s),_defineProperty(p,"col--dirty",f),_defineProperty(p,"col--valid-error",le),_defineProperty(p,"col--current",$===s),_defineProperty(p,"edit--visible",H&&"visible"===H.type),_defineProperty(p,"fixed--hidden",z),p),I?_xeUtils.default.isFunction(I)?I(ce):I:""],key:Y||a,attrs:re,on:Q},B&&z?[]:[e("div",{class:["vxe-cell",{"c--title":K,"c--tooltip":V,"c--ellipsis":G}],attrs:{title:K?_tools.UtilTools.getCellLabel(c,s,ce):null},style:{width:J?"".concat(w?D-1:D,"px"):null}},s.renderCell(e,ce)),te?le&&2<=m.length?e("div",{class:"vxe-cell--valid"},[e("span",{class:"vxe-cell--valid-msg"},q.content)]):x():null,F&&!r?e("span",{class:"vxe-body--column-checked-lt"}):null,F&&!r?e("span",{class:"vxe-body--column-checked-rb"}):null,j&&!r?e("span",{class:"vxe-body--column-copyed-lt"}):null,j&&!r?e("span",{class:"vxe-body--column-copyed-rb"}):null,Z.bottom&&Z.right?e("span",{class:"vxe-body--column-checked-corner",on:{mousedown:function(e){l.triggerCornerMousedownEvent({$table:l,seq:t,row:c,rowIndex:i,$rowIndex:d,column:s,columnIndex:a,$columnIndex:u,fixed:r,level:n,cell:e.target.parentNode},e)}}}):null])}function renderRows(a,u,p,f,x,e,h){var m=p.highlightHoverRow,v=p.rowClassName,y=p.selectRow,g=p.hoverRow,w=p.treeConfig,b=p.treeExpandeds,_=p.scrollYLoad,T=p.overflowX,o=p.columnStore,$=p.scrollYStore,I=p.editStore,P=p.expandeds,k=p.getRowMapIndex,C=p.getColumnMapIndex,L=o.leftList,S=o.rightList,R=[];return e.forEach(function(t,r){var e,o={},n=r,c=n+1;_&&(c+=$.startIndex),n=k(t),m&&(L.length||S.length)&&T&&(o.mouseenter=function(e){t!==g&&p.triggerHoverEvent(e,{row:t,rowIndex:n})},o.mouseleave=function(e){p.hoverRow=null});var l=_tools.UtilTools.getRowId(p,t,n);if(R.push(a("tr",{class:["vxe-body--row",(e={},_defineProperty(e,"row--level-".concat(f),w),_defineProperty(e,"row--current",t===y),_defineProperty(e,"row--hover",t===g),_defineProperty(e,"row--new",-1<I.insertList.indexOf(t)),e),v?_xeUtils.default.isFunction(v)?v({$table:p,seq:c,row:t,rowIndex:n}):v:""],attrs:{"data-rowid":l},key:l,on:o},h.map(function(e,o){var l=C(e);return renderColumn(a,u,p,c,x,f,t,n,r,e,l,o)}))),w&&b.length){var i=t[w.children];i&&i.length&&-1<b.indexOf(t)&&R.push.apply(R,renderRows(a,u,p,f+1,x,i,h))}else if(P.length&&-1<P.indexOf(t)){var d=h.find(function(e){return"expand"===e.type}),s=C(d);d&&R.push(a("tr",{class:["vxe-body--expanded-row"],key:"expand_".concat(n),on:o},[a("td",{class:["vxe-body--expanded-column"],attrs:{colspan:h.length}},[a("div",{class:["vxe-body--expanded-cell"]},[d.renderData(a,{$table:p,seq:c,row:t,rowIndex:n,column:d,columnIndex:s,fixed:x,level:f})])])]))}}),R}function syncBodyScroll(e,o,l){(o||l)&&(o&&(o.onscroll=null,o.scrollTop=e),l&&(l.onscroll=null,l.scrollTop=e),clearTimeout(scrollProcessTimeout),scrollProcessTimeout=setTimeout(function(){o&&(o.onscroll=o._onscroll),l&&(l.onscroll=l._onscroll)},100))}var _default={name:"VxeTableBody",props:{tableData:Array,tableColumn:Array,visibleColumn:Array,collectColumn:Array,fixedColumn:Array,size:String,fixedType:String,isGroup:Boolean},mounted:function(){this.$el.onscroll=this.scrollEvent,this.$el._onscroll=this.scrollEvent},beforeDestroy:function(){this.$el._onscroll=null,this.$el.onscroll=null},render:function(l){var e=this.$parent,o=this.fixedColumn,t=this.fixedType,r=e.maxHeight,n=e.height,c=e.containerHeight,i=e.loading,d=e.tableData,s=e.tableColumn,a=e.headerHeight,u=e.showFooter,p=e.showOverflow,f=e.showAllOverflow,x=e.footerHeight,h=e.tableHeight,m=e.tableWidth,v=e.overflowY,y=e.scrollXHeight,g=e.scrollYWidth,w=e.scrollXStore,b=e.scrollXLoad,_=e.scrollYStore,T=e.scrollYLoad,$=_xeUtils.default.isBoolean(f)?f:p,I="auto"===n?c:_xeUtils.default.toNumber(n),P={};0<I?P.height="".concat(t?(0<I?I-a-x:h)-(u?0:y):I-a-x,"px"):r&&(r=_xeUtils.default.toNumber(r),P["max-height"]="".concat(t?r-a-(u?0:y):r-a,"px")),t&&$?m=(s=o).reduce(function(e,o){return e+o.renderWidth},0):b&&(t&&(s=o),m=s.reduce(function(e,o){return e+o.renderWidth},0));var k={width:m?"".concat(m,"px"):m,marginLeft:t?null:"".concat(w.leftSpaceWidth,"px")};return v&&t&&_tools.DomTools.browse["-moz"]&&(k.paddingRight="".concat(g,"px")),l("div",{class:["vxe-table--body-wrapper",t?"fixed--".concat(t,"-wrapper"):"body--wrapper"],attrs:{fixed:t},style:P},[T?l("div",{class:["vxe-body--top-space"],style:{height:"".concat(_.topSpaceHeight,"px")}}):null,!t&&b?l("div",{class:["vxe-body--x-space"],style:{width:"".concat(e.tableWidth,"px")}}):null,l("table",{class:["vxe-table--body"],attrs:{cellspacing:0,cellpadding:0,border:0},style:k},[l("colgroup",s.map(function(e,o){return l("col",{attrs:{name:e.id,width:e.renderWidth},key:o})})),l("tbody",renderRows(l,this,e,0,t,d,s))]),t||i||d.length?null:l("div",{class:"vxe-table--empty-block"},[l("span",{class:"vxe-table--empty-text"},e.$slots.empty||_conf.default.i18n("vxe.table.emptyText"))]),T?l("div",{class:["vxe-body--bottom-space"],style:{height:"".concat(_.bottomSpaceHeight,"px")}}):null])},methods:{scrollEvent:function(e){var o=this.$parent,l=this.fixedType,t=o.$refs,r=o.scrollXLoad,n=o.scrollYLoad,c=o.triggerScrollXEvent,i=o.triggerScrollYEvent,d=t.tableHeader,s=t.tableBody,a=t.leftBody,u=t.rightBody,p=d?d.$el:null,f=s.$el,x=a?a.$el:null,h=u?u.$el:null,m=f.scrollTop,v=f.scrollLeft;x&&"left"===l?syncBodyScroll(m=x.scrollTop,f,h):h&&"right"===l?syncBodyScroll(m=h.scrollTop,f,x):(p&&(p.scrollLeft=f.scrollLeft),(x||h)&&(clearTimeout(updateLeftScrollingTimeput),updateLeftScrollingTimeput=setTimeout(o.checkScrolling,_tools.DomTools.browse.msie?200:20),syncBodyScroll(m,x,h))),r&&c(e),n&&i(e),_tools.UtilTools.emitEvent(o,"scroll",[{type:"body",fixed:l,scrollTop:m,scrollLeft:v,$table:o},e])}}};exports.default=_default;