"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var scrollProcessTimeout,updateLeftScrollingTimeput,_xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../conf")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,o,l){return o in e?Object.defineProperty(e,o,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[o]=l,e}function handleLocation(e,o,l,t,r){var n=o.indexOf(t),c=l.indexOf(r);e.active=-1<n&&-1<c,e.top=0===n&&-1<c,e.bottom=n===o.length-1&&-1<c,e.left=-1<n&&0===c,e.right=-1<n&&c===l.length-1}function renderColumn(e,o,l,t,r,n,c,i,d,s,a,u){var p,f,x=l._e,h=l.$listeners,m=l.tableData,v=l.overflowX,y=l.scrollXLoad,g=l.scrollYLoad,w=l.border,b=l.highlightCurrentRow,_=l.showOverflow,$=l.showAllOverflow,I=l.selectColumn,T=l.cellClassName,P=l.spanMethod,C=l.keyboardConfig,k=l.treeConfig,L=l.mouseConfig,S=l.editConfig,R=l.editRules,E=l.validConfig,q=void 0===E?{}:E,B=l.editStore,H=l.validStore,O=_xeUtils.default.isBoolean($)?$:_,U=s.editRender,D=s.align,Y=s.showOverflow,W=s.renderWidth,X=s.columnKey,A=B.checked,M=B.selected,N=B.actived,F=B.copyed,j=L&&L.selected,z=L&&L.checked,G=C&&C.isCut,K=r?s.fixed!==r:s.fixed&&v,V="ellipsis"===(Y||O),J="title"===(Y||O),Q=!0===Y||"tooltip"===Y||!0===O||"tooltip"===O,Z=J||Q||V,ee={},oe={},le={},te={},re=H.row===c&&H.column===s,ne=R&&(!q.message||"default"===q.message),ce={"data-index":a},ie=U&&S&&"dblclick"===S.trigger,de={$table:l,seq:t,row:c,rowIndex:i,$rowIndex:d,column:s,columnIndex:a,$columnIndex:u,fixed:r,level:n,isHidden:K,data:m};if(!y&&!g||Z||(V=Z=!0),(Q||h["cell-mouseenter"])&&(ee.mouseenter=function(e){var o={$table:l,seq:t,row:c,rowIndex:i,$rowIndex:d,column:s,columnIndex:a,$columnIndex:u,fixed:r,level:n,cell:e.currentTarget};Q&&l.triggerTooltipEvent(e,o),_tools.UtilTools.emitEvent(l,"cell-mouseenter",[o,e])}),(Q||h["cell-mouseleave"])&&(ee.mouseleave=function(e){l.clostTooltip(),_tools.UtilTools.emitEvent(l,"cell-mouseleave",[{$table:l,seq:t,row:c,rowIndex:i,$rowIndex:d,column:s,columnIndex:a,$columnIndex:u,fixed:r,level:n,cell:e.currentTarget},e])}),ee.mousedown=function(e){l.triggerCellMousedownEvent(e,{$table:l,seq:t,row:c,rowIndex:i,$rowIndex:d,column:s,columnIndex:a,$columnIndex:u,fixed:r,level:n,cell:e.currentTarget})},(b||h["cell-click"]||U&&S||k&&("row"===k.trigger||s.treeNode&&"cell"===k.trigger))&&(ee.click=function(e){l.triggerCellClickEvent(e,{$table:l,row:c,rowIndex:i,$rowIndex:d,column:s,columnIndex:a,$columnIndex:u,fixed:r,level:n,cell:e.currentTarget})}),(ie||h["cell-dblclick"])&&(ee.dblclick=function(e){l.triggerCellDBLClickEvent(e,{$table:l,seq:t,row:c,rowIndex:i,$rowIndex:d,column:s,columnIndex:a,$columnIndex:u,fixed:r,level:n,cell:e.currentTarget})}),P){var se=P(de)||{},ae=se.rowspan,ue=void 0===ae?1:ae,pe=se.colspan,fe=void 0===pe?1:pe;if(!ue||!fe)return null;ce.rowspan=ue,ce.colspan=fe}return!K&&S&&S.showStatus&&(f=l.hasRowChange(c,s.property)),K||r||(z&&(handleLocation(oe,A.rows,A.columns,c,s),handleLocation(le,A.tRows,A.tColumns,c,s)),G&&handleLocation(te,F.rows,F.columns,c,s)),e("td",{class:["vxe-body--column",s.id,(p={},_defineProperty(p,"col--".concat(D),D),_defineProperty(p,"col--edit",U),_defineProperty(p,"col--checked",oe.active),_defineProperty(p,"col--checked-top",oe.top),_defineProperty(p,"col--checked-bottom",oe.bottom),_defineProperty(p,"col--checked-left",oe.left),_defineProperty(p,"col--checked-right",oe.right),_defineProperty(p,"col--checked-temp",le.active),_defineProperty(p,"col--checked-temp-top",le.top),_defineProperty(p,"col--checked-temp-bottom",le.bottom),_defineProperty(p,"col--checked-temp-left",le.left),_defineProperty(p,"col--checked-temp-right",le.right),_defineProperty(p,"col--selected",j&&U&&M.row===c&&M.column===s),_defineProperty(p,"col--copyed",te.active),_defineProperty(p,"col--copyed-top",te.top),_defineProperty(p,"col--copyed-bottom",te.bottom),_defineProperty(p,"col--copyed-left",te.left),_defineProperty(p,"col--copyed-right",te.right),_defineProperty(p,"col--actived",U&&N.row===c&&N.column===s),_defineProperty(p,"col--dirty",f),_defineProperty(p,"col--valid-error",re),_defineProperty(p,"col--current",I===s),_defineProperty(p,"edit--visible",U&&"visible"===U.type),_defineProperty(p,"fixed--hidden",K),p),T?_xeUtils.default.isFunction(T)?T(de):T:""],key:X||a,attrs:ce,on:ee},O&&K?[]:[e("div",{class:["vxe-cell",{"c--title":J,"c--tooltip":Q,"c--ellipsis":V}],attrs:{title:J?_tools.UtilTools.getCellLabel(c,s,de):null},style:{width:Z?"".concat(w?W-1:W,"px"):null}},s.renderCell(e,de)),ne?re&&2<=m.length?e("div",{class:"vxe-cell--valid",style:H.rule&&H.rule.width?{width:"".concat(H.rule.width,"px")}:null},[e("span",{class:"vxe-cell--valid-msg"},H.content)]):x():null,z&&!r?e("span",{class:"vxe-body--column-checked-lt"}):null,z&&!r?e("span",{class:"vxe-body--column-checked-rb"}):null,G&&!r?e("span",{class:"vxe-body--column-copyed-lt"}):null,G&&!r?e("span",{class:"vxe-body--column-copyed-rb"}):null,oe.bottom&&oe.right?e("span",{class:"vxe-body--column-checked-corner",on:{mousedown:function(e){l.triggerCornerMousedownEvent({$table:l,seq:t,row:c,rowIndex:i,$rowIndex:d,column:s,columnIndex:a,$columnIndex:u,fixed:r,level:n,cell:e.target.parentNode},e)}}}):null])}function renderRows(a,u,p,f,x,e,h){var m=p.highlightHoverRow,v=p.rowClassName,y=p.selectRow,g=p.hoverRow,w=p.treeConfig,b=p.treeExpandeds,_=p.scrollYLoad,$=p.overflowX,o=p.columnStore,I=p.scrollYStore,T=p.editStore,P=p.expandeds,C=p.getRowMapIndex,k=p.getColumnMapIndex,L=o.leftList,S=o.rightList,R=[];return e.forEach(function(t,r){var e,o={},n=r,c=n+1;_&&(c+=I.startIndex),n=C(t),m&&(L.length||S.length)&&$&&(o.mouseenter=function(e){t!==g&&p.triggerHoverEvent(e,{row:t,rowIndex:n})},o.mouseleave=function(e){p.hoverRow=null});var l=_tools.UtilTools.getRowId(p,t,n);if(R.push(a("tr",{class:["vxe-body--row",(e={},_defineProperty(e,"row--level-".concat(f),w),_defineProperty(e,"row--current",t===y),_defineProperty(e,"row--hover",t===g),_defineProperty(e,"row--new",-1<T.insertList.indexOf(t)),e),v?_xeUtils.default.isFunction(v)?v({$table:p,seq:c,row:t,rowIndex:n}):v:""],attrs:{"data-rowid":l},key:l,on:o},h.map(function(e,o){var l=k(e);return renderColumn(a,u,p,c,x,f,t,n,r,e,l,o)}))),w&&b.length){var i=t[w.children];i&&i.length&&-1<b.indexOf(t)&&R.push.apply(R,renderRows(a,u,p,f+1,x,i,h))}else if(P.length&&-1<P.indexOf(t)){var d=h.find(function(e){return"expand"===e.type}),s=k(d);d&&R.push(a("tr",{class:["vxe-body--expanded-row"],key:"expand_".concat(n),on:o},[a("td",{class:["vxe-body--expanded-column"],attrs:{colspan:h.length}},[a("div",{class:["vxe-body--expanded-cell"]},[d.renderData(a,{$table:p,seq:c,row:t,rowIndex:n,column:d,columnIndex:s,fixed:x,level:f})])])]))}}),R}function syncBodyScroll(e,o,l){(o||l)&&(o&&(o.onscroll=null,o.scrollTop=e),l&&(l.onscroll=null,l.scrollTop=e),clearTimeout(scrollProcessTimeout),scrollProcessTimeout=setTimeout(function(){o&&(o.onscroll=o._onscroll),l&&(l.onscroll=l._onscroll)},100))}var _default={name:"VxeTableBody",props:{tableData:Array,tableColumn:Array,visibleColumn:Array,collectColumn:Array,fixedColumn:Array,size:String,fixedType:String,isGroup:Boolean},mounted:function(){this.$el.onscroll=this.scrollEvent,this.$el._onscroll=this.scrollEvent},beforeDestroy:function(){this.$el._onscroll=null,this.$el.onscroll=null},render:function(l){var e=this.$parent,o=this.fixedColumn,t=this.fixedType,r=e.maxHeight,n=e.height,c=e.containerHeight,i=e.loading,d=e.tableData,s=e.tableColumn,a=e.headerHeight,u=e.showFooter,p=e.showOverflow,f=e.showAllOverflow,x=e.footerHeight,h=e.tableHeight,m=e.tableWidth,v=e.overflowY,y=e.scrollXHeight,g=e.scrollYWidth,w=e.scrollXStore,b=e.scrollXLoad,_=e.scrollYStore,$=e.scrollYLoad,I=_xeUtils.default.isBoolean(f)?f:p,T="auto"===n?c:_xeUtils.default.toNumber(n),P={};0<T?P.height="".concat(t?(0<T?T-a-x:h)-(u?0:y):T-a-x,"px"):r&&(r=_xeUtils.default.toNumber(r),P["max-height"]="".concat(t?r-a-(u?0:y):r-a,"px")),t&&I?m=(s=o).reduce(function(e,o){return e+o.renderWidth},0):b&&(t&&(s=o),m=s.reduce(function(e,o){return e+o.renderWidth},0));var C={width:m?"".concat(m,"px"):m,marginLeft:t?null:"".concat(w.leftSpaceWidth,"px")};return v&&t&&_tools.DomTools.browse["-moz"]&&(C.paddingRight="".concat(g,"px")),l("div",{class:["vxe-table--body-wrapper",t?"fixed--".concat(t,"-wrapper"):"body--wrapper"],attrs:{fixed:t},style:P},[$?l("div",{class:["vxe-body--top-space"],style:{height:"".concat(_.topSpaceHeight,"px")}}):null,!t&&b?l("div",{class:["vxe-body--x-space"],style:{width:"".concat(e.tableWidth,"px")}}):null,l("table",{class:["vxe-table--body"],attrs:{cellspacing:0,cellpadding:0,border:0},style:C},[l("colgroup",s.map(function(e,o){return l("col",{attrs:{name:e.id,width:e.renderWidth},key:o})})),l("tbody",renderRows(l,this,e,0,t,d,s))]),t||i||d.length?null:l("div",{class:"vxe-table--empty-block"},[l("span",{class:"vxe-table--empty-text"},e.$slots.empty||_conf.default.i18n("vxe.table.emptyText"))]),$?l("div",{class:["vxe-body--bottom-space"],style:{height:"".concat(_.bottomSpaceHeight,"px")}}):null])},methods:{scrollEvent:function(e){var o=this.$parent,l=this.fixedType,t=o.$refs,r=o.scrollXLoad,n=o.scrollYLoad,c=o.triggerScrollXEvent,i=o.triggerScrollYEvent,d=t.tableHeader,s=t.tableBody,a=t.leftBody,u=t.rightBody,p=d?d.$el:null,f=s.$el,x=a?a.$el:null,h=u?u.$el:null,m=f.scrollTop,v=f.scrollLeft;x&&"left"===l?syncBodyScroll(m=x.scrollTop,f,h):h&&"right"===l?syncBodyScroll(m=h.scrollTop,f,x):(p&&(p.scrollLeft=f.scrollLeft),(x||h)&&(clearTimeout(updateLeftScrollingTimeput),updateLeftScrollingTimeput=setTimeout(o.checkScrolling,_tools.DomTools.browse.msie?200:20),syncBodyScroll(m,x,h))),r&&c(e),n&&i(e),_tools.UtilTools.emitEvent(o,"scroll",[{type:"body",fixed:l,scrollTop:m,scrollLeft:v,$table:o},e])}}};exports.default=_default;