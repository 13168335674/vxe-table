"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var scrollProcessTimeout,updateLeftScrollingTimeput,_xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../conf")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,o,l){return o in e?Object.defineProperty(e,o,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[o]=l,e}function handleLocation(e,o,l,t,r){var n=o.indexOf(t),c=l.indexOf(r);e.active=-1<n&&-1<c,e.top=0===n&&-1<c,e.bottom=n===o.length-1&&-1<c,e.left=-1<n&&0===c,e.right=-1<n&&c===l.length-1}function renderColumn(e,o,l,t,r,n,c,i,d,s,a,u){var p,f,x=l.$listeners,h=l.tableData,m=l.overflowX,y=l.scrollXLoad,v=l.scrollYLoad,g=l.border,w=l.highlightCurrentRow,b=l.showOverflow,_=l.showAllOverflow,$=l.selectColumn,I=l.cellClassName,T=l.spanMethod,P=l.keyboardConfig,k=l.treeConfig,C=l.mouseConfig,L=l.editConfig,S=l.editStore,E=l.validStore,R=_xeUtils.default.isBoolean(_)?_:b,q=s.editRender,B=s.align,H=s.showOverflow,O=s.renderWidth,U=s.columnKey,D=S.checked,Y=S.selected,W=S.actived,X=S.copyed,A=C&&C.selected,M=C&&C.checked,N=P&&P.isCut,F=r?s.fixed!==r:s.fixed&&m,j="ellipsis"===(H||R),z="title"===(H||R),G=!0===H||"tooltip"===H||!0===R||"tooltip"===R,K=z||G||j,V={},J={},Q={},Z={},ee={"data-index":a},oe=q&&L&&"dblclick"===L.trigger,le={$table:l,seq:t,row:c,rowIndex:i,$rowIndex:d,column:s,columnIndex:a,$columnIndex:u,fixed:r,level:n,isHidden:F,data:h};if(!y&&!v||K||(j=K=!0),(G||x["cell-mouseenter"])&&(V.mouseenter=function(e){var o={$table:l,seq:t,row:c,rowIndex:i,$rowIndex:d,column:s,columnIndex:a,$columnIndex:u,fixed:r,level:n,cell:e.currentTarget};G&&l.triggerTooltipEvent(e,o),_tools.UtilTools.emitEvent(l,"cell-mouseenter",[o,e])}),(G||x["cell-mouseleave"])&&(V.mouseleave=function(e){l.clostTooltip(),_tools.UtilTools.emitEvent(l,"cell-mouseleave",[{$table:l,seq:t,row:c,rowIndex:i,$rowIndex:d,column:s,columnIndex:a,$columnIndex:u,fixed:r,level:n,cell:e.currentTarget},e])}),V.mousedown=function(e){l.triggerCellMousedownEvent(e,{$table:l,seq:t,row:c,rowIndex:i,$rowIndex:d,column:s,columnIndex:a,$columnIndex:u,fixed:r,level:n,cell:e.currentTarget})},(w||x["cell-click"]||q&&L||k&&("row"===k.trigger||s.treeNode&&"cell"===k.trigger))&&(V.click=function(e){l.triggerCellClickEvent(e,{$table:l,row:c,rowIndex:i,$rowIndex:d,column:s,columnIndex:a,$columnIndex:u,fixed:r,level:n,cell:e.currentTarget})}),(oe||x["cell-dblclick"])&&(V.dblclick=function(e){l.triggerCellDBLClickEvent(e,{$table:l,seq:t,row:c,rowIndex:i,$rowIndex:d,column:s,columnIndex:a,$columnIndex:u,fixed:r,level:n,cell:e.currentTarget})}),T){var te=T(le)||{},re=te.rowspan,ne=void 0===re?1:re,ce=te.colspan,ie=void 0===ce?1:ce;if(!ne||!ie)return null;ee.rowspan=ne,ee.colspan=ie}return!F&&L&&L.showStatus&&(f=l.hasRowChange(c,s.property)),F||r||(M&&(handleLocation(J,D.rows,D.columns,c,s),handleLocation(Q,D.tRows,D.tColumns,c,s)),N&&handleLocation(Z,X.rows,X.columns,c,s)),e("td",{class:["vxe-body--column",s.id,(p={},_defineProperty(p,"col--".concat(B),B),_defineProperty(p,"col--edit",q),_defineProperty(p,"col--checked",J.active),_defineProperty(p,"col--checked-top",J.top),_defineProperty(p,"col--checked-bottom",J.bottom),_defineProperty(p,"col--checked-left",J.left),_defineProperty(p,"col--checked-right",J.right),_defineProperty(p,"col--checked-temp",Q.active),_defineProperty(p,"col--checked-temp-top",Q.top),_defineProperty(p,"col--checked-temp-bottom",Q.bottom),_defineProperty(p,"col--checked-temp-left",Q.left),_defineProperty(p,"col--checked-temp-right",Q.right),_defineProperty(p,"col--selected",A&&q&&Y.row===c&&Y.column===s),_defineProperty(p,"col--copyed",Z.active),_defineProperty(p,"col--copyed-top",Z.top),_defineProperty(p,"col--copyed-bottom",Z.bottom),_defineProperty(p,"col--copyed-left",Z.left),_defineProperty(p,"col--copyed-right",Z.right),_defineProperty(p,"col--actived",q&&W.row===c&&W.column===s),_defineProperty(p,"col--dirty",f),_defineProperty(p,"col--valid-error",E.row===c&&E.column===s),_defineProperty(p,"col--current",$===s),_defineProperty(p,"edit--visible",q&&"visible"===q.type),_defineProperty(p,"fixed--hidden",F),p),I?_xeUtils.default.isFunction(I)?I(le):I:""],key:U||a,attrs:ee,on:V},R&&F?[]:[e("div",{class:["vxe-cell",{"c--title":z,"c--tooltip":G,"c--ellipsis":j}],attrs:{title:z?_tools.UtilTools.getCellLabel(c,s,le):null},style:{width:K?"".concat(g?O-1:O,"px"):null}},s.renderCell(e,le)),M&&!r?e("span",{class:"vxe-body--column-checked-lt"}):null,M&&!r?e("span",{class:"vxe-body--column-checked-rb"}):null,N&&!r?e("span",{class:"vxe-body--column-copyed-lt"}):null,N&&!r?e("span",{class:"vxe-body--column-copyed-rb"}):null,J.bottom&&J.right?e("span",{class:"vxe-body--column-checked-corner",on:{mousedown:function(e){l.triggerCornerMousedownEvent({$table:l,seq:t,row:c,rowIndex:i,$rowIndex:d,column:s,columnIndex:a,$columnIndex:u,fixed:r,level:n,cell:e.target.parentNode},e)}}}):null])}function renderRows(a,u,p,f,x,e,h){var m=p.highlightHoverRow,y=p.rowClassName,v=p.selectRow,g=p.hoverRow,w=p.treeConfig,b=p.treeExpandeds,_=p.scrollYLoad,$=p.overflowX,o=p.columnStore,I=p.scrollYStore,T=p.editStore,P=p.expandeds,k=p.getRowMapIndex,C=p.getColumnMapIndex,L=o.leftList,S=o.rightList,E=[];return e.forEach(function(t,r){var e,o={},n=r,c=n+1;_&&(c+=I.startIndex),n=k(t),m&&(L.length||S.length)&&$&&(o.mouseenter=function(e){t!==g&&p.triggerHoverEvent(e,{row:t,rowIndex:n})});var l=_tools.UtilTools.getRowId(p,t,n);if(E.push(a("tr",{class:["vxe-body--row",(e={},_defineProperty(e,"row--level-".concat(f),w),_defineProperty(e,"row--current",t===v),_defineProperty(e,"row--hover",t===g),_defineProperty(e,"row--new",-1<T.insertList.indexOf(t)),e),y?_xeUtils.default.isFunction(y)?y({$table:p,seq:c,row:t,rowIndex:n}):y:""],attrs:{"data-rowid":l},key:l,on:o},h.map(function(e,o){var l=C(e);return renderColumn(a,u,p,c,x,f,t,n,r,e,l,o)}))),w&&b.length){var i=t[w.children];i&&i.length&&-1<b.indexOf(t)&&E.push.apply(E,renderRows(a,u,p,f+1,x,i,h))}else if(P.length&&-1<P.indexOf(t)){var d=h.find(function(e){return"expand"===e.type}),s=C(d);d&&E.push(a("tr",{class:["vxe-body--expanded-row"],key:"expand_".concat(n),on:o},[a("td",{class:["vxe-body--expanded-column"],attrs:{colspan:h.length}},[a("div",{class:["vxe-body--expanded-cell"]},[d.renderData(a,{$table:p,seq:c,row:t,rowIndex:n,column:d,columnIndex:s,fixed:x,level:f})])])]))}}),E}function syncBodyScroll(e,o,l){(o||l)&&(o&&(o.onscroll=null,o.scrollTop=e),l&&(l.onscroll=null,l.scrollTop=e),clearTimeout(scrollProcessTimeout),scrollProcessTimeout=setTimeout(function(){o&&(o.onscroll=o._onscroll),l&&(l.onscroll=l._onscroll)},100))}var _default={name:"VxeTableBody",props:{tableData:Array,tableColumn:Array,visibleColumn:Array,collectColumn:Array,fixedColumn:Array,size:String,fixedType:String,isGroup:Boolean},mounted:function(){this.$el.onscroll=this.scrollEvent,this.$el._onscroll=this.scrollEvent},beforeDestroy:function(){this.$el._onscroll=null,this.$el.onscroll=null},render:function(l){var e=this.$parent,o=this.fixedColumn,t=this.fixedType,r=e.maxHeight,n=e.height,c=e.containerHeight,i=e.loading,d=e.tableData,s=e.tableColumn,a=e.headerHeight,u=e.showFooter,p=e.showOverflow,f=e.showAllOverflow,x=e.footerHeight,h=e.tableHeight,m=e.tableWidth,y=e.overflowY,v=e.scrollXHeight,g=e.scrollYWidth,w=e.scrollXStore,b=e.scrollXLoad,_=e.scrollYStore,$=e.scrollYLoad,I=_xeUtils.default.isBoolean(f)?f:p,T="auto"===n?c:_xeUtils.default.toNumber(n),P={};0<T?P.height="".concat(t?(0<T?T-a-x:h)-(u?0:v):T-a-x,"px"):r&&(r=_xeUtils.default.toNumber(r),P["max-height"]="".concat(t?r-a-(u?0:v):r-a,"px")),t&&I?m=(s=o).reduce(function(e,o){return e+o.renderWidth},0):b&&(t&&(s=o),m=s.reduce(function(e,o){return e+o.renderWidth},0));var k={width:m?"".concat(m,"px"):m,marginLeft:t?null:"".concat(w.leftSpaceWidth,"px")};return y&&t&&_tools.DomTools.browse["-moz"]&&(k.paddingRight="".concat(g,"px")),l("div",{class:["vxe-table--body-wrapper",t?"fixed--".concat(t,"-wrapper"):"body--wrapper"],attrs:{fixed:t},style:P},[$?l("div",{class:["vxe-body--top-space"],style:{height:"".concat(_.topSpaceHeight,"px")}}):null,!t&&b?l("div",{class:["vxe-body--x-space"],style:{width:"".concat(e.tableWidth,"px")}}):null,l("table",{class:["vxe-table--body"],attrs:{cellspacing:0,cellpadding:0,border:0},style:k},[l("colgroup",s.map(function(e,o){return l("col",{attrs:{name:e.id,width:e.renderWidth},key:o})})),l("tbody",renderRows(l,this,e,0,t,d,s))]),t||i||d.length?null:l("div",{class:"vxe-table--empty-block"},[l("span",{class:"vxe-table--empty-text"},e.$slots.empty||_conf.default.i18n("vxe.table.emptyText"))]),$?l("div",{class:["vxe-body--bottom-space"],style:{height:"".concat(_.bottomSpaceHeight,"px")}}):null])},methods:{scrollEvent:function(e){var o=this.$parent,l=this.fixedType,t=o.$refs,r=o.scrollXLoad,n=o.scrollYLoad,c=o.triggerScrollXEvent,i=o.triggerScrollYEvent,d=t.tableHeader,s=t.tableBody,a=t.leftBody,u=t.rightBody,p=d?d.$el:null,f=s.$el,x=a?a.$el:null,h=u?u.$el:null,m=f.scrollTop,y=f.scrollLeft;x&&"left"===l?syncBodyScroll(m=x.scrollTop,f,h):h&&"right"===l?syncBodyScroll(m=h.scrollTop,f,x):(p&&(p.scrollLeft=f.scrollLeft),(x||h)&&(clearTimeout(updateLeftScrollingTimeput),updateLeftScrollingTimeput=setTimeout(o.checkScrolling,_tools.DomTools.browse.msie?200:20),syncBodyScroll(m,x,h))),r&&c(e),n&&i(e),_tools.UtilTools.emitEvent(o,"scroll",[{type:"body",fixed:l,scrollTop:m,scrollLeft:y,$table:o},e])}}};exports.default=_default;