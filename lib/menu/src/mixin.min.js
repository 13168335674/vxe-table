"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils/methods/xe-utils")),_tools=require("../../tools"),_vXETable=_interopRequireDefault(require("../../v-x-e-table"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _default={methods:{_closeMenu:function(){return Object.assign(this.ctxMenuStore,{visible:!1,selected:null,childPos:null,selectChild:null,showChild:!1}),this.$nextTick()},moveCtxMenu:function(e,t,l,i,n,o,s){var r,u=_xeUtils.default.findIndexOf(s,function(e){return l[i]===e});if(t===n)o&&_tools.UtilTools.hasChildrenList(l.selected)?l.showChild=!0:(l.showChild=!1,l.selectChild=null);else if(38===t){for(var c=u-1;0<=c;c--)if(!1!==s[c].visible){r=s[c];break}l[i]=r||s[s.length-1]}else if(40===t){for(var a=u+1;a<s.length;a++)if(!1!==s[a].visible){r=s[a];break}l[i]=r||s[0]}else!l[i]||13!==t&&32!==t||this.ctxMenuLinkEvent(e,l[i])},handleGlobalContextmenuEvent:function(e){var t=this.id,l=this.contextMenu,i=this.isCtxMenu,n=this.ctxMenuStore,o=this.ctxMenuOpts,s=["header","body","footer"];if(l&&i){if(n.visible&&n.visible&&this.$refs.ctxWrapper&&_tools.DomTools.getEventTargetNode(e,this.$refs.ctxWrapper.$el).flag)return void e.preventDefault();for(var r=0;r<s.length;r++){var u=s[r],c=_tools.DomTools.getEventTargetNode(e,this.$el,"vxe-".concat(u,"--column"),function(e){return e.parentNode.parentNode.parentNode.getAttribute("data-tid")===t}),a={type:u,$table:this,columns:this.visibleColumn.slice(0)};if(c.flag){var h=c.targetElem,d=this.getColumnNode(h).item,f="".concat(u,"-");if(Object.assign(a,{column:d,columnIndex:this.getColumnIndex(d),cell:h}),"body"===u){var v=this.getRowNode(h.parentNode).item;f="",a.row=v,a.rowIndex=this.getRowIndex(v)}return this.openContextMenu(e,u,a),void _tools.UtilTools.emitEvent(this,"".concat(f,"cell-context-menu"),[a,e])}if(_tools.DomTools.getEventTargetNode(e,this.$el,"vxe-table--".concat(u,"-wrapper"),function(e){return e.getAttribute("data-tid")===t}).flag)return void("cell"===o.trigger?e.preventDefault():this.openContextMenu(e,u,a))}}this.closeMenu(),this.closeFilter()},openContextMenu:function(h,e,t){var d=this,f=this.ctxMenuStore,l=this.ctxMenuOpts,i=l[e],n=l.visibleMethod;if(i){var v=i.options;i.disabled?h.preventDefault():v&&v.length&&(t.options=v,this.preventEvent(h,"event.showMenu",t,null,function(){if(!n||n(t,h)){h.preventDefault(),d.updateZindex();var e=_tools.DomTools.getDomNode(),o=e.scrollTop,s=e.scrollLeft,r=e.visibleHeight,u=e.visibleWidth,c=h.clientY+o,a=h.clientX+s;Object.assign(f,{args:t,visible:!0,list:v,selected:null,selectChild:null,showChild:!1,childPos:null,style:{zIndex:d.tZindex,top:"".concat(c,"px"),left:"".concat(a,"px")}}),d.$nextTick(function(){var e=d.$refs.ctxWrapper.$el,t=e.clientHeight,l=e.clientWidth,i=h.clientY+t-r,n=h.clientX+l-u;-10<i&&(f.style.top="".concat(Math.max(o+2,c-t-2),"px")),-10<n&&(f.style.left="".concat(Math.max(s+2,a-l-2),"px")),-220<n&&(f.childPos="left")})}else d.closeMenu()}))}this.closeFilter()},ctxMenuMouseoverEvent:function(e,t,l){var i=this.ctxMenuStore;e.preventDefault(),e.stopPropagation(),i.selected=t,(i.selectChild=l)||(i.showChild=_tools.UtilTools.hasChildrenList(t))},ctxMenuMouseoutEvent:function(e,t){var l=this.ctxMenuStore;t.children||(l.selected=null),l.selectChild=null},ctxMenuLinkEvent:function(e,t){if(!(t.disabled||t.children&&t.children.length)){var l=_vXETable.default.menus.get(t.code),i=Object.assign({menu:t,$table:this},this.ctxMenuStore.args);l&&l.call(this,i,e),_tools.UtilTools.emitEvent(this,"context-menu-click",[i,e]),this.closeMenu()}}}};exports.default=_default;