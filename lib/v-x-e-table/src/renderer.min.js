"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.renderStore=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils/methods/xe-utils")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function getAttrs(e){var t=e.name,r=e.attrs;return"input"===t&&(r=Object.assign({type:"text"},r)),r}function isSyncCell(e,t,r){return e.immediate||"visible"===e.type||"cell"===r.$type}function defaultEditRender(e,t,r,n){var o=r.row,l=r.column,a=t.name,u=getAttrs(t),i=isSyncCell(t,r,n)?_tools.UtilTools.getCellValue(o,l):l.model.value;return[e(a,{class:"vxe-default-".concat(a),attrs:u,domProps:{value:i},on:getEvents(t,r,n)})]}function getEvents(r,n,o){var e=r.name,l=r.events,a=n.$table,u=n.row,i=n.column,d=i.model,s="select"===e?"change":"input",t=_defineProperty({},s,function(e){var t=e.target.value;isSyncCell(r,n,o)?_tools.UtilTools.setCellValue(u,i,t):(d.update=!0,d.value=t),a.updateStatus(n,t),l&&l[s]&&l[s](n,e)});return l?_xeUtils.default.assign({},_xeUtils.default.objectMap(l,function(e){return function(){e.apply(null,[n].concat.apply(n,arguments))}}),t):t}function renderOptgroups(r,n,o,l,a){var e=n.optionGroups,t=n.optionGroupProps,u=void 0===t?{}:t,i=u.options||"options",d=u.label||"label";return e.map(function(e,t){return r("optgroup",{domProps:{label:e[d]},key:t},a(r,e[i],n,o,l))})}function renderOptions(r,e,t,n,o){var l=t.optionProps,a=void 0===l?{}:l,u=n.row,i=n.column,d=a.label||"label",s=a.value||"value",p=a.disabled||"disabled",c=isSyncCell(t,n,o)?_tools.UtilTools.getCellValue(u,i):i.model.value;return e.map(function(e,t){return r("option",{attrs:{value:e[s],disabled:e[p]},domProps:{selected:e[s]===c},key:t},e[d])})}function getFilterEvents(t,e,r,n){var o=r.column,l=e.events,a="select"===name?"change":"input",u=_defineProperty({},a,function(e){t.data=e.target.value,handleConfirmFilter(n,o,!!t.data,t),l&&l[a]&&l[a](Object.assign({context:n},r),e)});return l?_xeUtils.default.assign({},_xeUtils.default.objectMap(l,function(e){return function(){r=Object.assign({context:n},r),e.apply(null,[r].concat.apply(r,arguments))}}),u):u}function defaultFilterRender(t,r,n,o){var e=n.column,l=r.name,a=getAttrs(r);return e.filters.map(function(e){return t(l,{class:"vxe-default-".concat(l),attrs:a,domProps:{value:e.data},on:getFilterEvents(e,r,n,o)})})}function handleConfirmFilter(e,t,r,n){e[t.filterMultiple?"changeMultipleOption":"changeRadioOption"]({},r,n)}function defaultFilterMethod(e){var t=e.option,r=e.row,n=e.column,o=t.data;return _xeUtils.default.get(r,n.property)==o}function renderSelectEdit(e,t,r,n){return[e("select",{class:"vxe-default-select",attrs:getAttrs(t),on:getEvents(t,r,n)},t.optionGroups?renderOptgroups(e,t,r,n,renderOptions):renderOptions(e,t.options,t,r,n))]}function defaultItemRender(e,t,r,n){var o=r.data,l=r.field,a=t.name,u=getAttrs(t),i=_xeUtils.default.get(o,l);return[e(a,{class:"vxe-default-".concat(a),attrs:u,domProps:!u||"input"!==a||"submit"!==u.type&&"reset"!==u.type?{value:i}:null,on:getFormEvents(t,r,n)})]}function getFormEvents(e,t,r){var n=t.data,o=t.field,l=e.events,a="select"===name?"change":"input",u=_defineProperty({},a,function(e){_xeUtils.default.set(n,o,e.target.value),l&&l[a]&&l[a](Object.assign({context:r},t),e)});return l?_xeUtils.default.assign({},_xeUtils.default.objectMap(l,function(e){return function(){t=Object.assign({context:r},t),e.apply(null,[t].concat.apply(t,arguments))}}),u):u}function renderFormOptions(r,e,t,n,o){var l=n.data,a=n.field,u=t.optionProps,i=void 0===u?{}:u,d=i.label||"label",s=i.value||"value",p=i.disabled||"disabled",c=_xeUtils.default.get(l,a);return e.map(function(e,t){return r("option",{attrs:{value:e[s],disabled:e[p]},domProps:{selected:e[s]===c},key:t},e[d])})}var renderMap={input:{autofocus:"input",renderEdit:defaultEditRender,renderDefault:defaultEditRender,renderFilter:defaultFilterRender,filterMethod:defaultFilterMethod,renderItem:defaultItemRender},textarea:{autofocus:"textarea",renderEdit:defaultEditRender,renderDefault:defaultEditRender,renderFilter:defaultFilterRender,filterMethod:defaultFilterMethod,renderItem:defaultItemRender},select:{renderEdit:renderSelectEdit,renderDefault:renderSelectEdit,renderCell:function(e,t,r){var n,o=t.options,l=t.optionGroups,a=t.optionProps,u=void 0===a?{}:a,i=t.optionGroupProps,d=void 0===i?{}:i,s=r.row,p=r.column,c=_xeUtils.default.get(s,p.property),f=u.label||"label",v=u.value||"value";if(l){for(var m=d.options||"options",g=0;g<l.length&&!(n=_xeUtils.default.find(l[g][m],function(e){return e[v]===c}));g++);return n?n[f]:c}return(n=_xeUtils.default.find(o,function(e){return e[v]===c}))?n[f]:c},renderFilter:function(t,r,n,o){return n.column.filters.map(function(e){return t("select",{class:"vxe-default-select",attrs:getAttrs(r),on:getFilterEvents(e,r,n,o)},r.optionGroups?renderOptgroups(t,r,n,o,renderOptions):renderOptions(t,r.options,r,n,o))})},filterMethod:defaultFilterMethod,renderItem:function(e,t,r,n){return[e("select",{class:"vxe-default-select",attrs:getAttrs(t),on:getFormEvents(t,r,n)},t.optionGroups?renderOptgroups(e,t,r,n,renderFormOptions):renderFormOptions(e,t.options,t,r,n))]}}},renderStore={mixin:function(e){return _xeUtils.default.each(e,function(e,t){return renderStore.add(t,e)}),renderStore},get:function(e){return renderMap[e]||null},add:function(e,t){if(e&&t){var r=renderMap[e];r?Object.assign(r,t):renderMap[e]=t}return renderStore},delete:function(e){return delete renderMap[e],renderStore}},_default=exports.renderStore=renderStore;exports.default=_default;