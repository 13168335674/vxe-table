"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.renderStore=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils/methods/xe-utils")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function getAttrs(e){var t=e.name,r=e.attrs;return"input"===t&&(r=Object.assign({type:"text"},r)),r}function isSyncCell(e,t){return e.immediate||"visible"===e.type||t.isEdit}function getEvents(r,o){var e=r.name,n=r.events,l=o.$table,a=o.row,u=o.column,i=u.model,d="select"===e?"change":"input",t=_defineProperty({},d,function(e){var t=e.target.value;isSyncCell(r,o)?_tools.UtilTools.setCellValue(a,u,t):(i.update=!0,i.value=t),l.updateStatus(o,t),n&&n[d]&&n[d](o,e)});return n?_xeUtils.default.assign({},_xeUtils.default.objectMap(n,function(n){return function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];t=[o].concat(t),n.apply(void 0,_toConsumableArray(t))}}),t):t}function defaultEditRender(e,t,r){var n=r.row,o=r.column,l=t.name,a=getAttrs(t),u=isSyncCell(t,r)?_tools.UtilTools.getCellValue(n,o):o.model.value;return[e(l,{class:"vxe-default-".concat(l),attrs:a,domProps:{value:u},on:getEvents(t,r)})]}function renderOptgroups(r,n,o,l){var e=n.optionGroups,t=n.optionGroupProps,a=void 0===t?{}:t,u=a.options||"options",i=a.label||"label";return e.map(function(e,t){return r("optgroup",{domProps:{label:e[i]},key:t},l(r,e[u],n,o))})}function renderOptions(r,e,t,n){var o=t.optionProps,l=void 0===o?{}:o,a=n.row,u=n.column,i=l.label||"label",d=l.value||"value",s=l.disabled||"disabled",p=isSyncCell(t,n)?_tools.UtilTools.getCellValue(a,u):u.model.value;return e.map(function(e,t){return r("option",{attrs:{value:e[d],disabled:e[s]},domProps:{selected:e[d]==p},key:t},e[i])})}function handleConfirmFilter(e,t,r,n){e.$panel[t.filterMultiple?"changeMultipleOption":"changeRadioOption"]({},r,n)}function getFilterEvents(t,e,o){var r=o.column,n=e.events,l="select"===name?"change":"input",a=_defineProperty({},l,function(e){t.data=e.target.value,handleConfirmFilter(o,r,!!t.data,t),n&&n[l]&&n[l](o,e)});return n?_xeUtils.default.assign({},_xeUtils.default.objectMap(n,function(n){return function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];t=[o].concat(t),n.apply(void 0,_toConsumableArray(t))}}),a):a}function defaultFilterRender(t,r,n){var e=n.column,o=r.name,l=getAttrs(r);return e.filters.map(function(e){return t(o,{class:"vxe-default-".concat(o),attrs:l,domProps:{value:e.data},on:getFilterEvents(e,r,n)})})}function defaultFilterMethod(e){var t=e.option,r=e.row,n=e.column,o=t.data;return _xeUtils.default.get(r,n.property)==o}function renderSelectEdit(e,t,r){return[e("select",{class:"vxe-default-select",attrs:getAttrs(t),on:getEvents(t,r)},t.optionGroups?renderOptgroups(e,t,r,renderOptions):renderOptions(e,t.options,t,r))]}function getSelectCellValue(e,t){var r,n=t.row,o=t.column,l=e.options,a=e.optionGroups,u=e.optionProps,i=void 0===u?{}:u,d=e.optionGroupProps,s=void 0===d?{}:d,p=_xeUtils.default.get(n,o.property),c=i.label||"label",f=i.value||"value";if(a){for(var v=s.options||"options",m=0;m<a.length&&!(r=_xeUtils.default.find(a[m][v],function(e){return e[f]==p}));m++);return r?r[c]:p}return(r=_xeUtils.default.find(l,function(e){return e[f]==p}))?r[c]:p}function getFormEvents(e,o){var r=o.$form,n=o.data,l=o.property,a=e.events,u="select"===name?"change":"input",t=_defineProperty({},u,function(e){var t=e.target.value;_xeUtils.default.set(n,l,t),r.updateStatus(o,t),a&&a[u]&&a[u](o,e)});return a?_xeUtils.default.assign({},_xeUtils.default.objectMap(a,function(n){return function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];t=[o].concat(t),n.apply(void 0,_toConsumableArray(t))}}),t):t}function defaultItemRender(e,t,r){var n=r.data,o=r.property,l=t.name,a=getAttrs(t),u=_xeUtils.default.get(n,o);return[e(l,{class:"vxe-default-".concat(l),attrs:a,domProps:!a||"input"!==l||"submit"!==a.type&&"reset"!==a.type?{value:u}:null,on:getFormEvents(t,r)})]}function renderFormOptions(r,e,t,n){var o=n.data,l=n.property,a=t.optionProps,u=void 0===a?{}:a,i=u.label||"label",d=u.value||"value",s=u.disabled||"disabled",p=_xeUtils.default.get(o,l);return e.map(function(e,t){return r("option",{attrs:{value:e[d],disabled:e[s]},domProps:{selected:e[d]==p},key:t},e[i])})}function createExportMethod(t,e){var r=e?"editRender":"cellRender";return function(e){return t(e.column[r],e)}}var renderMap={input:{autofocus:"input",renderEdit:defaultEditRender,renderDefault:defaultEditRender,renderFilter:defaultFilterRender,filterMethod:defaultFilterMethod,renderItem:defaultItemRender},textarea:{autofocus:"textarea",renderEdit:defaultEditRender,renderDefault:defaultEditRender,renderFilter:defaultFilterRender,filterMethod:defaultFilterMethod,renderItem:defaultItemRender},select:{renderEdit:renderSelectEdit,renderDefault:renderSelectEdit,renderCell:function(e,t,r){return getSelectCellValue(t,r)},renderFilter:function(t,r,n){return n.column.filters.map(function(e){return t("select",{class:"vxe-default-select",attrs:getAttrs(r),on:getFilterEvents(e,r,n)},r.optionGroups?renderOptgroups(t,r,n,renderOptions):renderOptions(t,r.options,r,n))})},filterMethod:defaultFilterMethod,renderItem:function(e,t,r){return[e("select",{class:"vxe-default-select",attrs:getAttrs(t),on:getFormEvents(t,r)},t.optionGroups?renderOptgroups(e,t,r,renderFormOptions):renderFormOptions(e,t.options,t,r))]},editCellExportMethod:createExportMethod(getSelectCellValue,!0),cellExportMethod:createExportMethod(getSelectCellValue)}},renderStore={mixin:function(e){return _xeUtils.default.each(e,function(e,t){return renderStore.add(t,e)}),renderStore},get:function(e){return renderMap[e]||null},add:function(e,t){if(e&&t){var r=renderMap[e];r?Object.assign(r,t):renderMap[e]=t}return renderStore},delete:function(e){return delete renderMap[e],renderStore}},_default=exports.renderStore=renderStore;exports.default=_default;