"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils/methods/xe-utils")),_cell=_interopRequireDefault(require("../../cell")),_vXETable=_interopRequireWildcard(require("../../v-x-e-table")),_tools=require("../../tools");function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var i={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=l?Object.getOwnPropertyDescriptor(e,o):null;r&&(r.get||r.set)?Object.defineProperty(i,o,r):i[o]=e[o]}return i.default=e,t&&t.set(e,i),i}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var rowUniqueId=0,browse=_tools.DomTools.browse,isWebkit=browse["-webkit"]&&!browse.edge,debounceScrollYDuration=browse.msie?40:20,headerProps={children:"children"};function getRowUniqueId(){return"row_".concat(++rowUniqueId)}function isTargetRadioOrCheckbox(e,t,i,l){var o=e.target;return o&&t.type===i&&"input"===o.tagName.toLowerCase()&&o.type===(l||i)}var Methods={getParentElem:function(){return this.$grid?this.$grid.$el.parentNode:this.$el.parentNode},getParentHeight:function(){return this.$grid?this.$grid.getParentHeight():this.getParentElem().clientHeight},getExcludeHeight:function(){return this.$grid?this.$grid.getExcludeHeight():0},clearAll:function(){return this.clearSort(),this.clearCurrentRow(),this.clearCurrentColumn(),this.clearSelection(),this.clearSelectReserve(),this.clearRowExpand(),this.clearTreeExpand(),_vXETable.default._edit&&this.clearActived(),_vXETable.default._filter&&this.clearFilter(),(this.keyboardConfig||this.mouseConfig)&&(this.clearIndexChecked(),this.clearHeaderChecked(),this.clearChecked(),this.clearSelected(),this.clearCopyed()),this.clearScroll()},refreshData:function(){var e=this;return this.$nextTick().then(function(){return e.tableData=[],e.$nextTick().then(function(){return e.loadTableData(e.tableFullData)})})},updateData:function(){return this.handleTableData(!0).then(this.updateFooter).then(this.recalculate)},handleTableData:function(e){var t=this.scrollYLoad,i=this.scrollYStore,l=e?this.updateAfterFullData():this.afterFullData;return this.tableData=t?l.slice(i.startIndex,i.startIndex+i.renderSize):l.slice(0),this.$nextTick()},loadTableData:function(e,t){var i=this,l=this.height,o=this.maxHeight,r=this.showOverflow,n=this.treeConfig,s=this.editStore,a=this.optimizeOpts,c=this.scrollYStore,h=a.scrollY,u=e?e.slice(0):[],d=!n&&h&&h.gt&&h.gt<u.length;c.startIndex=0,c.visibleIndex=0,s.insertList=[],s.removeList=[],this.tableFullData=u,this.updateCache(!0),this.tableSynchData=e,this.tableSourceData=_xeUtils.default.clone(u,!0),!(this.scrollYLoad=d)||l||o||_tools.UtilTools.error("vxe.error.scrollYReqProp",["height | max-height"]),d&&!r&&_tools.UtilTools.warn("vxe.error.scrollYReqProp",["show-header-overflow & show-overflow"]);var f=Promise.resolve();return d&&(f=this.computeScrollLoad()),f.then(function(){return i.isLoadData=!0,i.computeRowHeight(),i.handleTableData(!0),i.handleReserveStatus(),i.checkSelectionStatus(),f=i.$nextTick(),t||(f=f.then(i.recalculate)),f.then(i.refreshScroll)})},loadData:function(e){return this.inited=!0,this.loadTableData(e).then(this.recalculate)},reloadData:function(e){var t=this;return this.inited=!0,this.clearAll().then(function(){return t.loadTableData(e)}).then(this.handleDefaults)},reloadRow:function(e,t,i){var l=this.tableSourceData,o=this.tableData,r=this.getRowIndex(e),n=l[r];return n&&e&&(i?_xeUtils.default.set(n,i,_xeUtils.default.get(t||e,i)):t?(l[r]=t,_xeUtils.default.clear(e,void 0),Object.assign(e,this.defineField(Object.assign({},t))),this.updateCache(!0)):_xeUtils.default.destructuring(n,_xeUtils.default.clone(e,!0))),this.tableData=o.slice(0),this.$nextTick()},loadColumn:function(e){var t=this;return this.collectColumn=_xeUtils.default.mapTree(e,function(e){return _cell.default.createColumn(t,e)},headerProps),this.$nextTick()},reloadColumn:function(e){return this.clearAll(),this.loadColumn(e)},updateCache:function(o){function e(e,t){var i=_tools.UtilTools.getRowid(r,e);i||(i=getRowUniqueId(),_xeUtils.default.set(e,u,i)),d&&e[n.hasChild]&&_xeUtils.default.isUndefined(e[n.children])&&(e[n.children]=null);var l={row:e,rowid:i,index:t};o&&(s[i]=l,a.set(e,l)),h[i]=l,c.set(e,l)}var r=this,t=this.treeConfig,n=this.treeOpts,i=this.tableFullData,s=this.fullDataRowIdData,a=this.fullDataRowMap,c=this.fullAllDataRowMap,h=this.fullAllDataRowIdData,u=_tools.UtilTools.getRowkey(this),d=t&&n.lazy;o&&(s=this.fullDataRowIdData={},a.clear()),h=this.fullAllDataRowIdData={},c.clear(),t?_xeUtils.default.eachTree(i,e,n):i.forEach(e)},appendTreeCache:function(e,t){var o=this,i=this.tableSourceData,l=this.treeOpts,r=this.fullDataRowIdData,n=this.fullDataRowMap,s=this.fullAllDataRowMap,a=this.fullAllDataRowIdData,c=l.children,h=l.hasChild,u=_tools.UtilTools.getRowkey(this),d=_tools.UtilTools.getRowid(this,e),f=_xeUtils.default.findTree(i,function(e){return d===_tools.UtilTools.getRowid(o,e)},l);_xeUtils.default.eachTree(t,function(e,t){var i=_tools.UtilTools.getRowid(o,e);i||(i=getRowUniqueId(),_xeUtils.default.set(e,u,i)),e[h]&&_xeUtils.default.isUndefined(e[c])&&(e[c]=null);var l={row:e,rowid:i,index:t};r[i]=l,n.set(e,l),a[i]=l,s.set(e,l)},l),f&&(f.item[c]=_xeUtils.default.clone(t,!0))},cacheColumnMap:function(){var e=this.isGroup,t=this.tableFullColumn,i=this.collectColumn,l=this.fullColumnMap,o=this.fullColumnIdData={};l.clear(),e&&_xeUtils.default.eachTree(i,function(e,t){if(e.children&&e.children.length){var i={column:e,colid:e.id,index:t};o[e.id]=i,l.set(e,i)}},headerProps),t.forEach(function(e,t){var i={column:e,colid:e.id,index:t};o[e.id]=i,l.set(e,i)},headerProps)},getRowNode:function(e){var t=this;if(e){var i=this.treeConfig,l=this.treeOpts,o=this.tableFullData,r=this.fullAllDataRowIdData,n=e.getAttribute("data-rowid");if(i){var s=_xeUtils.default.findTree(o,function(e){return _tools.UtilTools.getRowid(t,e)===n},l);if(s)return s}else if(r[n]){var a=r[n];return{item:a.row,index:a.index,items:o}}}return null},getColumnNode:function(e){if(e){var t=this.fullColumnIdData,i=this.tableFullColumn,l=t[e.getAttribute("data-colid")];return{item:l.column,index:l.index,items:i}}return null},getRowIndex:function(e){return this.fullDataRowMap.has(e)?this.fullDataRowMap.get(e).index:-1},$getRowIndex:function(e){return this.afterFullData.indexOf(e)},getColumnIndex:function(e){return this.fullColumnMap.has(e)?this.fullColumnMap.get(e).index:-1},$getColumnIndex:function(e){return this.visibleColumn.indexOf(e)},isSeqColumn:function(e){return e&&("seq"===e.type||"index"===e.type)},defineField:function(l){var e=this.treeConfig,t=this.treeOpts,i=_tools.UtilTools.getRowkey(this);return this.visibleColumn.forEach(function(e){var t=e.property,i=e.editRender;t&&!_xeUtils.default.has(l,t)&&_xeUtils.default.set(l,t,i&&!_xeUtils.default.isUndefined(i.defaultValue)?i.defaultValue:null)}),e&&t.lazy&&_xeUtils.default.isUndefined(l[t.children])&&(l[t.children]=null),_xeUtils.default.get(l,i)||_xeUtils.default.set(l,i,getRowUniqueId()),l},createData:function(e){var t=this;return this.$nextTick().then(function(){return e.map(t.defineField)})},createRow:function(t){var i=this,l=_xeUtils.default.isArray(t);return l||(t=[t]),this.$nextTick().then(function(){var e=t.map(function(e){return i.defineField(Object.assign({},e))});return l?e:e[0]})},clearData:function(e,t){var i=this.tableFullData,l=this.visibleColumn;return arguments.length?e&&!_xeUtils.default.isArray(e)&&(e=[e]):e=i,t?e.forEach(function(e){return _xeUtils.default.set(e,t,null)}):e.forEach(function(t){l.forEach(function(e){e.property&&_tools.UtilTools.setCellValue(t,e,null)})}),this.$nextTick()},isInsertByRow:function(e){return this.editStore.insertList.includes(e)},hasRowChange:function(e,t){return _tools.UtilTools.warn("vxe.error.delFunc",["hasRowChange","isUpdateByRow"]),this.isUpdateByRow(e,t)},isUpdateByRow:function(e,t){var i,l,o=this,r=this.visibleColumn,n=this.treeConfig,s=this.treeOpts,a=this.tableSourceData,c=this.fullDataRowIdData,h=_tools.UtilTools.getRowid(this,e);if(!c[h])return!1;if(n){var u=s.children,d=_xeUtils.default.findTree(a,function(e){return h===_tools.UtilTools.getRowid(o,e)},s);e=Object.assign({},e,_defineProperty({},u,null)),d&&(i=Object.assign({},d.item,_defineProperty({},u,null)))}else{i=a[c[h].index]}if(i){if(1<arguments.length)return!_xeUtils.default.isEqual(_xeUtils.default.get(i,t),_xeUtils.default.get(e,t));for(var f=0,p=r.length;f<p;f++)if((l=r[f].property)&&!_xeUtils.default.isEqual(_xeUtils.default.get(i,l),_xeUtils.default.get(e,l)))return!0}return!1},getColumns:function(e){var t=this.visibleColumn;return arguments.length?t[e]:t.slice(0)},getColumnById:function(e){var t=this.fullColumnIdData;return t[e]?t[e].column:null},getColumnByField:function(t){return _xeUtils.default.find(this.tableFullColumn,function(e){return e.property===t})},getTableColumn:function(){return{fullColumn:this.tableFullColumn.slice(0),visibleColumn:this.visibleColumn.slice(0),tableColumn:this.tableColumn.slice(0)}},getRecords:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["getRecords","getData"]),this.getData.apply(this,arguments)},getData:function(e){var t=this.data||this.tableSynchData;return arguments.length?t[e]:t.slice(0)},getAllRecords:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["getAllRecords","getRecordset"]),this.getRecordset()},getSelectRecords:function(){var e=this.tableFullData,t=this.treeConfig,i=this.treeOpts,l=this.checkboxOpts.checkField,o=[];if(l)o=t?_xeUtils.default.filterTree(e,function(e){return _xeUtils.default.get(e,l)},i):e.filter(function(e){return _xeUtils.default.get(e,l)});else{var r=this.selection;o=t?_xeUtils.default.filterTree(e,function(e){return r.includes(e)},i):e.filter(function(e){return r.includes(e)})}return o},updateAfterFullData:function(){var e=this.visibleColumn,t=this.tableFullData,i=this.remoteSort,c=this.remoteFilter,h=this.filterOpts,l=this.sortOpts,o=t.slice(0),r=_xeUtils.default.find(e,function(e){return e.order}),n=[];if(e.forEach(function(e){if(e.filters&&e.filters.length){var t=[],i=[];e.filters.forEach(function(e){e.checked&&(i.push(e),t.push(e.value))}),n.push({column:e,valueList:t,itemList:i})}}),n.length&&(o=o.filter(function(a){return n.every(function(e){var t=e.column,i=e.valueList,l=e.itemList;if(!i.length||h.remote||c)return!0;var o=t.filterRender,r=t.property,n=t.filterMethod,s=o?_vXETable.Renderer.get(o.name):null;return!n&&s&&s.renderFilter&&(n=s.filterMethod),n?l.some(function(e){return n({value:e.value,option:e,row:a,column:t})}):i.includes(_xeUtils.default.get(a,r))})})),r&&r.order){var s=l.sortMethod||this.sortMethod;if(!(_xeUtils.default.isBoolean(r.remoteSort)?r.remoteSort:l.remote||i))if(s)o=s({data:o,column:r,property:r.property,order:r.order,$table:this})||o;else{var a=r.sortMethod?o.sort(r.sortMethod):_xeUtils.default.sortBy(o,r.property);o="desc"===r.order?a.reverse():a}}return this.afterFullData=o},getRowById:function(e){var t=this.fullDataRowIdData;return t[e]?t[e].row:null},getRowid:function(e){var t=this.fullAllDataRowMap;return t.has(e)?t.get(e).rowid:null},getTableData:function(){var e=this.tableFullData,t=this.afterFullData,i=this.tableData,l=this.footerData;return{fullData:e.slice(0),visibleData:t.slice(0),tableData:i.slice(0),footerData:l.slice(0)}},handleDefaults:function(){var e=this;(this.checkboxConfig||this.selectConfig)&&this.handleDefaultSelectionChecked(),this.radioConfig&&this.handleDefaultRadioChecked(),this.sortConfig&&this.handleDefaultSort(),this.expandConfig&&this.handleDefaultRowExpand(),this.treeConfig&&this.handleDefaultTreeExpand(),this.updateFooter(),this.$nextTick(function(){return setTimeout(e.recalculate)})},mergeCustomColumn:function(i){var e=this.tableFullColumn;this.isUpdateCustoms=!0,i.length&&e.forEach(function(t){var e=_xeUtils.default.find(i,function(e){return t.property&&(e.field||e.prop)===t.property});e&&(_xeUtils.default.isNumber(e.resizeWidth)&&(t.resizeWidth=e.resizeWidth),_xeUtils.default.isBoolean(e.visible)&&(t.visible=e.visible))}),this.$emit("update:customs",e)},resetAll:function(){this.resetCustoms(),this.resetResizable()},hideColumn:function(e){return this.handleVisibleColumn(e,!1)},showColumn:function(e){return this.handleVisibleColumn(e,!0)},resetCustoms:function(){return this.handleVisibleColumn()},handleVisibleColumn:function(e,t){return arguments.length?e.visible=t:this.tableFullColumn.forEach(function(e){e.visible=!0}),this.$toolbar&&this.$toolbar.handleCustoms(),this.$nextTick()},reloadCustoms:function(e){var t=this;return this.$nextTick().then(function(){return t.mergeCustomColumn(e),t.refreshColumn().then(function(){return t.tableFullColumn})})},refreshColumn:function(){var i,e=this,l=0,o=[],r=null,n=null,s=[],a=[],t=this.tableFullColumn,c=this.isGroup,h=this.columnStore,u=this.scrollXStore,d=this.optimizeOpts.scrollX;c&&_xeUtils.default.eachTree(this.collectColumn,function(e){e.children&&e.children.length&&(e.visible=!!_xeUtils.default.findTree(e.children,function(e){return e.children&&e.children.length?0:e.visible},headerProps))},headerProps),t.filter(function(e){return e.visible}).forEach(function(e,t){"left"===e.fixed?(null===r&&(r=l),i||(t-l!=0?i=!0:l++),o.push(e)):"right"===e.fixed?(i||(null===n&&(n=t),t-n!=0?i=!0:n++),a.push(e)):s.push(e)});var f=o.concat(s).concat(a),p=d&&d.gt&&d.gt<t.length;return Object.assign(h,{leftList:o,centerList:s,rightList:a}),c&&(i||r||null!==n&&n!==f.length)&&_tools.UtilTools.error("vxe.error.groupFixed"),p&&(this.isGroup&&_tools.UtilTools.warn("vxe.error.scrollXNotGroup"),this.showHeaderOverflow||_tools.UtilTools.warn("vxe.error.scrollXReqProp",["show-header-overflow & show-overflow"]),Object.assign(u,{startIndex:0,visibleIndex:0}),f=f.slice(u.startIndex,u.startIndex+u.renderSize)),this.scrollXLoad=p,this.tableColumn=f,this.$nextTick().then(function(){e.updateFooter(),e.recalculate(!0)})},analyColumnWidth:function(){var t=this.columnWidth,i=this.columnMinWidth,l=[],o=[],r=[],n=[],s=[],a=[];this.tableFullColumn.forEach(function(e){t&&!e.width&&(e.width=t),i&&!e.minWidth&&(e.minWidth=i),e.visible&&(e.resizeWidth?l.push(e):_tools.DomTools.isPx(e.width)?o.push(e):_tools.DomTools.isScale(e.width)?n.push(e):_tools.DomTools.isPx(e.minWidth)?r.push(e):_tools.DomTools.isScale(e.minWidth)?s.push(e):a.push(e))}),Object.assign(this.columnStore,{resizeList:l,pxList:o,pxMinList:r,scaleList:n,scaleMinList:s,autoList:a})},refreshScroll:function(){var e=this,t=this.lastScrollLeft,i=this.lastScrollTop;return this.clearScroll(),this.$nextTick().then(function(){if(t||i)return e.lastScrollLeft=0,e.lastScrollTop=0,e.scrollTo(t,i)})},recalculate:function(e){var t=this,i=this.$refs,l=i.tableBody,o=i.tableHeader,r=i.tableFooter,n=l?l.$el:null,s=o?o.$el:null,a=r?r.$el:null;return n&&(this.autoCellWidth(s,n,a),!0===e)?this.computeScrollLoad().then(function(){t.autoCellWidth(s,n,a),t.computeScrollLoad()}):this.computeScrollLoad()},autoCellWidth:function(e,t,i){var l,o=0,r=t.clientWidth,n=r,s=this.fit,a=this.columnStore,c=a.resizeList,h=a.pxMinList,u=a.pxList,d=a.scaleList,f=a.scaleMinList,p=a.autoList;if(h.forEach(function(e){var t=parseInt(e.minWidth);o+=t,e.renderWidth=t}),l=n/100,f.forEach(function(e){var t=Math.floor(parseInt(e.minWidth)*l);o+=t,e.renderWidth=t}),d.forEach(function(e){var t=Math.floor(parseInt(e.width)*l);o+=t,e.renderWidth=t}),u.forEach(function(e){var t=parseInt(e.width);o+=t,e.renderWidth=t}),c.forEach(function(e){var t=parseInt(e.resizeWidth);o+=t,e.renderWidth=t}),l=0<(n-=o)?Math.floor(n/(f.length+h.length+p.length)):0,s?0<n&&f.concat(h).forEach(function(e){o+=l,e.renderWidth+=l}):l=40,p.forEach(function(e,t){var i=Math.max(l,40);e.renderWidth=i,o+=i}),s){var g=d.concat(f).concat(h).concat(p),v=g.length-1;if(0<v){var x=r-o;if(0<x){for(;0<x&&0<=v;)x--,g[v--].renderWidth++;o=r}}}var w=t.offsetHeight,m=t.scrollHeight>t.clientHeight;if(this.scrollbarWidth=m?t.offsetWidth-r:0,this.overflowY=m,this.tableWidth=o,this.tableHeight=w,this.isCoverBody=r-2<=o,this.parentHeight=this.getParentHeight(),e&&(this.headerHeight=e.clientHeight+1,e.scrollLeft!==t.scrollLeft&&(e.scrollLeft=t.scrollLeft)),i){var T=i.offsetHeight;this.scrollbarHeight=Math.max(T-i.clientHeight,0),this.overflowX=o>i.clientWidth,this.footerHeight=T}else this.scrollbarHeight=Math.max(w-t.clientHeight,0),this.overflowX=r<o;this.overflowX&&this.checkScrolling()},resetResizable:function(){return this.tableFullColumn.forEach(function(e){e.resizeWidth=0}),this.$toolbar&&this.$toolbar.resetResizable(),this.analyColumnWidth(),this.recalculate(!0)},updateStyle:function(){var v=this,t=this.$refs,x=this.isGroup,w=this.fullColumnIdData,m=this.maxHeight,e=this.height,T=this.parentHeight,b=this.border,R=this.tableColumn,C=this.headerHeight,_=this.showHeaderOverflow,y=this.showFooter,E=this.showOverflow,S=this.footerHeight,D=this.tableHeight,U=this.tableWidth,k=this.scrollbarHeight,$=this.scrollbarWidth,I=this.scrollXLoad,L=this.scrollYLoad,A=this.cellOffsetWidth,M=this.columnStore,O=this.elemStore,i=this.editStore,l=this.currentRow,o=this.mouseConfig,F=0;e&&(F="auto"===e?T:(_tools.DomTools.isScale(e)?Math.floor(parseInt(e)/100*T):_xeUtils.default.toNumber(e))-this.getExcludeHeight(),y&&(F+=k+1));var r=t.emptyPlaceholder;return r&&(r.style.top=e?"":"".concat(C,"px")),["main","left","right"].forEach(function(d,e){var f=0<e?d:"",p=M["".concat(f,"List")],g=t["".concat(f,"Container")];["header","body","footer"].forEach(function(a){var e=O["".concat(d,"-").concat(a,"-wrapper")],t=O["".concat(d,"-").concat(a,"-table")];if("header"===a){var i=U;I&&(f&&(R=p),i=R.reduce(function(e,t){return e+t.renderWidth},0)),t&&(t.style.width=i?"".concat(i+$,"px"):"",browse.msie&&_xeUtils.default.arrayEach(t.querySelectorAll(".vxe-resizable"),function(e){e.style.height="".concat(e.parentNode.offsetHeight,"px")}));var l=O["".concat(d,"-").concat(a,"-repair")];l&&(l.style.width="".concat(U,"px"));var o=O["".concat(d,"-").concat(a,"-list")];x&&o&&_xeUtils.default.arrayEach(o.querySelectorAll(".col--group"),function(e){var t=v.getColumnNode(e).item,i=t.showHeaderOverflow,l=_xeUtils.default.isBoolean(i)?i:_,o=0,r=0;"title"!==l&&(!0!==l&&"tooltip"!==l)&&"ellipsis"!==l||(_xeUtils.default.eachTree(t.children,function(e){e.children&&t.children.length||r++,o+=e.renderWidth}),e.style.width="".concat(o-r-(b?2:0),"px"))})}else if("body"===a){var r=O["".concat(d,"-").concat(a,"-emptyBlock")];if(e&&(m?(m="auto"===m?T:_tools.DomTools.isScale(m)?Math.floor(parseInt(m)/100*T):_xeUtils.default.toNumber(m),e.style.maxHeight="".concat(f?m-C-(y?0:k):m-C,"px")):e.style.height=0<F?"".concat(f?(0<F?F-C-S:D)-(y?0:k):F-C-S,"px"):""),g){var n="right"===f,s=M["".concat(f,"List")];e.style.top="".concat(C,"px"),g.style.height="".concat((0<F?F-C-S:D)+C+S-k*(y?2:1),"px"),g.style.width="".concat(s.reduce(function(e,t){return e+t.renderWidth},n?$:0)-(b?1:0),"px")}var c=U;f&&E?c=(R=p).reduce(function(e,t){return e+t.renderWidth},0):I&&(f&&(R=p),c=R.reduce(function(e,t){return e+t.renderWidth},0)),t&&(t.style.width=c?"".concat(c,"px"):"",t.style.paddingRight=$&&f&&(browse["-moz"]||browse.safari)?"".concat($,"px"):""),r&&(r.style.width=c?"".concat(c,"px"):"")}else if("footer"===a){var h=U;f&&E?h=(R=p).reduce(function(e,t){return e+t.renderWidth},0):I&&(f&&(R=p),h=R.reduce(function(e,t){return e+t.renderWidth},0)),e&&(g&&(e.style.top="".concat(0<F?F-S:D+C,"px")),e.style.marginTop="".concat(-k-1,"px")),t&&(t.style.width=h?"".concat(h+$,"px"):"")}var u=O["".concat(d,"-").concat(a,"-colgroup")];u&&_xeUtils.default.arrayEach(u.children,function(e){var t=e.getAttribute("name");if("col_gutter"===t&&(e.style.width="".concat($,"px")),w[t]){var i,s=w[t].column,l=s.showHeaderOverflow,o=s.showOverflow;e.style.width="".concat(s.renderWidth,"px");var r="title"===(i="header"===a?_xeUtils.default.isUndefined(l)||_xeUtils.default.isNull(l)?_:l:_xeUtils.default.isUndefined(o)||_xeUtils.default.isNull(o)?E:o)||(!0===i||"tooltip"===i)||"ellipsis"===i,n=O["".concat(d,"-").concat(a,"-list")];!I&&!L||r||(r=!0),n&&r&&_xeUtils.default.arrayEach(n.querySelectorAll(".".concat(s.id)),function(e){var t=parseInt(e.getAttribute("colspan")||1),i=e.querySelector(".vxe-cell"),l=s.renderWidth;if(i){if(1<t)for(var o=v.getColumnIndex(s),r=1;r<t;r++){var n=v.getColumns(o+r);n&&(l+=n.renderWidth)}i.style.width="".concat(l-A*t,"px")}})}})})}),l&&this.setCurrentRow(l),o&&o.selected&&i.selected.row&&i.selected.column&&this.addColSdCls(),this.$nextTick()},checkScrolling:function(){var e=this.$refs,t=e.tableBody,i=e.leftContainer,l=e.rightContainer,o=t?t.$el:null;o&&(i&&_tools.DomTools[0<o.scrollLeft?"addClass":"removeClass"](i,"scrolling--middle"),l&&_tools.DomTools[o.clientWidth<o.scrollWidth-o.scrollLeft?"addClass":"removeClass"](l,"scrolling--middle"))},preventEvent:function(t,e,i,l,o){var r,n=this;return _vXETable.Interceptor.get(e).some(function(e){return!1===e(i,t,n)})||l&&(r=l()),o&&o(),r},handleGlobalMousedownEvent:function(i){var l=this,o=this.$el,e=this.$refs,t=this.editStore,r=this.ctxMenuStore,n=this.editConfig,s=void 0===n?{}:n,a=this.filterStore,c=this.getRowNode,h=t.actived,u=e.filterWrapper,d=e.validTip;u&&(_tools.DomTools.getEventTargetNode(i,o,"vxe-filter-wrapper").flag||_tools.DomTools.getEventTargetNode(i,u.$el).flag||this.preventEvent(i,"event.clearFilter",a.args,this.closeFilter)),h.row&&!1!==s.autoClear&&(d&&_tools.DomTools.getEventTargetNode(i,d.$el).flag||(!this.lastCallTime||this.lastCallTime+50<Date.now())&&this.preventEvent(i,"event.clearActived",h.args,function(){var e;if("row"===s.mode){var t=_tools.DomTools.getEventTargetNode(i,o,"vxe-body--row");e=t.flag?c(t.targetElem).item!==c(h.args.cell.parentNode).item:0}else e=!_tools.DomTools.getEventTargetNode(i,o,"col--edit").flag;!e&&_tools.DomTools.getEventTargetNode(i,o).flag||setTimeout(function(){return l.clearActived(i)})})),r.visible&&this.$refs.ctxWrapper&&!_tools.DomTools.getEventTargetNode(i,this.$refs.ctxWrapper.$el).flag&&this.closeMenu(),this.isActivated=_tools.DomTools.getEventTargetNode(i,(this.$grid||this).$el).flag},handleGlobalBlurEvent:function(){this.closeFilter(),this.closeMenu()},handleGlobalMousewheelEvent:function(){this.clostTooltip(),this.closeMenu()},handleGlobalKeydownEvent:function(F){var W=this;this.isActivated&&this.preventEvent(F,"event.keydown",{$table:this},function(){var e,t=W.isCtxMenu,i=W.ctxMenuStore,l=W.editStore,o=W.mouseConfig,r=void 0===o?{}:o,n=W.keyboardConfig,s=void 0===n?{}:n,a=W.treeConfig,c=W.treeOpts,h=W.highlightCurrentRow,u=W.currentRow,d=l.selected,f=l.actived,p=F.keyCode,g=8===p,v=9===p,x=13===p,w=27===p,m=32===p,T=37===p,b=38===p,R=39===p,C=40===p,_=46===p,y=65===p,E=67===p,S=86===p,D=88===p,U=113===p,k=F.ctrlKey,$=F.shiftKey,I=T||b||R||C,L=t&&i.visible&&(x||m||I);if(w)W.closeMenu(),W.closeFilter(),f.row&&(e=f.args,W.clearActived(F),r.selected&&W.$nextTick(function(){return W.handleSelected(e,F)}));else if(m&&(s.isArrow||s.isTab)&&d.row&&d.column&&("checkbox"===d.column.type||"selection"===d.column.type||"radio"===d.column.type))F.preventDefault(),"checkbox"===d.column.type||"selection"===d.column.type?W.handleToggleCheckRowEvent(d.args,F):W.triggerRadioRowEvent(F,d.args);else if(x&&(s.isArrow||s.isTab)&&(d.row||f.row||a&&h&&u)){if(d.row||f.row)W.moveSelected(d.row?d.args:f.args,T,b,R,!0,F);else if(a&&h&&u){var A=u[c.children];if(A&&A.length){F.preventDefault();var M=A[0];e={$table:W,row:M},W.setTreeExpansion(u,!0).then(function(){return W.scrollToRow(M)}).then(function(){return W.triggerCurrentRowEvent(F,e)})}}}else if(L)F.preventDefault(),i.showChild&&_tools.UtilTools.hasChildrenList(i.selected)?W.moveCtxMenu(F,p,i,"selectChild",37,!1,i.selected.children):W.moveCtxMenu(F,p,i,"selected",39,!0,W.ctxMenuList);else if(U)d.row&&d.column&&(F.preventDefault(),W.handleActived(d.args,F));else if(I&&s.isArrow)d.row&&d.column?W.moveSelected(d.args,T,b,R,C,F):(b||C)&&h&&u&&W.moveCurrentRow(b,C,F);else if(v&&s.isTab)d.row||d.column?W.moveTabSelected(d.args,$,F):(f.row||f.column)&&W.moveTabSelected(f.args,$,F);else if(_||(a&&h&&u?g&&s.isArrow:g)){if(s.isDel&&(d.row||d.column))_tools.UtilTools.setCellValue(d.row,d.column,null),g&&W.handleActived(d.args,F);else if(g&&s.isArrow&&a&&h&&u){var O=_xeUtils.default.findTree(W.afterFullData,function(e){return e===u},c).parent;O&&(F.preventDefault(),e={$table:W,row:O},W.setTreeExpansion(O,!1).then(function(){return W.scrollToRow(O)}).then(function(){return W.triggerCurrentRowEvent(F,e)}))}}else s.isCut&&k&&(y||D||E||S)?y?W.handleAllChecked(F):D||E?W.handleCopyed(D,F):W.handlePaste(F):s.isEdit&&!k&&(48<=p&&p<=57||65<=p&&p<=90||96<=p&&p<=111||186<=p&&p<=192||219<=p&&p<=222||32===p)&&d.column&&d.row&&d.column.editRender&&(s.editMethod&&!1===s.editMethod(d.args,F)||(_tools.UtilTools.setCellValue(d.row,d.column,null),W.handleActived(d.args,F)))})},handleGlobalResizeEvent:function(){this.recalculate()},handleTooltipLeaveEvent:function(){var e=this,t=this.tooltipOpts;setTimeout(function(){e.tooltipActive||e.clostTooltip()},t.leaveDelay)},handleTargetEnterEvent:function(){clearTimeout(this.tooltipTimeout),this.tooltipActive=!0,this.clostTooltip()},handleTargetLeaveEvent:function(){var e=this,t=this.tooltipOpts;this.tooltipActive=!1,t.enterable?this.tooltipTimeout=setTimeout(function(){e.$refs.tooltip.isHover||e.clostTooltip()},t.leaveDelay):this.clostTooltip()},triggerHeaderTooltipEvent:function(e,t){var i=this.tooltipStore,l=t.column;this.handleTargetEnterEvent(),i.column===l&&i.visible||this.handleTooltip(e,l)},triggerFooterTooltipEvent:function(e,t){var i=t.column,l=this.tooltipStore;this.handleTargetEnterEvent(),l.column===i&&l.visible||this.handleTooltip(e,i)},triggerTooltipEvent:function(e,t){var i=this.editConfig,l=this.editStore,o=this.tooltipStore,r=l.actived,n=t.row,s=t.column;this.handleTargetEnterEvent(),i&&("row"===i.mode&&r.row===n||r.row===n&&r.column===s)||o.column===s&&o.row===n&&o.visible||this.handleTooltip(e,s,n)},handleTooltip:function(e,t,i){var l=e.currentTarget,o=this.$refs.tooltip,r=l.children[0],n=l.innerText;return n&&r.scrollWidth>r.clientWidth&&(Object.assign(this.tooltipStore,{row:i,column:t,visible:!0}),o&&o.toVisible(l,_tools.UtilTools.formatText(n))),this.$nextTick()},clostTooltip:function(){var e=this.$refs.tooltip;return Object.assign(this.tooltipStore,{row:null,column:null,content:null,visible:!1}),e&&e.close(),this.$nextTick()},handleDefaultSelectionChecked:function(){var t=this.fullDataRowIdData,e=this.checkboxOpts,i=e.checkAll,l=e.checkRowKeys;if(i)this.setAllSelection(!0);else if(l){var o=[];l.forEach(function(e){t[e]&&o.push(t[e].row)}),this.setSelection(o,!0)}},setSelection:function(e,t){var i=this;return e&&!_xeUtils.default.isArray(e)&&(e=[e]),e.forEach(function(e){return i.handleSelectRow({row:e},!!t)}),this.$nextTick()},isCheckedByRow:function(e){var t=this.checkboxOpts.checkField;return t?_xeUtils.default.get(e,t):this.selection.includes(e)},handleSelectRow:function(e,i){var l=this,o=e.row,r=this.selection,t=this.tableFullData,n=this.treeConfig,s=this.treeOpts,a=this.treeIndeterminates,c=this.checkboxOpts,h=c.checkField,u=c.checkStrictly,d=c.checkMethod;if(h)if(n&&!u){-1===i?(a.push(o),_xeUtils.default.set(o,h,!1)):(_xeUtils.default.eachTree([o],function(e,t){o!==e&&d&&!d({row:e,$rowIndex:t})||(_xeUtils.default.set(e,h,i),l.handleSelectReserveRow(o,i))},s),_xeUtils.default.remove(a,function(e){return e===o}));var f=_xeUtils.default.findTree(t,function(e){return e===o},s);if(f&&f.parent){var p,g=d?f.items.filter(function(e,t){return d({row:e,$rowIndex:t})}):f.items;if(_xeUtils.default.find(f.items,function(e){return a.includes(e)}))p=-1;else{var v=f.items.filter(function(e){return _xeUtils.default.get(e,h)});p=v.filter(function(e){return g.includes(e)}).length===g.length||!(!v.length&&-1!==i)&&-1}return this.handleSelectRow({row:f.parent},p)}}else _xeUtils.default.set(o,h,i),this.handleSelectReserveRow(o,i);else if(n&&!u){-1===i?(a.push(o),_xeUtils.default.remove(r,function(e){return e===o})):(_xeUtils.default.eachTree([o],function(t,e){o!==t&&d&&!d({row:t,$rowIndex:e})||(i?r.push(t):_xeUtils.default.remove(r,function(e){return e===t}),l.handleSelectReserveRow(o,i))},s),_xeUtils.default.remove(a,function(e){return e===o}));var x=_xeUtils.default.findTree(t,function(e){return e===o},s);if(x&&x.parent){var w,m=d?x.items.filter(function(e,t){return d({row:e,$rowIndex:t})}):x.items;if(_xeUtils.default.find(x.items,function(e){return a.includes(e)}))w=-1;else{var T=x.items.filter(function(e){return r.includes(e)});w=T.filter(function(e){return m.includes(e)}).length===m.length||!(!T.length&&-1!==i)&&-1}return this.handleSelectRow({row:x.parent},w)}}else i?r.includes(o)||r.push(o):_xeUtils.default.remove(r,function(e){return e===o}),this.handleSelectReserveRow(o,i);this.checkSelectionStatus()},handleToggleCheckRowEvent:function(e,t){var i=this.selection,l=this.checkboxOpts.checkField,o=e.row,r=l?!_xeUtils.default.get(o,l):!i.includes(o);t?this.triggerCheckRowEvent(t,e,r):this.handleSelectRow(e,r)},triggerCheckRowEvent:function(e,t,i){var l=this.checkboxOpts.checkMethod;l&&!l({row:t.row,rowIndex:t.rowIndex,$rowIndex:t.$rowIndex})||(this.handleSelectRow(t,i),_tools.UtilTools.emitEvent(this,"select-change",[Object.assign({selection:this.getSelectRecords(),reserves:this.getSelectReserveRecords(),checked:i,$table:this},t),e]))},toggleRowSelection:function(e){return this.handleToggleCheckRowEvent({row:e}),this.$nextTick()},setAllSelection:function(l){var i=this,e=this.tableFullData,t=this.treeConfig,o=this.treeOpts,r=this.selection,n=this.selectReserveRowMap,s=this.checkboxOpts,a=s.checkField,c=s.reserve,h=s.checkStrictly,u=s.checkMethod,d=[];if(!h){if(a){var f="".concat(t?"$":"","rowIndex"),p=function(e,t){var i;u&&!u((_defineProperty(i={row:e},f,t),_defineProperty(i,"$rowIndex",t),i))||_xeUtils.default.set(e,a,l)},g=function(e,t){var i;u&&(u((_defineProperty(i={row:e},f,t),_defineProperty(i,"$rowIndex",t),i))||!r.includes(e))||_xeUtils.default.set(e,a,l)};t?_xeUtils.default.eachTree(e,l?p:g,o):e.forEach(l?p:g)}else t?l?_xeUtils.default.eachTree(e,function(e,t){u&&!u({row:e,$rowIndex:t})||d.push(e)},o):u&&_xeUtils.default.eachTree(e,function(e,t){!u({row:e,$rowIndex:t})&&r.includes(e)&&d.push(e)},o):l?d=u?e.filter(function(e,t){return r.includes(e)||u({row:e,rowIndex:t,$rowIndex:t})}):e.slice(0):u&&(d=e.filter(function(e,t){return u({row:e,rowIndex:t,$rowIndex:t})?0:r.includes(e)}));c&&(l?d.forEach(function(e){n[_tools.UtilTools.getRowid(i,e)]=e}):e.forEach(function(e){var t=_tools.UtilTools.getRowid(i,e);n[t]&&delete n[t]})),this.selection=d}this.treeIndeterminates=[],this.checkSelectionStatus()},checkSelectionStatus:function(){var e=this.tableFullData,t=this.editStore,i=this.selection,l=this.treeIndeterminates,o=this.checkboxOpts,r=o.checkField,n=o.checkStrictly,s=o.checkMethod,a=t.insertList;a.length&&(e=e.concat(a)),n||(r?(this.isAllSelected=e.length&&e.every(s?function(e,t){return!s({row:e,rowIndex:t,$rowIndex:t})||_xeUtils.default.get(e,r)}:function(e){return _xeUtils.default.get(e,r)}),this.isIndeterminate=!this.isAllSelected&&e.some(function(e){return _xeUtils.default.get(e,r)||l.includes(e)})):(this.isAllSelected=e.length&&e.every(s?function(e,t){return!s({row:e,rowIndex:t,$rowIndex:t})||i.includes(e)}:function(e){return i.includes(e)}),this.isIndeterminate=!this.isAllSelected&&e.some(function(e){return l.includes(e)||i.includes(e)})))},handleReserveStatus:function(){var e=this.rowId,t=this.treeConfig,i=this.fullDataRowIdData,l=this.selectReserveRowMap,o=this.checkboxOpts,r=[],n=[],s=[],a=[];e&&this.handleReserveByRowid(this.selection,r),o.reserve&&Object.keys(l).forEach(function(e){i[e]&&!r.includes(i[e].row)&&r.push(i[e].row)}),this.selection=r,e&&this.handleReserveByRowid(this.rowExpandeds,n),this.rowExpandeds=n,e&&t&&(this.handleReserveByRowid(this.treeIndeterminates,a),this.handleReserveByRowid(this.treeExpandeds,s)),this.treeExpandeds=s,this.treeIndeterminates=a},handleReserveByRowid:function(e,i){var l=this,o=this.fullDataRowIdData;e.forEach(function(e){var t=_tools.UtilTools.getRowid(l,e);o[t]&&i.push(o[t].row)})},getSelectReserveRecords:function(){var i=this.fullDataRowIdData,l=this.selectReserveRowMap,e=this.checkboxOpts,o=[];return e.reserve&&Object.keys(l).forEach(function(e,t){i[e]||o.push(l[e])}),o},clearSelectReserve:function(){this.selectReserveRowMap={}},handleSelectReserveRow:function(e,t){var i=this.selectReserveRowMap;if(this.checkboxOpts.reserve){var l=_tools.UtilTools.getRowid(this,e);t?i[l]=e:i[l]&&delete i[l]}},triggerCheckAllEvent:function(e,t){this.setAllSelection(t),_tools.UtilTools.emitEvent(this,"select-all",[{selection:this.getSelectRecords(),reserves:this.getSelectReserveRecords(),checked:t,$table:this},e])},toggleAllSelection:function(){return this.triggerCheckAllEvent(null,!this.isAllSelected),this.$nextTick()},clearSelection:function(){var e=this.tableFullData,t=this.treeConfig,i=this.treeOpts,l=this.checkboxOpts.checkField;return l&&(t?_xeUtils.default.eachTree(e,function(e){return _xeUtils.default.set(e,l,!1)},i):e.forEach(function(e){return _xeUtils.default.set(e,l,!1)})),this.isAllSelected=!1,this.isIndeterminate=!1,this.selection=[],this.treeIndeterminates=[],this.$nextTick()},handleDefaultRadioChecked:function(){var e=this.radioOpts,t=this.fullDataRowIdData,i=e.checkRowKey;i&&t[i]&&this.setRadioRow(t[i].row)},triggerRadioRowEvent:function(e,t){var i=this.radioOpts.checkMethod;if(!i||i({row:t.row,rowIndex:t.rowIndex,$rowIndex:t.$rowIndex})){var l=this.selectRow!==t.row;this.setRadioRow(t.row),l&&_tools.UtilTools.emitEvent(this,"radio-change",[t,e])}},triggerCurrentRowEvent:function(e,t){var i=this.currentRow!==t.row;this.setCurrentRow(t.row),i&&_tools.UtilTools.emitEvent(this,"current-change",[t,e])},setCurrentRow:function(e){return this.clearCurrentRow(),this.clearCurrentColumn(),this.currentRow=e,this.highlightCurrentRow&&_xeUtils.default.arrayEach(this.$el.querySelectorAll('[data-rowid="'.concat(_tools.UtilTools.getRowid(this,e),'"]')),function(e){return _tools.DomTools.addClass(e,"row--current")}),this.$nextTick()},setRadioRow:function(e){return this.selectRow!==e&&this.clearRadioRow(),this.selectRow=e,this.$nextTick()},clearCurrentRow:function(){return this.currentRow=null,this.hoverRow=null,_xeUtils.default.arrayEach(this.$el.querySelectorAll(".row--current"),function(e){return _tools.DomTools.removeClass(e,"row--current")}),this.$nextTick()},clearRadioRow:function(){return this.selectRow=null,this.$nextTick()},getCurrentRow:function(){return this.currentRow},getRadioRow:function(){return this.selectRow},triggerHoverEvent:function(e,t){var i=t.row;this.setHoverRow(i)},setHoverRow:function(e){var t=_tools.UtilTools.getRowid(this,e);this.clearHoverRow(),_xeUtils.default.arrayEach(this.$el.querySelectorAll('[data-rowid="'.concat(t,'"]')),function(e){return _tools.DomTools.addClass(e,"row--hover")}),this.hoverRow=e},clearHoverRow:function(){_xeUtils.default.arrayEach(this.$el.querySelectorAll(".vxe-body--row.row--hover"),function(e){return _tools.DomTools.removeClass(e,"row--hover")}),this.hoverRow=null},triggerHeaderCellClickEvent:function(e,t){var i=this._lastResizeTime,l=this.sortOpts,o=t.column,r=t.cell,n=i&&i>Date.now()-300,s=_tools.DomTools.getEventTargetNode(e,r,"vxe-sort-wrapper").flag,a=_tools.DomTools.getEventTargetNode(e,r,"vxe-filter-wrapper").flag;return"cell"!==l.trigger||n||s||a||this.triggerSortEvent(e,o,"desc"===o.order?"asc":"desc"),_tools.UtilTools.emitEvent(this,"header-cell-click",[Object.assign({triggerResizable:n,triggerSort:s,triggerFilter:a},t),e]),this.highlightCurrentColumn?this.setCurrentColumn(o,!0):this.$nextTick()},setCurrentColumn:function(e){return this.clearCurrentRow(),this.clearCurrentColumn(),this.currentColumn=e,_xeUtils.default.arrayEach(this.$el.querySelectorAll(".".concat(e.id)),function(e){return _tools.DomTools.addClass(e,"col--current")}),this.$nextTick()},clearCurrentColumn:function(){return this.currentColumn=null,_xeUtils.default.arrayEach(this.$el.querySelectorAll(".col--current"),function(e){return _tools.DomTools.removeClass(e,"col--current")}),this.$nextTick()},checkValidate:function(e){return _vXETable.default._valid?this.triggerValidate(e):this.$nextTick()},handleChangeCell:function(e,t){var i=this;this.checkValidate("blur").catch(function(e){return e}).then(function(){i.handleActived(t,e).then(function(){return i.checkValidate("change")}).catch(function(e){return e})})},triggerCellClickEvent:function(e,t){var i=this.$el,l=this.highlightCurrentRow,o=this.editStore,r=this.radioOpts,n=this.expandOpts,s=this.treeOpts,a=this.editConfig,c=this.checkboxOpts,h=this.mouseConfig,u=void 0===h?{}:h,d=o.actived,f=t.row,p=t.column;isTargetRadioOrCheckbox(e,p,"radio")||isTargetRadioOrCheckbox(e,p,"checkbox","checkbox")||isTargetRadioOrCheckbox(e,p,"selection","checkbox")||("row"!==n.trigger&&("expand"!==p.type||"cell"!==n.trigger)||_tools.DomTools.getEventTargetNode(e,i,"vxe-table--expanded").flag||this.triggerRowExpandEvent(e,t),("row"===s.trigger||p.treeNode&&"cell"===s.trigger)&&this.triggerTreeExpandEvent(e,t),p.treeNode&&_tools.DomTools.getEventTargetNode(e,i,"vxe-tree-wrapper").flag||"expand"===p.type&&_tools.DomTools.getEventTargetNode(e,i,"vxe-table--expanded").flag||(l&&("row"!==r.trigger&&(_tools.DomTools.getEventTargetNode(e,i,"vxe-checkbox").flag||_tools.DomTools.getEventTargetNode(e,i,"vxe-radio").flag)||this.triggerCurrentRowEvent(e,t)),"row"!==r.trigger&&("radio"!==p.type||"cell"!==r.trigger)||_tools.DomTools.getEventTargetNode(e,i,"vxe-radio").flag||this.triggerRadioRowEvent(e,t),"row"!==c.trigger&&("checkbox"!==p.type&&"selection"!==p.type||"cell"!==c.trigger)||_tools.DomTools.getEventTargetNode(e,t.cell,"vxe-checkbox").flag||this.handleToggleCheckRowEvent(t,e),u.checked||a&&("manual"===a.trigger?d.args&&d.row===f&&p!==d.column&&this.handleChangeCell(e,t):d.args&&f===d.row&&p===d.column||("click"===a.trigger?this.handleChangeCell(e,t):"dblclick"===a.trigger&&("row"===a.mode&&d.row===f?this.handleChangeCell(e,t):this.handleSelected(t,e))))),_tools.UtilTools.emitEvent(this,"cell-click",[t,e]))},triggerCellDBLClickEvent:function(e,t){var i=this,l=this.editStore,o=this.editConfig,r=l.actived;o&&"dblclick"===o.trigger&&(r.args&&e.currentTarget===r.args.cell||("row"===o.mode?this.checkValidate("blur").catch(function(e){return e}).then(function(){i.handleActived(t,e).then(function(){return i.checkValidate("change")}).catch(function(e){return e})}):"cell"===o.mode&&this.handleActived(t,e).then(function(){return i.checkValidate("change")}).catch(function(e){return e}))),_tools.UtilTools.emitEvent(this,"cell-dblclick",[t,e])},handleDefaultSort:function(){var e=this.sortOpts.defaultSort;if(e){var t=e.field,i=e.order;if(t&&i){var l=_xeUtils.default.find(this.visibleColumn,function(e){return e.property===t});l&&!l.order&&this.sort(t,i)}}},triggerSortEvent:function(e,t,i){var l=t.property;if(t.sortable||t.remoteSort){var o={column:t,property:l,field:l,prop:l,order:i,$table:this};t.order===i?(o.order=null,this.clearSort(t.property)):this.sort(l,i),_tools.UtilTools.emitEvent(this,"sort-change",[o,e])}},sort:function(t,e){var i=this.visibleColumn,l=this.tableFullColumn,o=this.remoteSort,r=this.sortOpts,n=_xeUtils.default.find(i,function(e){return e.property===t});if(n){var s=_xeUtils.default.isBoolean(n.remoteSort)?n.remoteSort:r.remote||o;if(n.sortable||n.remoteSort)return e=e||("desc"===n.order?"asc":"desc"),n.order!==e&&(l.forEach(function(e){e.order=null}),n.order=e,s||this.handleTableData(!0)),this.$nextTick().then(this.updateStyle)}return this.$nextTick()},clearSort:function(){return this.tableFullColumn.forEach(function(e){e.order=null}),this.handleTableData(!0)},getSortColumn:function(){return this.visibleColumn.fild(function(e){return e.sortable&&e.order})},closeFilter:function(){return Object.assign(this.filterStore,{isAllSelected:!1,isIndeterminate:!1,options:[],visible:!1}),this.$nextTick()},isFilter:function(e){if(e){var t=this.getColumnByField(e);return t.filters&&t.filters.some(function(e){return e.checked})}return this.visibleColumn.some(function(e){return e.filters&&e.filters.some(function(e){return e.checked})})},isRowExpandLoaded:function(e){var t=this.fullAllDataRowMap.get(e);return t&&t.expandLoaded},clearRowExpandLoaded:function(t){var e=this.expandOpts,i=this.expandLazyLoadeds,l=this.fullAllDataRowMap,o=e.lazy,r=l.get(t);return o&&r&&(r.expandLoaded=!1,_xeUtils.default.remove(i,function(e){return t===e})),this.$nextTick()},reloadExpandContent:function(e){var t=this,i=this.expandOpts,l=this.expandLazyLoadeds;return i.lazy&&!l.includes(e)&&this.clearRowExpandLoaded(e).then(function(){return t.handleAsyncRowExpand(e)}),this.$nextTick()},triggerRowExpandEvent:function(e,t){var i=this.$listeners,l=this.expandOpts,o=this.expandLazyLoadeds,r=t.row;if(!l.lazy||!o.includes(r)){var n=!this.isExpandByRow(r);this.setRowExpansion(r,n),i["toggle-expand-change"]?(_tools.UtilTools.warn("vxe.error.delEvent",["toggle-expand-change","toggle-row-expand"]),_tools.UtilTools.emitEvent(this,"toggle-expand-change",[{expanded:n,row:r,rowIndex:this.getRowIndex(r),$table:this},e])):_tools.UtilTools.emitEvent(this,"toggle-row-expand",[{expanded:n,row:r,rowIndex:this.getRowIndex(r),$table:this},e])}},toggleRowExpansion:function(e){return this.setRowExpansion(e,!this.isExpandByRow(e))},handleDefaultRowExpand:function(){var e=this.expandOpts,t=this.fullDataRowIdData,i=e.expandAll,l=e.expandRowKeys;if(i)this.setAllRowExpansion(!0);else if(l){var o=[];l.forEach(function(e){t[e]&&o.push(t[e].row)}),this.setRowExpansion(o,!0)}},setAllRowExpansion:function(e){return this.expandOpts.lazy?this.setRowExpansion(this.tableData,!0):(this.rowExpandeds=e?this.tableFullData.slice(0):[],this.$nextTick().then(this.recalculate))},handleAsyncRowExpand:function(t){var i=this,e=this.fullAllDataRowMap,l=this.rowExpandeds,o=this.expandLazyLoadeds,r=this.expandOpts.loadMethod,n=e.get(t);return new Promise(function(e){o.push(t),r({$table:i,row:t}).catch(function(e){return e}).then(function(){n.expandLoaded=!0,_xeUtils.default.remove(o,function(e){return e===t}),l.push(t),e(i.$nextTick().then(i.recalculate))})})},setRowExpansion:function(t,e){var i=this,l=this.fullAllDataRowMap,o=this.rowExpandeds,r=this.expandLazyLoadeds,n=this.expandOpts,s=n.lazy,a=n.accordion,c=[];return t&&(_xeUtils.default.isArray(t)||(t=[t]),a&&(o=[],t=t.slice(t.length-1,t.length)),e?t.forEach(function(e){if(!o.includes(e)){var t=l.get(e);s&&!t.expandLoaded&&r.includes(e)?c.push(i.handleAsyncRowExpand(e)):o.push(e)}}):_xeUtils.default.remove(o,function(e){return t.includes(e)})),this.rowExpandeds=o,Promise.all(c).then(this.recalculate)},hasRowExpand:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["hasRowExpand","isExpandByRow"]),this.isExpandByRow(e)},isExpandByRow:function(e){return this.rowExpandeds.includes(e)},clearRowExpand:function(){var e=this,t=this.rowExpandeds.length;return this.rowExpandeds=[],this.$nextTick().then(function(){return t?e.recalculate():0})},getRowExpandRecords:function(){return this.rowExpandeds.slice(0)},getTreeExpandRecords:function(){return this.treeExpandeds.slice(0)},getTreeStatus:function(){return this.treeConfig?{config:this.treeOpts,rowExpandeds:this.getTreeExpandRecords()}:null},isTreeExpandLoaded:function(e){var t=this.fullAllDataRowMap.get(e);return t&&t.treeLoaded},clearTreeExpandLoaded:function(t){var e=this.treeOpts,i=this.treeExpandeds,l=this.fullAllDataRowMap,o=e.lazy,r=l.get(t);return o&&r&&(r.treeLoaded=!1,_xeUtils.default.remove(i,function(e){return t===e})),this.$nextTick()},reloadTreeChilds:function(e){var t=this,i=this.treeOpts,l=this.treeLazyLoadeds,o=i.lazy,r=i.hasChild;return o&&e[r]&&!l.includes(e)&&this.clearTreeExpandLoaded(e).then(function(){return t.handleAsyncTreeExpandChilds(e)}),this.$nextTick()},triggerTreeExpandEvent:function(e,t){var i=this.$listeners,l=this.treeOpts,o=this.treeLazyLoadeds,r=t.row;if(!l.lazy||!o.includes(r)){var n=!this.isTreeExpandByRow(r);this.setTreeExpansion(r,n),i["toggle-tree-change"]?(_tools.UtilTools.warn("vxe.error.delEvent",["toggle-tree-change","toggle-tree-expand"]),_tools.UtilTools.emitEvent(this,"toggle-tree-change",[{expanded:n,row:r,rowIndex:this.getRowIndex(r),$table:this},e])):_tools.UtilTools.emitEvent(this,"toggle-tree-expand",[{expanded:n,row:r,rowIndex:this.getRowIndex(r),$table:this},e])}},toggleTreeExpansion:function(e){return this.setTreeExpansion(e,!this.isTreeExpandByRow(e))},handleDefaultTreeExpand:function(){var e=this.treeConfig,i=this.treeOpts,l=this.tableFullData;if(e){var t=i.expandAll,o=i.expandRowKeys;if(t)this.setAllTreeExpansion(!0);else if(o){var r=[],n=_tools.UtilTools.getRowkey(this);o.forEach(function(t){var e=_xeUtils.default.findTree(l,function(e){return t===_xeUtils.default.get(e,n)},i);e&&r.push(e.item)}),this.setTreeExpansion(r,!0)}}},handleAsyncTreeExpandChilds:function(i){var l=this,e=this.fullAllDataRowMap,o=this.treeExpandeds,t=this.treeOpts,r=this.treeLazyLoadeds,n=t.loadMethod,s=t.children,a=e.get(i);return new Promise(function(t){r.push(i),n({$table:l,row:i}).catch(function(e){return[]}).then(function(e){a.treeLoaded=!0,_xeUtils.default.remove(r,function(e){return e===i}),_xeUtils.default.isArray(e)||(e=[]),e&&(i[s]=e,l.appendTreeCache(i,e),e.length&&!o.includes(i)&&o.push(i),l.isCheckedByRow(i)&&l.setSelection(e,!0)),t(l.$nextTick().then(l.recalculate))})})},setAllTreeExpansion:function(e){var t=this,i=this.tableFullData,l=this.treeOpts,o=l.lazy,r=l.children;if(e)if(o)_xeUtils.default.eachTree(i,function(e){t.setTreeExpansion(e,!0)},l);else{var n=[];_xeUtils.default.eachTree(i,function(e){var t=e[r];t&&t.length&&n.push(e)},l),this.treeExpandeds=n}else this.treeExpandeds=[];return this.$nextTick().then(this.recalculate)},setTreeExpansion:function(t,e){var i=this,l=this.fullAllDataRowMap,o=this.tableFullData,r=this.treeExpandeds,n=this.treeOpts,s=this.treeLazyLoadeds,a=n.lazy,c=n.hasChild,h=n.children,u=n.accordion,d=[];if(t&&(_xeUtils.default.isArray(t)||(t=[t]),t.length)){if(u){t=t.slice(t.length-1,t.length);var f=_xeUtils.default.findTree(o,function(e){return e===t[0]},n);_xeUtils.default.remove(r,function(e){return f.items.includes(e)})}return e?t.forEach(function(e){if(!r.includes(e)){var t=l.get(e);a&&e[c]&&!t.treeLoaded&&!s.includes(e)?d.push(i.handleAsyncTreeExpandChilds(e)):e[h]&&e[h].length&&r.push(e)}}):_xeUtils.default.remove(r,function(e){return t.includes(e)}),Promise.all(d).then(this.recalculate)}return Promise.resolve()},hasTreeExpand:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["hasTreeExpand","isTreeExpandByRow"]),this.isTreeExpandByRow(e)},isTreeExpandByRow:function(e){return this.treeExpandeds.includes(e)},clearTreeExpand:function(){var e=this,t=this.treeExpandeds.length;return this.treeExpandeds=[],this.$nextTick().then(function(){return t?e.recalculate():0})},getVirtualScroller:function(){var e=this.$refs,t=this.scrollXLoad,i=this.scrollYLoad,l=e.tableBody.$el;return{scrollX:t,scrollY:i,scrollTop:l.scrollTop,scrollLeft:l.scrollLeft}},triggerScrollXEvent:function(){this.updateVirtualScrollX()},updateVirtualScrollX:function(e){for(var t=this.$refs,i=this.visibleColumn,l=this.scrollXStore,o=l.startIndex,r=l.renderSize,n=l.offsetSize,s=l.visibleSize,a=t.tableBody.$el.scrollLeft,c=0,h=0,u=e||!1,d=i.length,f=0;f<d;f++)if(a<(h+=i[f].renderWidth)){c=f;break}if(e||l.visibleIndex!==c){var p=Math.min(Math.floor((r-s)/2),s);l.visibleIndex===c?l.startIndex=c:l.visibleIndex>c?(u=c-n<=o)&&(l.startIndex=Math.max(0,Math.max(0,c-p))):(u=o+r<=c+s+n)&&(l.startIndex=Math.max(0,Math.min(i.length-r,c-p))),u&&this.updateScrollXData(),l.visibleIndex=c}this.clostTooltip()},triggerScrollYEvent:function(e){isWebkit&&this.scrollYStore.adaptive?this.loadScrollYData(e):this.debounceScrollY(e)},debounceScrollY:_xeUtils.default.debounce(function(e){this.loadScrollYData(e)},debounceScrollYDuration,{leading:!1,trailing:!0}),loadScrollYData:function(e){var t=this.afterFullData,i=this.scrollYStore,l=this.isLoadData,o=i.startIndex,r=i.renderSize,n=i.offsetSize,s=i.visibleSize,a=i.rowHeight,c=e.target.scrollTop,h=Math.ceil(c/a),u=!1;if(l||i.visibleIndex!==h){var d=Math.min(Math.floor((r-s)/2),s);i.visibleIndex>h?(u=h-n<=o)&&(i.startIndex=Math.max(0,h-Math.max(d,r-s))):(u=o+r<=h+s+n)&&(i.startIndex=Math.max(0,Math.min(t.length-r,h-d))),u&&this.updateScrollYData(),i.visibleIndex=h,this.isLoadData=!1}},computeRowHeight:function(){var e,t=this.$refs.tableBody,i=t?t.$el:null,l=this.$refs.tableHeader;if(i){var o=i.querySelector("tbody>tr");!o&&l&&(o=l.$el.querySelector("thead>tr")),o&&(e=o.clientHeight)}e=e||this.rowHeightMaps[this.vSize||"default"],this.rowHeight=e},computeScrollLoad:function(){var b=this;return this.$nextTick().then(function(){var e=b.vSize,t=b.scrollXLoad,i=b.scrollYLoad,l=b.scrollYStore,o=b.scrollXStore,r=b.visibleColumn,n=b.optimizeOpts,s=b.rowHeightMaps,a=n.scrollX,c=n.scrollY,h=b.$refs.tableBody,u=h?h.$el:null,d=b.$refs.tableHeader;if(u){if(t){var f=u.clientWidth,p=_xeUtils.default.toNumber(a.vSize);if(!a.vSize)for(var g=p=r.length,v=0,x=0;x<g;x++)if(f<(v+=r[x].renderWidth)){p=x+1;break}o.visibleSize=p,a.oSize||(o.offsetSize=p),a.rSize||(o.renderSize=p+4),b.updateScrollXData()}else b.updateScrollXSpace();if(i){var w;if(c.rHeight)w=c.rHeight;else{var m=u.querySelector("tbody>tr");!m&&d&&(m=d.$el.querySelector("thead>tr")),m&&(w=m.clientHeight)}w=w||s[e||"default"];var T=_xeUtils.default.toNumber(c.vSize||Math.ceil(u.clientHeight/w));l.visibleSize=T,l.rowHeight=w,c.oSize||(l.offsetSize=T),c.rSize||(l.renderSize=browse.edge?10*T:isWebkit?T+2:6*T),b.updateScrollYData()}else b.updateScrollYSpace()}b.$nextTick(b.updateStyle)})},updateScrollXData:function(){var e=this.visibleColumn,t=this.scrollXStore;this.tableColumn=e.slice(t.startIndex,t.startIndex+t.renderSize),this.updateScrollXSpace()},updateScrollXSpace:function(){var e=this.$refs,l=this.elemStore,t=this.visibleColumn,i=this.scrollXStore,o=this.scrollXLoad,r=this.tableWidth,n=this.scrollbarWidth,s=e.tableHeader,a=e.tableBody,c=e.tableFooter,h=s?s.$el.querySelector(".vxe-table--header"):null,u=a.$el.querySelector(".vxe-table--body"),d=c?c.$el.querySelector(".vxe-table--footer"):null,f=t.slice(0,i.startIndex).reduce(function(e,t){return e+t.renderWidth},0),p="";o&&(p="".concat(f,"px")),h&&(h.style.marginLeft=p),u.style.marginLeft=p,d&&(d.style.marginLeft=p);["main"].forEach(function(i){["header","body","footer"].forEach(function(e){var t=l["".concat(i,"-").concat(e,"-xSpace")];t&&(t.style.width=o?"".concat(r+("header"===e?n:0),"px"):"")})}),this.$nextTick(this.updateStyle)},updateScrollYData:function(){this.handleTableData(),this.updateScrollYSpace()},updateScrollYSpace:function(){var l=this.elemStore,e=this.scrollYStore,t=this.scrollYLoad,i=this.afterFullData.length*e.rowHeight,o=Math.max(e.startIndex*e.rowHeight,0),r="",n="";t&&(r="".concat(o,"px"),n="".concat(i,"px")),["main","left","right"].forEach(function(i){var e=l["".concat(i,"-body-table")];e&&(e.style.marginTop=r),["header","body","footer"].forEach(function(e){var t=l["".concat(i,"-").concat(e,"-ySpace")];t&&(t.style.height=n)})}),this.$nextTick(this.updateStyle)},scrollTo:function(e,t){var i=this,l=this.$refs.tableBody.$el;if(_xeUtils.default.isNumber(e)){var o=this.$refs.tableFooter;o?o.$el.scrollLeft=e:l.scrollLeft=e}if(_xeUtils.default.isNumber(t)){var r=this.$refs.rightBody;r&&(r.$el.scrollTop=t),l.scrollTop=t}return this.scrollXLoad||this.scrollYLoad?new Promise(function(e){return setTimeout(function(){return e(i.$nextTick())},50)}):this.$nextTick()},scrollToRow:function(e,t){var i=[];return e&&(this.treeConfig?i.push(this.scrollToTreeRow(e)):this.fullAllDataRowMap.has(e)&&i.push(_tools.DomTools.rowToVisible(this,e))),i.push(this.scrollToColumn(t)),Promise.all(i)},scrollToColumn:function(e){return e&&this.fullColumnMap.has(e)?_tools.DomTools.colToVisible(this,e):this.$nextTick()},scrollToTreeRow:function(t){var i=this,e=this.tableFullData,l=this.treeConfig,o=this.treeOpts;if(l){var r=_xeUtils.default.findTree(e,function(e){return e===t},o);if(r){var n=r.nodes;n.forEach(function(e,t){t<n.length-1&&!i.isTreeExpandByRow(e)&&i.setTreeExpansion(e,!0)})}}return this.$nextTick()},clearScroll:function(){var t=this,e=this.$refs,i=e.tableBody,l=i?i.$el:null,o=e.tableFooter,r=(o?o.$el:null)||l;return l&&(l.scrollTop=0),r&&(r.scrollLeft=0),new Promise(function(e){return setTimeout(function(){return e(t.$nextTick())})})},updateFooter:function(){var e=this.showFooter,t=this.tableColumn,i=this.footerMethod;return e&&i&&(this.footerData=t.length?i({columns:t,data:this.afterFullData}):[]),this.$nextTick()},updateStatus:function(a,c){var h=this,u=!_xeUtils.default.isUndefined(c);return this.$nextTick().then(function(){var e=h.$refs,t=h.tableData,i=h.editRules,l=h.validStore;if(a&&e.tableBody&&i){var o=a.row,r=a.column;if(h.hasCellRules("change",o,r)){var n=t.indexOf(o),s=_tools.DomTools.getCell(h,{row:o,rowIndex:n,column:r});if(s)return h.validCellRules("change",o,r,c).then(function(){u&&l.visible&&_tools.UtilTools.setCellValue(o,r,c),h.clearValidate()}).catch(function(e){var t=e.rule;u&&_tools.UtilTools.setCellValue(o,r,c),h.showValidTooltip({rule:t,row:o,column:r,cell:s})})}}})},updateZindex:function(){this.tZindex<_tools.UtilTools.getLastZIndex()&&(this.tZindex=_tools.UtilTools.nextZIndex(this))},connect:function(e){var t=e.toolbar;this.$toolbar=t},getEventTargetNode:_tools.DomTools.getEventTargetNode},funcs="filter,clearFilter,closeMenu,getMouseSelecteds,getMouseCheckeds,clearCopyed,clearChecked,clearHeaderChecked,clearIndexChecked,clearSelected,insert,insertAt,remove,removeSelecteds,revert,revertData,getRecordset,getInsertRecords,getRemoveRecords,getUpdateRecords,clearActived,getActiveRow,hasActiveRow,isActiveByRow,setActiveRow,setActiveCell,setSelectCell,clearValidate,fullValidate,validate,exportCsv,openExport,exportData,openImport,importData,readFile,importByFile,print".split(",");funcs.forEach(function(e){Methods[e]=function(){return this["_".concat(e)]?this["_".concat(e)].apply(this,arguments):null}});var _default=Methods;exports.default=_default;