"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils/methods/xe-utils")),_conf=_interopRequireDefault(require("../../conf")),_vXETable=_interopRequireDefault(require("../../v-x-e-table")),_tools=require("../../tools"),_methods=_interopRequireDefault(require("./methods"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function renderFixed(e,t,o){var l=t.tableData,i=t.tableColumn,n=t.visibleColumn,r=t.collectColumn,s=t.isGroup,a=t.vSize,u=t.showHeader,h=t.showFooter,c=t.columnStore,d=t.footerData,f=c["".concat(o,"List")];return e("div",{class:"vxe-table--fixed-".concat(o,"-wrapper"),ref:"".concat(o,"Container")},[u?e("vxe-table-header",{props:{fixedType:o,tableData:l,tableColumn:i,visibleColumn:n,collectColumn:r,size:a,fixedColumn:f,isGroup:s},ref:"".concat(o,"Header")}):null,e("vxe-table-body",{props:{fixedType:o,tableData:l,tableColumn:i,visibleColumn:n,collectColumn:r,fixedColumn:f,size:a,isGroup:s},ref:"".concat(o,"Body")}),h?e("vxe-table-footer",{props:{fixedType:o,footerData:d,tableColumn:i,visibleColumn:n,size:a,fixedColumn:f},ref:"".concat(o,"Footer")}):null])}var _default2={name:"VxeTable",props:{data:Array,customs:Array,height:[Number,String],maxHeight:[Number,String],resizable:{type:Boolean,default:function(){return _conf.default.resizable}},stripe:{type:Boolean,default:function(){return _conf.default.stripe}},border:{type:[Boolean,String],default:function(){return _conf.default.border}},size:{type:String,default:function(){return _conf.default.size}},fit:{type:Boolean,default:function(){return _conf.default.fit}},loading:Boolean,align:{type:String,default:function(){return _conf.default.align}},headerAlign:{type:String,default:function(){return _conf.default.headerAlign}},footerAlign:{type:String,default:function(){return _conf.default.footerAlign}},showHeader:{type:Boolean,default:function(){return _conf.default.showHeader}},startIndex:{type:Number,default:0},highlightCurrentRow:{type:Boolean,default:function(){return _conf.default.highlightCurrentRow}},highlightHoverRow:{type:Boolean,default:function(){return _conf.default.highlightHoverRow}},highlightCurrentColumn:{type:Boolean,default:function(){return _conf.default.highlightCurrentColumn}},highlightHoverColumn:{type:Boolean,default:function(){return _conf.default.highlightHoverColumn}},highlightCell:Boolean,showFooter:Boolean,footerMethod:Function,rowClassName:[String,Function],cellClassName:[String,Function],headerRowClassName:[String,Function],headerCellClassName:[String,Function],footerRowClassName:[String,Function],footerCellClassName:[String,Function],cellStyle:[Object,Function],headerCellStyle:[Object,Function],footerCellStyle:[Object,Function],rowStyle:[Object,Function],headerRowStyle:[Object,Function],footerRowStyle:[Object,Function],spanMethod:Function,footerSpanMethod:Function,showOverflow:{type:[Boolean,String],default:function(){return _conf.default.showOverflow}},showHeaderOverflow:{type:[Boolean,String],default:function(){return _conf.default.showHeaderOverflow}},remoteFilter:Boolean,remoteSort:Boolean,sortMethod:Function,columnWidth:[Number,String],columnMinWidth:[Number,String],columnKey:Boolean,rowKey:Boolean,rowId:{type:String,default:function(){return _conf.default.rowId}},zIndex:Number,autoResize:Boolean,syncResize:Boolean,sortConfig:Object,filterConfig:Object,radioConfig:Object,selectConfig:Object,checkboxConfig:Object,tooltipConfig:Object,expandConfig:Object,treeConfig:Object,contextMenu:Object,mouseConfig:Object,keyboardConfig:Object,editConfig:Object,validConfig:Object,editRules:Object,optimization:Object,params:Object},provide:function(){return{$table:this}},inject:{$grid:{default:null}},mixins:[],data:function(){return{id:_xeUtils.default.uniqueId(),collectColumn:[],tableFullColumn:[],tableColumn:[],tableData:[],scrollXLoad:!1,scrollYLoad:!1,overflowY:!0,overflowX:!1,scrollbarWidth:0,scrollbarHeight:0,rowHeight:0,isAllSelected:!1,isIndeterminate:!1,selection:[],currentRow:null,selectRow:null,footerData:[],rowExpandeds:[],treeExpandeds:[],treeLazyLoadeds:[],treeIndeterminates:[],filterStore:{isAllSelected:!1,isIndeterminate:!1,style:null,options:[],column:null,multiple:!1,visible:!1},columnStore:{leftList:[],centerList:[],rightList:[],resizeList:[],pxList:[],pxMinList:[],scaleList:[],scaleMinList:[],autoList:[]},ctxMenuStore:{selected:null,visible:!1,showChild:!1,selectChild:null,list:[],style:null},editStore:{indexs:{columns:[]},titles:{columns:[]},checked:{rows:[],columns:[],tRows:[],tColumns:[]},selected:{row:null,column:null},copyed:{cut:!1,rows:[],columns:[]},actived:{row:null,column:null},insertList:[],removeList:[]},validStore:{visible:!1,row:null,column:null,content:"",rule:null,isArrow:!1},printUrl:""}},computed:{vSize:function(){return this.size||this.$parent.size||this.$parent.vSize},validOpts:function(){return Object.assign({message:"default"},_conf.default.validConfig,this.validConfig)},optimizeOpts:function(){return Object.assign({},_conf.default.optimization,this.optimization)},rowHeightMaps:function(){return Object.assign({default:48,medium:44,small:40,mini:36},this.optimizeOpts.rHeights)},vaildTipOpts:function(){return Object.assign({isArrow:!1},this.tooltipConfig)},sortOpts:function(){return Object.assign({},_conf.default.sortConfig,this.sortConfig)},isGroup:function(){return this.collectColumn.some(function(e){return _tools.UtilTools.hasChildrenList(e)})},hasTip:function(){return _vXETable.default._tooltip},visibleColumn:function(){return this.tableFullColumn?this.tableFullColumn.filter(function(e){return e.visible}):[]},isResizable:function(){return this.resizable||this.tableFullColumn.some(function(e){return e.resizable})},hasFilter:function(){return this.tableColumn.some(function(e){return e.filters&&e.filters.length})},headerCtxMenu:function(){return this.ctxMenuOpts.header&&this.ctxMenuOpts.header.options?this.ctxMenuOpts.header.options:[]},bodyCtxMenu:function(){return this.ctxMenuOpts.body&&this.ctxMenuOpts.body.options?this.ctxMenuOpts.body.options:[]},isCtxMenu:function(){return this.headerCtxMenu.length||this.bodyCtxMenu.length},ctxMenuOpts:function(){return Object.assign({},_conf.default.menu,this.contextMenu)},ctxMenuList:function(){var t=[];return this.ctxMenuStore.list.forEach(function(e){e.forEach(function(e){t.push(e)})}),t},isAllCheckboxDisabled:function(){var e=this.tableFullData,t=(this.treeConfig,this.checkboxConfig||this.selectConfig||{}),o=t.strict,l=t.checkMethod;return!!o&&(!e.length||!!l&&e.every(function(e,t){return!l({row:e,rowIndex:t,$rowIndex:t})}))}},watch:{data:function(e){this.loadTableData(e,!0).then(this.handleDefault)},customs:function(e){this.isUpdateCustoms||this.mergeCustomColumn(e),this.isUpdateCustoms=!1},collectColumn:function(e){var t=this,o=_tools.UtilTools.getColumnList(e);if(this.tableFullColumn=o,this.cacheColumnMap(),this.customs&&this.mergeCustomColumn(this.customs),this.refreshColumn().then(function(){t.scrollXLoad&&t.updateVirtualScrollX(!0)}),this.handleTableData(!0),this.$toolbar&&this.$toolbar.updateColumn(o),o.length){var l=Math.floor((o.length-1)/2);o[l].prop&&_tools.UtilTools.warn("vxe.error.delProp",["prop","field"]),o[l].label&&_tools.UtilTools.warn("vxe.error.delProp",["label","title"])}this.treeConfig&&o.some(function(e){return e.fixed})&&o.some(function(e){return"expand"===e.type})&&_tools.UtilTools.warn("vxe.error.treeFixedExpand")},tableColumn:function(){this.analyColumnWidth()},height:function(){var e=this;this.$nextTick(function(){return e.recalculate(!0)})},loading:function(){this._isLoading||(this._isLoading=!0)},syncResize:function(e){var t=this;e&&this.$nextTick(function(){return t.recalculate(!0)})}},created:function(){var e,t=this,o=Object.assign(this,{tZindex:0,elemStore:{},scrollXStore:{},scrollYStore:{},tooltipStore:{},parentHeight:0,tableWidth:0,tableHeight:0,headerHeight:0,footerHeight:0,lastScrollLeft:0,lastScrollTop:0,selectReserveRowMap:{},tableFullData:[],afterFullData:[],fullAllDataRowMap:new Map,fullAllDataRowIdData:{},fullDataRowMap:new Map,fullDataRowIdData:{},fullColumnMap:new Map,fullColumnIdData:{}}),l=o.scrollXStore,i=o.scrollYStore,n=o.optimizeOpts,r=o.data,s=o.loading,a=o.treeConfig,u=o.showOverflow,h=n.scrollX,c=n.scrollY;if(this._isLoading=s,_tools.UtilTools.getRowkey(this)||_tools.UtilTools.error("vxe.error.emptyProp",["row-id"]),this.selectConfig&&_tools.UtilTools.warn("vxe.error.delProp",["select-config","checkbox-config"]),a&&a.line&&!u&&_tools.UtilTools.warn("vxe.error.treeLineReqProp",["show-overflow"]),this.sortMethod&&_tools.UtilTools.warn("vxe.error.delProp",["sort-method","sort-config.sortMethod"]),this.remoteSort&&_tools.UtilTools.warn("vxe.error.delProp",["remote-sort","sort-config.remote"]),this.remoteFilter&&_tools.UtilTools.warn("vxe.error.delProp",["remote-filter","filter-config.remote"]),!_vXETable.default._edit&&this.editConfig?e="Edit":!_vXETable.default._valid&&this.editRules?e="Validator":_vXETable.default._keyboard||!this.keyboardConfig&&!this.mouseConfig?!_vXETable.default._resize&&this.autoResize&&(e="Resize"):e="Keyboard",e)throw new Error(_tools.UtilTools.getLog("vxe.error.reqModule",[e]));c&&Object.assign(i,{startIndex:0,visibleIndex:0,adaptive:!_xeUtils.default.isBoolean(c.adaptive)||c.adaptive,renderSize:_xeUtils.default.toNumber(c.rSize),offsetSize:_xeUtils.default.toNumber(c.oSize)}),h&&Object.assign(l,{startIndex:0,visibleIndex:0,renderSize:_xeUtils.default.toNumber(h.rSize),offsetSize:_xeUtils.default.toNumber(h.oSize)}),this.loadTableData(r,!0).then(function(){t.handleDefault(),t.updateStyle()}),_tools.GlobalEvent.on(this,"mousedown",this.handleGlobalMousedownEvent),_tools.GlobalEvent.on(this,"blur",this.handleGlobalBlurEvent),_tools.GlobalEvent.on(this,"mousewheel",this.handleGlobalMousewheelEvent),_tools.GlobalEvent.on(this,"keydown",this.handleGlobalKeydownEvent),_tools.GlobalEvent.on(this,"resize",this.handleGlobalResizeEvent),_tools.GlobalEvent.on(this,"contextmenu",this.handleGlobalContextmenuEvent),this.preventEvent(null,"created",{$table:this})},mounted:function(){this.autoResize&&_vXETable.default._resize&&this.bindResize(),document.body.appendChild(this.$refs.tableWrapper),this.preventEvent(null,"mounted",{$table:this})},activated:function(){this.refreshScroll(),this.preventEvent(null,"activated",{$table:this})},deactivated:function(){this.preventEvent(null,"deactivated",{$table:this})},beforeDestroy:function(){var e=this.$refs.tableWrapper;e&&e.parentNode&&e.parentNode.removeChild(e),_vXETable.default._resize&&this.unbindResize(),this.closeFilter(),this.closeMenu(),this.clearAll(),this.preventEvent(null,"beforeDestroy",{$table:this})},destroyed:function(){_tools.GlobalEvent.off(this,"mousedown"),_tools.GlobalEvent.off(this,"blur"),_tools.GlobalEvent.off(this,"mousewheel"),_tools.GlobalEvent.off(this,"keydown"),_tools.GlobalEvent.off(this,"resize"),_tools.GlobalEvent.off(this,"contextmenu"),this.preventEvent(null,"destroyed",{$table:this})},render:function(e){var t=this._e,o=this.id,l=this.tableData,i=this.tableColumn,n=this.visibleColumn,r=this.collectColumn,s=this.isGroup,a=this.hasFilter,u=this.isResizable,h=this.isCtxMenu,c=this.loading,d=this._isLoading,f=this.showHeader,p=this.height,b=this.border,m=this.vSize,v=this.treeConfig,g=this.mouseConfig,C=this.validOpts,x=this.editRules,w=this.showFooter,_=this.footerMethod,y=this.overflowX,S=this.scrollbarHeight,z=this.optimizeOpts,O=this.vaildTipOpts,M=this.tooltipConfig,E=this.columnStore,F=this.filterStore,R=this.ctxMenuStore,T=this.footerData,D=this.hasTip,j=E.leftList,L=E.rightList;return e("div",{class:["vxe-table",this.vSize?"size--".concat(this.vSize):"",b&&_xeUtils.default.isString(b)?"b--style-".concat(b):"",{"vxe-editable":this.editConfig,"show--head":this.showHeader,"show--foot":this.showFooter,"has--height":this.height,"has--tree-line":v&&v.line,"fixed--left":j.length,"fixed--right":L.length,"c--highlight":this.highlightCell,"t--animat":this.optimizeOpts.animat,"t--stripe":this.stripe,"t--border":b,"t--selected":g&&g.selected,"t--checked":g&&g.checked,"row--highlight":this.highlightHoverRow,"column--highlight":this.highlightHoverColumn,"is--loading":this.loading,"scroll--y":this.overflowY,"scroll--x":this.overflowX,"virtual--x":this.scrollXLoad,"virtual--y":this.scrollYLoad}]},[e("div",{class:"vxe-table-hidden-column",ref:"hideColumn"},this.$slots.default),e("div",{class:"vxe-table--main-wrapper"},[f?e("vxe-table-header",{ref:"tableHeader",props:{tableData:l,tableColumn:i,visibleColumn:n,collectColumn:r,size:m,isGroup:s}}):t(),e("vxe-table-body",{ref:"tableBody",props:{tableData:l,tableColumn:i,visibleColumn:n,collectColumn:r,size:m,isGroup:s}}),w?e("vxe-table-footer",{props:{footerData:T,footerMethod:_,tableColumn:i,visibleColumn:n,size:m},ref:"tableFooter"}):null]),j&&j.length&&y?renderFixed(e,this,"left"):t(),L&&L.length&&y?renderFixed(e,this,"right"):t(),c||l.length?t():e("div",{ref:"emptyPlaceholder",class:"vxe-table--empty-placeholder",style:p?null:{top:"".concat(this.headerHeight,"px")}},[e("div",{class:"vxe-table--empty-content"},this.$scopedSlots.empty?this.$scopedSlots.empty.call(this,{$table:this},e):_conf.default.i18n("vxe.table.emptyText"))]),u?e("div",{class:"vxe-table--resizable-bar",style:y?{"padding-bottom":"".concat(S,"px")}:null,ref:"resizeBar"}):t(),e("div",{class:"vxe-table--border-line"}),d?e("vxe-table-loading",{props:{visible:c}}):t(),a?e("vxe-table-filter",{props:{optimizeOpts:z,filterStore:F},ref:"filterWrapper"}):t(),e("div",{class:"vxe-table".concat(o,"-wrapper ").concat(this.$vnode.data.staticClass||""),ref:"tableWrapper"},[h?e("vxe-table-context-menu",{props:{ctxMenuStore:R},ref:"ctxWrapper"}):t(),D?e("vxe-tooltip",{ref:"tooltip",props:M,on:M&&M.enterable?{leave:this.handleTooltipLeaveEvent}:null}):t(),D&&x&&("default"===C.message?!p:"tooltip"===C.message)?e("vxe-tooltip",{class:"vxe-table--valid-error",props:"tooltip"===C.message||1===l.length?O:null,ref:"validTip"}):t()])])},methods:_methods.default};exports.default=_default2;