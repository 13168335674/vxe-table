"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils/methods/xe-utils")),_tools=require("../../tools");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function getContent(t,o,e,n){var r=o.type,l=getExportData(t,o,n,e),a=l.columns,i=l.datas;return"csv"===r?toCsv(t,o,a,i):"html"===r?toHtml(t,o,a,i):"xml"===r?toXML(t,o,a,i):""}function toCsv(t,o,n,e){var r=o.original,l="\ufeff";if(o.isHeader&&(l+=n.map(function(t){var o=t.own;return'"'.concat(_tools.UtilTools.getFuncText(o.title||o.label),'"')}).join(",")+"\n"),e.forEach(function(o,e){l+=r?n.map(function(t){return"index"===t.type?'"'.concat(t.indexMethod?t.indexMethod(e):e+1,'"'):'"'.concat(_tools.UtilTools.getCellValue(o,t)||"",'"')}).join(",")+"\n":n.map(function(t){return'"'.concat(o[t.id],'"')}).join(",")+"\n"}),o.isFooter){var a=t.footerData,i=o.footerFilterMethod?a.filter(o.footerFilterMethod):a,c=t.tableColumn.map(function(t){return n.includes(t)});i.forEach(function(t){l+=t.filter(function(t,o){return'"'.concat(c[o],'"')}).join(",")+"\n"})}return l}function toHtml(t,o,n,e){var r=o.original,l=["<!DOCTYPE html>","<html>",'<head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no,minimal-ui"><title>'.concat(o.filename,"</title></head>"),"<body>",'<table border="1" cellspacing="0" cellpadding="0">',"<colgroup>".concat(n.map(function(t){return'<col width="'.concat(t.renderWidth,'">')}).join(""),"</colgroup>")].join("");if(o.isHeader&&(l+="<thead><tr>".concat(n.map(function(t){var o=t.own;return"<th>".concat(_tools.UtilTools.getFuncText(o.title||o.label),"</th>")}).join(""),"</tr></thead>")),e.length&&(l+="<tbody>",e.forEach(function(o,e){l+="<tr>",l+=r?n.map(function(t){return"index"===t.type?"<td>".concat(t.indexMethod?t.indexMethod(e):e+1,"</td>"):"<td>".concat(_tools.UtilTools.getCellValue(o,t)||"","</td>")}).join(""):n.map(function(t){return"<td>".concat(o[t.id],"</td>")}).join(""),l+="</tr>"}),l+="</tbody>"),o.isFooter){var a=t.footerData,i=o.footerFilterMethod?a.filter(o.footerFilterMethod):a,c=t.tableColumn.map(function(t){return n.includes(t)});i.length&&(l+="<tfoot>",i.forEach(function(t){l+="<tr>".concat(t.filter(function(t,o){return"<td>".concat(c[o],"</td>")}).join(""),"</tr>")}),l+="</tfoot>")}return l+"</table></body></html>"}function toXML(t,o,n,e){var r=o.original,l=['<?xml version="1.0"?>','<?mso-application progid="Excel.Sheet"?>','<Workbook xmlns="urn:schemas-microsoft-com:office:spreadsheet" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet" xmlns:html="http://www.w3.org/TR/REC-html40">','<DocumentProperties xmlns="urn:schemas-microsoft-com:office:office">',"<Version>16.00</Version>","</DocumentProperties>",'<ExcelWorkbook xmlns="urn:schemas-microsoft-com:office:excel">',"<WindowHeight>7920</WindowHeight>","<WindowWidth>21570</WindowWidth>","<WindowTopX>32767</WindowTopX>","<WindowTopY>32767</WindowTopY>","<ProtectStructure>False</ProtectStructure>","<ProtectWindows>False</ProtectWindows>","</ExcelWorkbook>",'<Worksheet ss:Name="'.concat(o.filename,'">'),"<Table>",n.map(function(t){return'<Column ss:Width="'.concat(t.renderWidth,'"/>')}).join("")].join("");if(o.isHeader&&(l+="<Row>".concat(n.map(function(t){var o=t.own;return'<Cell><Data ss:Type="String">'.concat(_tools.UtilTools.getFuncText(o.title||o.label),"</Data></Cell>")}).join(""),"</Row>")),e.forEach(function(o,e){l+="<Row>",l+=r?n.map(function(t){return"index"===t.type?'<Cell><Data ss:Type="String">'.concat(t.indexMethod?t.indexMethod(e):e+1,"</Data></Cell>"):'<Cell><Data ss:Type="String">'.concat(_tools.UtilTools.getCellValue(o,t)||"","</Data></Cell>")}).join(""):n.map(function(t){return'<Cell><Data ss:Type="String">'.concat(o[t.id],"</Data></Cell>")}).join(""),l+="</Row>"}),o.isFooter){var a=t.footerData,i=o.footerFilterMethod?a.filter(o.footerFilterMethod):a,c=t.tableColumn.map(function(t){return n.includes(t)});i.length&&i.forEach(function(t){l+="<Row>".concat(t.filter(function(t,o){return'<Cell><Data ss:Type="String">'.concat(c[o],"</Data></Cell>")}).join(""),"</Row>")})}return"".concat(l,"</Table></Worksheet></Workbook>")}function downloadFile(t,o){var e=t.filename,n=t.type,r=t.download,l="".concat(e,".").concat(n);if(!r)return Promise.resolve(o);if(navigator.msSaveBlob&&window.Blob)navigator.msSaveBlob(new Blob([o],{type:"text/".concat(n)}),l);else if(_tools.DomTools.browse["-ms"]){var a=window.top.open("about:blank","_blank");a.document.charset="utf-8",a.document.write(o),a.document.close(),a.document.execCommand("SaveAs",l),a.close()}else{var i=document.createElement("a");i.target="_blank",i.download=l,i.href=getDownloadUrl(t,o),document.body.appendChild(i),i.click(),document.body.removeChild(i)}}function getLabelData(r,t,o){return o.map(function(e){var n={};return t.forEach(function(t){var o=_tools.DomTools.getCell(r,{row:e,column:t});n[t.id]=o?o.innerText.trim():""}),n})}function getExportData(t,o,e,n){var r=o.columns?o.columns:n,l=o.data||e;return o.columnFilterMethod&&(r=r.filter(o.columnFilterMethod)),o.dataFilterMethod&&(l=l.filter(o.dataFilterMethod)),{columns:r,datas:o.original?l:getLabelData(t,r,l)}}function getDownloadUrl(t,o){switch(t.type){case"csv":case"html":case"xml":return getAttachmentUrl(t,o)}return""}function getAttachmentUrl(t,o){var e=t.type;return window.Blob&&window.URL&&window.URL.createObjectURL&&!_tools.DomTools.browse.safari?URL.createObjectURL(new Blob([o],{type:"text/".concat(e)})):"data:attachment/".concat(e,";charset=utf-8,").concat(encodeURIComponent(o))}var _default={methods:{_exportCsv:function(t){return this.exportData(t)},_exportData:function(t){var o=this.visibleColumn,e=this.scrollXLoad,n=this.scrollYLoad,r=this.treeConfig,l=Object.assign({filename:"",original:!!r,isHeader:!0,isFooter:!0,download:!0,type:"",data:null,columns:null,columnFilterMethod:null,dataFilterMethod:null,footerFilterMethod:null},t);l.filename||(l.filename="table"),["csv","html","xml"].includes(l.type)||(l.type="csv"),l.original||(e||n)&&(l.original=!0,_tools.UtilTools.warn("vxe.error.scrollOriginal")),t&&t.columns||(l.columnFilterMethod=function(t){return t.property&&-1===["index","checkbox","selection","radio"].indexOf(t.type)});var a=o,i=this.tableFullData;return r&&(i=_xeUtils.default.toTreeArray(i,r)),downloadFile(l,getContent(this,l,a,i))}}};exports.default=_default;